00:00:09.190 - 00:00:20.858, Speaker A: For today. Very happy to introduce Anthony Liu Zhang, who many of you have had fun conversations with over the week from University of Chicago. He's the best friend of the business school talking about arbitrage extract from old value.
00:00:21.024 - 00:00:35.300, Speaker B: All right, so thanks a lot. Very happy to be here. I'll get started. I have to apologize. You saw this paper before a week ago, as I found out after coming here, that Tim has a very similar paper. So I didn't have time to write another paper after I found that out. So here we go.
00:00:35.300 - 00:01:36.582, Speaker B: All right, so what I'm trying to do in this paper is the following, right? The colloquial wisdom is the following. You have an automated market maker quoting you prices to trade, say, a stablecoin against ethereum or something like that, right? And there's this idea of this terribly named concept of impermanent loss, right? Somehow, when you're providing liquidity and trading this pair, you're kind of losing something over time, right? And then this is somewhat related, people think, to this idea of adverse selection. You tend to be on the wrong side of the trade, you tend to systematically lose money, right? And then what I'm trying to do here is, in a sense, take this and try and define what is impermanent loss, right? Like, what precisely do we mean by the impermanent loss of liquidity provision through an automated market maker? And what do we mean by precisely define this? Can we quantify what is impermanent loss? How much impermanent loss did a certain position incur? What circumstances under which this loss tends to be a large loss versus a small loss? And can I give a number, which is you are providing liquidity to ethereum versus US dollars in an AMM, right?
00:01:36.636 - 00:01:37.158, Speaker C: Sort of.
00:01:37.244 - 00:02:28.166, Speaker B: How much are you losing every year to this kind of impermanent loss? Right, so here I'm going to take a pretty strong stance on how we're going to define impermanent loss. I'm going to give a name, and I am thankful to Shumo Chu at Manta Network for coming up with a much cooler name than my original one. We're going to define impermanent loss as arbitraged extractable value. What do I mean by this? We're going to play a very simple model where you basically have one centralized exchange and all the prices are set on the centralized exchange. The centralized exchange is the big market, and then Arbitragers are trading the AMM against the centralized exchange. So arbitrage extractable value is the slippage that AMMS incur by the fact that the AMM could trade in a hypothetical world at the centralized exchange price. Instead, they're trading at a price that's worse as a centralized exchange price.
00:02:28.166 - 00:02:47.462, Speaker B: Arbitragers make the difference between the price on the AMM and the price on the centralized exchange. And so we're literally going to define arbitrage extractable value, the loss from liquidity provision as the profits that the Arbitragers extract from the AMMS, which are exactly equal basically to the slippage AMMS incur.
00:02:47.606 - 00:02:48.300, Speaker C: Right.
00:02:48.750 - 00:02:49.862, Speaker B: Why is this useful?
00:02:49.926 - 00:02:50.394, Speaker C: Yeah.
00:02:50.512 - 00:02:57.882, Speaker D: So what would be notion of loss for those that are not trading on a centralized exchange, those that are not listed?
00:02:57.946 - 00:03:12.622, Speaker B: No centralized exchange model doesn't work. So sort of yeah, I'm going to assume infinitely deep exchange, small AMM. Not exactly true in practice. I believe approximately true for most assets at this point in time. It becomes much more complicated if your price discovery is totally happening on an AMM.
00:03:12.686 - 00:03:12.914, Speaker C: Yeah.
00:03:12.952 - 00:03:51.454, Speaker B: So that's a great question that I'm not going to be able to deal with. Why is this useful? Because it turns out that I can have I'm going to illustrate to you sort of how this definition works. When AEV is large versus small, it also leads to an extremely simple formula for calculating annual arbitrage extractable value on any AMM invariant. Give me a function AMM invariant. I can calculate for you what arbitrage extractable value yearly is. What I'm going to give you is basically, if we look at the constant product market maker, if you're Lping Bitcoin against US dollars, you're losing around 8% a year to AEV. If you're arbitraging, if you're Lping ETH USD, you're losing around 11.5%
00:03:51.454 - 00:04:11.346, Speaker B: a year. So I can get like pretty simple numbers. I can literally tell you how much are you losing to this stuff. All right, let me jump in. So for now, let's start in a discrete time model, right? So time goes from one to T, and then we have two assets, one of which we're going to call money. So stablecoins, for example, the other one which we're going to call risky assets. So bitcoin or ethereum?
00:04:11.458 - 00:04:11.926, Speaker C: Right.
00:04:12.028 - 00:04:27.318, Speaker B: And then the basic setup is that we have a centralized exchange, and on the centralized exchange, we have an infinitely deep centralized exchange. So you have no price impact. You can buy or sell an infinite amount of the risky asset X at a fixed price P every period on the centralized exchange.
00:04:27.414 - 00:04:28.060, Speaker C: Right?
00:04:29.950 - 00:04:58.106, Speaker B: The AMM is a constant function AMM. So how do we describe an AMM? There is a function which we're going to call U of XY. And the simple description of what the AMM does is the AMM is willing to do some of you may be familiar with this. The AMM is willing to make any trade in any time period which satisfies the following equation. U is preserved, right? And so the idea is basically as long as in period T u of X-T-Y-T is equal to U of X t minus one y t minus one last period. The AMM is willing to make that trade.
00:04:58.158 - 00:04:58.374, Speaker C: Right.
00:04:58.412 - 00:05:09.798, Speaker B: So familiar formula. I assume most of you have seen some version of this. Basically, in the constant product market maker, the AMM is willing to make any trade such that the product of X and Y is the same in any period.
00:05:09.894 - 00:05:10.154, Speaker C: Right.
00:05:10.192 - 00:05:14.362, Speaker B: And you can use different functions for this. I think everyone's seen this stuff.
00:05:14.416 - 00:05:14.682, Speaker C: Yeah.
00:05:14.736 - 00:05:39.474, Speaker B: Okay, so we're going to ignore fees, we're going to ignore gas. And then what we also assume is there's an arbitrager. You can assume one or many, but assume there's one arbitrager, and then the arbitrager is going to trade with the AMM plus a centralized exchange to maximize profits. So, very simple model. The only person trading is the arbitrager. No gas fees, no fees charged by the AMM, so on and so forth. So these are all the components of the model.
00:05:39.592 - 00:05:40.260, Speaker C: Right.
00:05:41.990 - 00:06:32.926, Speaker B: Here's the core kind of thought experiment we want to do in the next few slides. I'm just going to walk you through sort of comparing what the AMM does with a thought experiment that does better than the AMM. So what is the thought experiment? The AMM trades to keep you constant, right? So the AMM in every stage is going to sort of have the same level of view. Consider an optimizing AMM, and instead what the optimizing AMM does is it takes in every period T, it tries to maximize the level of the AMM invariant conditional on basically trading at the centralized exchange prices. This should be a weak inequality. So what is it doing? It's trying to maximize the level of its invariant conditional on basically YT money plus PT times XT is smaller than or equal to money last period plus the price today times quantity of each last period.
00:06:32.958 - 00:06:33.250, Speaker C: Right.
00:06:33.320 - 00:06:43.670, Speaker B: So this just says the AMM is trading at the centralized exchange price. The AMM is trying to maximize her AMM invariant conditional on trading at the centralized exchange price.
00:06:43.740 - 00:06:44.022, Speaker C: Right.
00:06:44.076 - 00:06:50.342, Speaker B: And so the difference between sort of this AMM and sort of the classic AMM, what do I have to do to build an AMM that does this?
00:06:50.396 - 00:06:50.662, Speaker C: Right?
00:06:50.716 - 00:07:22.066, Speaker B: I need to have an AMM which has like a perfectly high frequency oracle to check Binance's price. That's really all I need, because as long as I have that oracle to check Binance's price, the AMM can simply do the following. It doesn't have to actively trade, it just has to quote a price that's like epsilon better than Binance's price. The arbitrager will still arbitrage for it and solve this problem for it, right, but it doesn't have to give the arbitrager as much slippage. So I claim that hypothetically, if I give you a perfect high frequency oracle, you can actually build this AMM, but largely it plays a thought experiment role here.
00:07:22.088 - 00:07:22.418, Speaker C: Yeah.
00:07:22.504 - 00:07:28.302, Speaker D: So in this thought experiment, what does the invariant reflect for the AMM?
00:07:28.366 - 00:07:32.982, Speaker B: Let me try and walk you through this in the next few slides. Yeah, but it's a thought experiment to illustrate where the loss is.
00:07:33.036 - 00:07:33.254, Speaker C: Right.
00:07:33.292 - 00:07:38.700, Speaker B: So it's a theoretically attainable thought experiment and this is how we play. Any other questions about this?
00:07:39.550 - 00:07:44.218, Speaker A: The assertion is it's not just a benchmark, it's an actually realizable benchmark if you really want.
00:07:44.304 - 00:07:44.842, Speaker C: Yeah.
00:07:44.976 - 00:07:54.090, Speaker B: And like many of the ideas for sort of like yeah, if you had an oracle, you would want to trade at a price which is not that much worse than the centralized exchange price in principle. Buildable.
00:07:54.170 - 00:07:54.800, Speaker C: Yeah.
00:07:55.810 - 00:08:15.938, Speaker B: Okay, so now we're going to ask in the next few slides, basically to illustrate this definition, what's the difference between the performance of the optimizing AMM and the simple AMM? Here is an AMM and then the equilibrium point of an AMM basically looks like the following. X times y is equal to K. This is like X equals K over y.
00:08:16.024 - 00:08:16.418, Speaker C: Right?
00:08:16.504 - 00:08:24.434, Speaker B: And what happens is the equilibrium point is the tendency point where basically the price of ethereum is equal to the slope of the X y equals K level curve.
00:08:24.482 - 00:08:25.030, Speaker C: Right?
00:08:25.180 - 00:08:41.734, Speaker B: What happens when the simple AMM trades? What happens when price has changed, right? The price changes to here. And then what happens is that sort of if the price is this, then arbitragers are going to trade with the AMM to the point where basically the slope of the P curve is tangent to the U curve.
00:08:41.782 - 00:08:42.090, Speaker C: Right?
00:08:42.160 - 00:09:01.378, Speaker B: And then so this like you've probably seen pictures like this before. This is what the simple AMM does, right? Here's a graphical illustration of the problem the optimizing AMM is solving. The optimizing AMM says, I'm going to start at A. I can trade at price p two. I'm going to maximize the level of my U curve conditional on the price P two.
00:09:01.464 - 00:09:01.810, Speaker C: Right?
00:09:01.880 - 00:09:11.542, Speaker B: And then so the optimizing AMM goes over here, right? And you notice D is, in a sense better than B. You end up with basically more of it dominates B, you end up with more east and you get more US.
00:09:11.596 - 00:09:12.310, Speaker C: Dollars. Right?
00:09:12.380 - 00:09:42.350, Speaker B: That's kind of the key point to sort of where the loss is in an AMF. Like, you could trade at this price. You could literally program the AMM to get the arbitrator to trade at this price. You instead trade at this price. What happens when prices move from p one to p two and back to p one, right? So why do people call loss impermanent, right? Because of the fact that when you change prices from p one to p two, you go from A to B. When you change prices back from p two back to p one, you go back to A. So there's a sense in which you didn't lose anything because you're back where you started.
00:09:42.420 - 00:09:42.798, Speaker C: Right?
00:09:42.884 - 00:10:04.866, Speaker B: So what I want to argue is the optimizing AMM says that's not the right benchmark. The benchmark should not be to get back to where you started. The benchmark is when this happens. My simple AMM, which I told you is in theory buildable, does not just get back to where it started, it does better. I can make money trading here if prices move and go back to where they started. Very simple. The one line proof is the following.
00:10:04.866 - 00:10:56.054, Speaker B: The optimizing AMM, if you simply look at the formulas must achieve a U level that increases each period, right? The first u is attainable. So I have to climb up every period, right. So if you look at the optimizing AMM, I'm going upwards once and I'm going upwards twice, so I must increase U, right. How is it kind of doing that? You sort of see how, like, you change the price from P one to P two, I go from A to C, change it from P two back to p one, I go to D, right. So I can program a machine mean that if prices do this makes money for sure, right. And then you might be asking, like, what is the trick here? How is it possible to program a machine that prints money in efficient markets, right? Where is the loss? How does this make sense? So I'm going to analyze a simple model that tells you how sort of it's possible in fish, in markets for an AMM to make profits. When this happens, of course, the loss is somewhere else and I'm going to tell you where the loss is.
00:10:56.092 - 00:11:00.102, Speaker D: So being on a higher U doesn't mean you make money here.
00:11:00.156 - 00:11:20.094, Speaker B: It does, right. Because in any sense, in which you value the D bundle, right? You have the same prices as before, you have more ETH, you have more US dollars, you make more money. But exactly as you say, exactly as you say, we're going to move. Like increasing you doesn't necessarily mean increasing peak. And that's exactly what I'm going to do in the next couple of so.
00:11:20.132 - 00:11:23.694, Speaker D: If you're coming back to where you're from on a higher you, then you've made money.
00:11:23.812 - 00:11:42.530, Speaker B: Yes, precisely. And that's exactly what I'm going to do in the next couple of slides. Give me a few slides. That's precisely the next few slides. Obviously, I'm not like designing a money printer, right? I come from Chicago. We don't do that there. Okay, so I'm going to set up the simplest model in which we can ask the question of asset returns.
00:11:42.530 - 00:11:44.754, Speaker B: What's the simplest model? We use a binomial tree.
00:11:44.802 - 00:11:44.966, Speaker C: Right.
00:11:44.988 - 00:11:53.786, Speaker B: What's a binomial tree? Price of ethereum USD is a dollar, right. It has a 50 50 chance of going up to 1.3 or going down to 0.7.
00:11:53.888 - 00:11:54.298, Speaker C: Right.
00:11:54.384 - 00:12:17.394, Speaker B: And then from 1.3 has a 50 50 chance of going to 1.6 or one. From zero seven, it has a 50 50 chance of going to one and 0.4. So you cannot make money on this tree. This is a Martingale do whatever trading strategy you want. Never going to make any money, right? So now I can just answer the question, what is going on? By comparing the trading strategy of three different things.
00:12:17.394 - 00:13:09.426, Speaker B: I can compare the profits of hold, so don't do anything, just hold the initial bundle you have. I can compare the profits of the optimizing AMM and I can compare the profits of the simple AMM. So what do I do, I literally just calculate in each node of the tree I go from here to here. How much does my simple AMM do? If I optimize utility on an x y equals k optimizing AMM, what happens? And then in each node I can do that, right? What I'm going to report as profits, I'm just going to sort of calculate as profits pi t is YT plus Ptxt. So the number of USDC you would have if you sold all your east to binance in this node at market prices. Any questions on the setup here? All right, so going forwards here is buy and hold. And this is just to illustrate to you my notation and what I'm doing here, right? The buy and hold strategy, regardless of what prices do, they go up, they go down, whatever.
00:13:09.426 - 00:13:46.030, Speaker B: All I'm doing is x and y. I hold one unit of ethereum, I hold one unit of USDC, right? So I do nothing. There's still like fluctuation in the value of my portfolio because if ethereum is worth more then dollars plus like 1.6 times the value of ethereum is like 2.6, right? This is our benchmark and then now we can ask to sort of make sure that my optimizing AMM is not a money printer. Why can the optimizing AMM make money? Like what's going on here? Here is the optimizing AMM. When prices go up, the optimizing AMM tends to sell ethereum for US dollars.
00:13:46.030 - 00:14:35.550, Speaker B: So comparing XY here to XY on the buy and hold, when prices go up, the optimizing AMM sells a bit of ethereum and loads a bit more on USDC. As a result of that, if prices go up further, right? If prices go back down, right, then the optimizing ann holds less ethereum than the buy and hold strategy, right? And then you notice that the profit here, 2.3 is higher than the profit of the buy and hold strategy, right? This makes sense. If you sell and then prices go down, you are happy, right? If you sell and prices go further up, you are unhappy, right? And so over here, if prices continue to go up, then the optimizing AMM gets 2.56 which is lower than 2.6, right? The average of these two of course is exactly 2.3, which is the average of these.
00:14:35.550 - 00:15:13.162, Speaker B: This is just illustrating I design a trading strategy on a Martingale. I'm not making any money, right? And so the magic why it is that the optimizing AMM makes money. When prices revert, it pays for it. If prices don't revert in a fair market, like that evens out, right? And then so the optimizing AMM is a trading strategy which sort of sells price rises and buys price dips on the bottom you see exactly the same thing. If you go down and back up, you make money. If you go down and down again, you lose money, right? So this kind of strategy, the market making kind of strategy does not lose money when there's volatility, right? It breaks even. Any trading strategy breaks even.
00:15:13.162 - 00:15:49.462, Speaker B: What happens to the simple AMM, right? In the simple AMM first, notice that at every stage, first you start with two, right? Intuitively what you should think is that every time the simple AMM trades, it trades at a price worse than P. So while the optimizing AMM cannot lose money, the simple AMM doesn't have that guarantee because of the fact that it's not trading at the binance prices, it's trading systematically worse. What might you expect? Then you would expect to see basically that sort of at every stage the simple AMM is losing relative to the optimizing AMM. That's exactly what we see. 2.3 here, 2.28 1.71.67.
00:15:49.462 - 00:16:06.378, Speaker B: So already in this stage we're making less money at every given stage than the simple AMF. When we go back, here's the magic right here's where you see basically where impermanent loss comes from, right? It looks like you're not losing anything when you go from price one up and then back down to one, you get exactly the same profit as you started.
00:16:06.464 - 00:16:07.098, Speaker C: Right?
00:16:07.264 - 00:16:44.722, Speaker B: But the thing is that sort of this is lower than what you would have gone if you traded at market prices and you're losing even more than the optimizing benchmark if prices go up and diverge. So kind of market making strategies when you buy when prices rise, when fall and then sell when prices rise are kind of bets on convergence. The bet on convergence is useful because if you win the bet, if convergence happens, you make some money. If convergence doesn't happens, you lose money, right? And then sort of what this is showing is that the AMM another way to understand where the loss comes from, it doesn't win when prices go up. You need to win when prices reconverge. You need to win on reconvergence to pay for the fact that you lose on divergence.
00:16:44.786 - 00:16:45.110, Speaker C: Right?
00:16:45.180 - 00:17:38.520, Speaker B: So sort of you don't win on the convergence, you lose on the divergence, you're losing money overall, right? So sort of this hopefully illustrates what is going on in the difference between optimizing and simple. So basically let me try and summarize why I kind of do this decomposition. I separate into three objects buy and hold, a market making strategy that trades at good prices, which is the optimizing AMM and then the AMM market making strategy that trades at not good prices. When we talk about impermanent loss, we're confounding these two effects because usually we're comparing implicitly the simple AMM strategy to the buy and hold strategy. Implicitly this can be broken down into two things. It can be broken down into the volatility exposure and market making strategies that you tend to win on reconvergence and lose on divergence. And the slippage between the optimizing and simple AMM where every step of that trading you're losing some money.
00:17:38.520 - 00:18:44.302, Speaker B: So the core idea of this decomposition is basically that we should separate these. We should not call this a loss, right? This doesn't lose money, right? Sort of it's a strategy that makes you like, sort of zero profits in perfectly fair markets, right? This is the loss, right? And then so the key idea here with these thought experiments is like, let's try and define this as the loss of an AMM and then separate it from this. I want to walk you through a couple of examples to illustrate sort of what happens if we use this definition of loss, okay? So first of all, let me define in this context what is Arbitrage extractable value in period t? The AMM is selling some amount, delta XT of ethereum at some price ptamf, right? PTA AMM generally defers from the binance price P. And then so Arbitrage extractable value is something we're going to define as the Arbitrager's profits from trading with the AMF. This is extremely simple. You're buying this much or you're selling this much at this price, and then you paid that price for it.
00:18:44.356 - 00:18:44.622, Speaker C: Right?
00:18:44.676 - 00:19:31.646, Speaker B: So Arbitrage expectable value is the amount sold by the AMM in period T times the gap between the AMM price and the exchange price. There is a nice graphical representation of this. It's not quite the gap between the optimizing and simple AMM. Instead, it's the following, right? When the simple AMM buys from A to B, that price is slightly worse than the finance price, p two, right? And then the delta x, the amount sold of ethereum multiplied by the gap in slopes between the AMM price and then the centralized exchange price, this green vertical line, that is exactly that, that is Arbitrage extractable value. And you see basically, visually, that sort of the arbitrager is making exactly this much when price is moving, right?
00:19:31.748 - 00:19:36.718, Speaker A: So the Ptamm, that's like the average spot price over the size.
00:19:36.884 - 00:19:38.554, Speaker B: That's the AB line slope.
00:19:38.602 - 00:19:38.814, Speaker C: Yeah.
00:19:38.852 - 00:19:43.482, Speaker B: So it's exactly the average price when trading with the AMM.
00:19:43.546 - 00:19:44.160, Speaker C: Yeah.
00:19:45.330 - 00:19:57.080, Speaker B: Notice this is a bit different from C, which is where the optimizing AMM goes. So I use the optimizing AMM as sort of a thought experiment, but the definition here compares the AMM price to the centralized exchange price.
00:19:57.610 - 00:19:58.214, Speaker C: Okay?
00:19:58.332 - 00:20:05.362, Speaker B: Where does this definition get us if we have multiple time steps? Arbitrage extractable value simply adds up over many time steps.
00:20:05.426 - 00:20:05.750, Speaker C: Right?
00:20:05.820 - 00:20:31.850, Speaker B: So the thing is, you go from P one to P two. The simple AMM trades from A to B The arbitrager rips off this much from the AMM. We go from P two to P three. We go from B to C, and then the arbitrager rips off this much from the AMM. I've noted points B star and C star, right? What are B star and C star? B star is the price is where you could have gotten with A if you bought the same amount of ethereum, but you bought it at binance prices instead of the worst AMM prices.
00:20:31.930 - 00:20:32.318, Speaker C: Right?
00:20:32.404 - 00:20:40.302, Speaker B: And then so C likewise is the amount of money you could have gotten if you bought at binance prices instead of AMM prices.
00:20:40.366 - 00:20:40.690, Speaker C: Right.
00:20:40.760 - 00:20:47.846, Speaker B: And then so the way I've set it up, y axis is money, x axis is ethereum. So then the unit of these are in dollars.
00:20:47.948 - 00:20:51.640, Speaker C: Right? Yeah.
00:20:52.010 - 00:21:14.426, Speaker D: I'm still having a hard time understanding why the optimizing AMM, like you call it, is optimizing. So maybe I can is it, in a sense, like a dual problem where this has to be an invariant? Now, that problem of optimizing maximizing the U, you can see it as a dual problem of keeping the U invariant subject to having more revenue.
00:21:14.618 - 00:21:31.940, Speaker B: Well, the optimizing AMM, I just call it that as I'm just calling it something. It's like, let's just program a strategy that tries to climb the invariant curve. Why would you do that? As a thought experiment, basically, there's no sense in which it's, like, optimal. In some sense, it's just I can describe its behavior by trying to maximize a certain function.
00:21:32.870 - 00:21:36.642, Speaker D: But you are defining the arbitrarily value using this.
00:21:36.696 - 00:21:37.300, Speaker C: No.
00:21:37.670 - 00:21:40.038, Speaker D: Okay, sorry.
00:21:40.124 - 00:22:20.740, Speaker B: So notice that I use the optimizing AMM to what did I use it? I use it as a thought experiment of a guy that's playing a qualitatively similar strategy to a simple AMM but doesn't lose money. So I want to illustrate to you why. Basically, what is it about the simple AMM that makes it lose money? Purely the slippage, not the qualitative nature of the market making strategy. That's what I want to communicate with the optimizing AMM market making strategies that don't incur slippage, don't lose money. It's purely the slippage that loses you money. Then I want to define arbitrage extractable value as the amount of money you lose from slippage you lose from what you lose from slippage, which is the gap between trading at the AMM price dotted line and the finance price, which is P two.
00:22:22.070 - 00:22:25.654, Speaker D: And the finance price is the price.
00:22:25.692 - 00:22:35.430, Speaker B: That you can buy ethereum, an infinite amount of ethereum at finance. How does it map to the model that's P two? That's PT.
00:22:37.070 - 00:22:38.780, Speaker D: It's just a data point.
00:22:40.030 - 00:22:41.510, Speaker B: PT moves every period.
00:22:41.590 - 00:22:41.930, Speaker C: Okay.
00:22:42.000 - 00:23:21.746, Speaker B: And every period I could buy at PT, but the AMM forces itself to buy at a stupid price, and then that's why it loses, basically, because the AMM fails to buy at Binance's the good price, thus leaving some profits for arbitragers to extract. Thank you. Okay, so arbitrage extractable value adds up over many time steps. Is the optimizing AMM model oh, I'm getting a question in Chat. Is optimizing AMM model applicable when price discovery happens on uniswap? And this is very similar to Abdul's question, which is basically I'm using the CEX here. Yeah, I am. I don't think this necessarily works when you have only the decentralized exchange.
00:23:21.746 - 00:23:46.302, Speaker B: We need to think about that. We're going to ignore that for this talk. Yeah. I think that it's still empirically true that most of the liquidity is on binance compared to uniswap. So I don't think this is a terrible assumption for IRL at this point, though of course it could change. Arbitrage extractable value is not always larger. You have this intuition basically that oh, sort of impermanent loss is high.
00:23:46.302 - 00:24:42.266, Speaker B: The intuition goes when prices have moved a lot. This is not true about arbitrage extractable value. Let me give you a simple example, right? When prices move from A to B to C, what is impermanent loss? The vertical length of these two lines, right? Suppose instead that prices move from A to B, from P one to P two and then back to P one, right? So then under the colloquial intuition that oh, price divergence is what causes loss, right? The loss should be higher here than here. This is not true of arbitrage extractable value. How do you see that? Because the vertical lines here are not very big. The vertical lines here are quite big, right? So the arbitrager gets to rip you off one way and rip you off the other way. When prices go down and back up here, the arbitrager rips you off a smaller amount, right? So the key is basically when you realize that the losses are really coming from arbitrage, it's not how far prices sort of ended up moving that matters for how much arbitragers make it's something closer to the total absolute value sum.
00:24:42.298 - 00:24:43.550, Speaker C: Of price changes, right?
00:24:43.620 - 00:25:37.854, Speaker B: Because when prices move a lot in absolute value, then the arbitrager rips you off a lot. That leads to another property, of course, which is that Arbitrage Extractable Value is path dependent. If you start at A and then go to B and go back to A, that's not a sufficient statistic for figuring out how much arbitrage is made. Of course this has to be true in some sense, right? And a simple example to show that it's true is if you move further away from A before coming back to A, right, then the vertical bars are bigger, right? So the idea is that the arbitrager can rip you off for more if prices diverge and went back, right? So, again, sort of the confounding and impermanent loss of the vol exposure and kind of the slippage obfuscates this idea that really, if you look carefully at impermanent loss, it's not about going far from where you started. It's about how many kind of jumps you took and how much the arbitrager could rip you off on all these jumps.
00:25:37.902 - 00:25:38.066, Speaker C: Right.
00:25:38.088 - 00:26:00.710, Speaker B: So I use these as like pieces of intuition to illustrate that basically we're going to define arbitrage stackable value as this slippage between what you do on your AMM and centralized exchange. The whole intuitions behind what is driving this loss when it is large, when it is small, are quite different from the colloquial intuitions about people sought about impermanent loss. It's not a volatility effect, it's a slippage effect entirely.
00:26:00.790 - 00:26:01.178, Speaker C: Right?
00:26:01.264 - 00:26:04.086, Speaker B: Depends on total size of price movements that have task dependent.
00:26:04.198 - 00:26:08.490, Speaker A: By total size, you mean like sum of the T value PT minus P.
00:26:08.560 - 00:26:12.314, Speaker B: I should, like, square quote total size informally. Exactly that.
00:26:12.352 - 00:26:12.554, Speaker C: Yeah.
00:26:12.592 - 00:26:14.586, Speaker B: And so the idea is that sort of more complicated.
00:26:14.618 - 00:26:14.958, Speaker C: Yeah.
00:26:15.044 - 00:26:21.354, Speaker B: So the thing is, because of the curvature, that's not yeah. Qualitatively. You kind of like more jumps you take, the more you lose.
00:26:21.402 - 00:26:26.226, Speaker C: Yeah. Sorry, this is the same question that people ask already, but is there any.
00:26:26.248 - 00:26:30.994, Speaker A: Good way of modeling if you have some opinion on the liquidity ratio on.
00:26:31.032 - 00:26:33.570, Speaker C: The central exchange versus the DeFi pool?
00:26:34.150 - 00:26:42.754, Speaker B: Yeah, I haven't thought of that. It seems conceivably possible that you do a version of Arbitrage that kind of takes into account price impact on centralized exchange. So you might look in that direction.
00:26:42.802 - 00:26:43.878, Speaker C: I haven't done it yet.
00:26:43.964 - 00:26:58.886, Speaker B: It's quite simple in this world. It's more complicated in that world. I'll mention briefly one other thing that's ignored Arbitragers don't only make this in reality, when noise traders hit the AMM, Arbitragers also make profits, like doing rebalance Arbitrage.
00:26:58.918 - 00:26:59.066, Speaker C: Right.
00:26:59.088 - 00:27:05.754, Speaker B: Because the noise trader, like, I go in and do a stupid order to buy from the AMM, the arbitrager rips me off on the rebound.
00:27:05.802 - 00:27:06.062, Speaker C: Right.
00:27:06.116 - 00:27:16.046, Speaker B: So I don't have to deal with that because I ignored noise traders. The only traders here are Arbitrage. But a definition you might use if you put in noise traders is try and take into account the rebalance Arbitrage.
00:27:16.078 - 00:27:17.220, Speaker C: Basically. Yeah.
00:27:17.910 - 00:27:30.322, Speaker B: Okay, so now we come to basically the second question, which is, okay, I've defined for you impermanent loss. It might be useful if I can use this to go in and quantify actually how much are AMMS losing to impermanent loss.
00:27:30.386 - 00:27:30.710, Speaker C: Right.
00:27:30.780 - 00:27:34.198, Speaker B: And it turns out we get a very nice formula for this in continuous time.
00:27:34.284 - 00:27:34.870, Speaker C: Right.
00:27:35.020 - 00:27:42.010, Speaker B: Suppose prices move a tiny bit DP, right? So we move from P to P minus DP. Prices decrease a bit.
00:27:42.080 - 00:27:42.700, Speaker C: Right.
00:27:43.070 - 00:28:34.826, Speaker B: Zoom in a lot to this function. What happens to this function is basically that the AMM moves a bit along this curve from the point with slope P to the point with slope P minus DP. So you'll have to believe me, because I handwaved the proof that if you zoom into a function close enough, the slope between two points when you have P here and P minus DP here is P minus DP over two. I think this is obvious. Okay. So then if this is P minus DP over two, and then we have the AMM trades in amount DX, right? Then the size of this line Arbitrage extractable value is what the gap between these two slopes? So P and P minus DP over two times DX Right. And then so once we do that out, what we have is that the size of this bar Arbitrage extractable value in a very small timescale is DX, the amount traded times the slope gap, which is DP over two.
00:28:34.826 - 00:28:36.218, Speaker B: So DX DP over two.
00:28:36.304 - 00:28:36.842, Speaker C: Right.
00:28:36.976 - 00:29:41.022, Speaker B: Pretty nice formula. The way that we work with this formula is that DP is an object for a price that evolves, like with a geometric Brandian motion or something. We understand, right? What we need to do is understand what DX is on a small period of time, right? How does DX change? DX changes because P changes. And when P changes, the AMM trades, right? So we can express this simply as Dxdp, the demand elasticity, the demand slope of the AMM, how much the AMM trades per unit price movement times DP squared over two. Now, you can do a rather ugly piece of algebra and figure out what Dxdp is for any AMM invariant, right? And then it is this ugly thing where you basically take a number of derivatives of the invariant function, right? This looks ugly. You can basically show that what this is is the determinant of, I think, what we call the bordered hessian of U. So what is that? It actually has a very simple interpretation, which is the curvature, the convexity of the level curves of U.
00:29:41.022 - 00:29:59.158, Speaker B: Why does that make sense? Because you stare at this thing and ask, when is DX large? If you have a very, very convex U, like a rectangle change prices, x doesn't move at all if you have a very linear U change prices. And then you have to move a lot to the right in order for the slope to change.
00:29:59.244 - 00:29:59.686, Speaker C: Right.
00:29:59.788 - 00:30:46.386, Speaker B: So basically, if the AMM trades until the point where the slope is equal to the new price, it's the convexity of these curves that determines Dxdp. Hopefully you believe me on that. And then sort of, you can show that this is like old proof somewhere. The denominator of this is exactly related to the convexity of the level sets of U. But what's the important thing? I can just like these are all derivatives, any invariant function, I can just throw in here and calculate what that is. Then what I notice is just that the expectation of DP squared in a small time period is sigma squared P squared DT, right? And then for a geometric brownian motion, I can just calculate the percentage annual volatility for like a risky asset, and I get DP squared. Right? I probably butchered the notation here.
00:30:46.386 - 00:31:22.442, Speaker B: I'm not very good at stochastic calculus. But then you just divide by portfolio value and then you get a term which is basically you can interpret this thing as saying in a unit of time, what percentage of your portfolio value in US dollars are you losing to arbitrage extractable value? And then we have the Dxdp term, which I can calculate here, sigma squared, P squared over your portfolio value. Now, I can just plug numbers in into this formula. And then it turns out that for the constant product market maker, arbitrage extractable value is accrued at this very nice rate of every year, you lose sigma squared over eight in AEV.
00:31:22.506 - 00:31:22.782, Speaker C: Yeah.
00:31:22.836 - 00:32:02.282, Speaker B: So you have a very nice formula. The first thing I did when Jim sent me a paper is scroll down, see the eight, and then I was very sad. But at least either we both got it right or both got it wrong. But basically, like literally the same formula, you can do it for any other function, right? Because these are just derivatives. I can throw the quantities in and just calculate what U is. So then for the balancer, in econ speak, called Douglas market maker, which is constant product, just with some coefficients, I can calculate arbitrage extractable value as a function of the coefficients. And then for a nice another example, stable swap is curves invariant and curves invariant is quite simple.
00:32:02.282 - 00:32:06.750, Speaker B: It basically says, let's do constant product. Let's add a linear term to constant product.
00:32:06.820 - 00:32:07.006, Speaker C: Right?
00:32:07.028 - 00:32:32.870, Speaker B: So the intuition here is that stable coins basically have price equal to one most of the time. So we want to have higher demand elasticity. Like Dxdp has got to be higher. We want to trade a lot without moving prices too much. This has less convexity than this. You would expect that AEV arbitrage extractable value should be higher when you have less convexity, because every bit that the arbitrager rips you off, you're trading more with that. Exactly.
00:32:32.870 - 00:32:55.070, Speaker B: What you find is that our arbitrage extractable value for the stable swap invariant is sigma squared over eight, one plus chi, where chi is the weight chi over x, where chi is the weight on the linear term here, basically. So then it satisfies the intuition that the more linear you make this, the less convex, the more it gets ripped off by arbitragers and then the more impermanent losses arbitrage will.
00:32:55.140 - 00:32:55.470, Speaker C: Yeah.
00:32:55.540 - 00:32:57.470, Speaker A: Oh, I see. It says a constant.
00:33:00.210 - 00:33:00.718, Speaker B: Right?
00:33:00.804 - 00:33:01.006, Speaker C: Yeah.
00:33:01.028 - 00:33:04.574, Speaker B: This is dan Robinson did this in his post. So I did the same thing because.
00:33:04.612 - 00:33:05.690, Speaker A: Then it gets messy.
00:33:05.770 - 00:33:40.198, Speaker B: It gets messy, yeah. Now I just plug in numbers because I have a sigma squared over eight and I just throw in numbers in here. So you want to answer the question, like you're lteing for a constant product market maker, bitcoin in US dollars, right? How much are you losing every year? How much are arbitragers ripping you off every year? And then you plug in that the sigma of bitcoin is bitcoin moves around. I just checked, googled this. Around 81% annually, right? And then so sigma squared is like zero point 65, and you divide by eight. And then you're getting that sort of arbitrage extractable value is around 8% per year for bitcoin. East had, I think, slightly higher volatility.
00:33:40.198 - 00:34:09.622, Speaker B: And then as a result, East AV, on a constant product market maker is around 11.5% annually. Yeah. I'm not aware of any paper other than Tins that gave you a formula to be able to do this. So another contribution, I think, if you accept that a definition of impermanent loss is what we've put down here. Then you can calculate what it is. And another way to say this is calculate hypothetically sort of how much you can gain from building this optimizing market maker, which literally trades at binance prices all the time.
00:34:09.676 - 00:34:09.846, Speaker C: Right.
00:34:09.868 - 00:34:13.798, Speaker B: So this is kind of here's the size of the pie, if you built that thing.
00:34:13.884 - 00:34:14.520, Speaker C: Yeah.
00:34:16.010 - 00:34:21.370, Speaker A: Did you actually get into kind of like trade volumes on uniswap V two or V three?
00:34:21.440 - 00:34:29.178, Speaker B: Oh, for the fees to compensate. Yeah. So I think that no, I didn't I was thinking about there's a question which is like I said, I don't.
00:34:29.184 - 00:34:36.254, Speaker A: Know how to I just don't know how to make terms kind of big to me. But yeah, I would want to back that up.
00:34:36.372 - 00:34:37.582, Speaker C: Right. Yeah.
00:34:37.716 - 00:35:02.646, Speaker B: And I guess there's a sense in which basically, ultimately these should be paid by the guys trading. Like if you think the LPR is break even. Right. So this should in some sense be absorbed in bigger trading fees for the noise traders or stuff like that. I haven't really thought about pass through, but yeah, same question. How to interpret this number is tricky. Another thing to you might like even the interpretation that Arbitragers get this is wrong.
00:35:02.646 - 00:35:05.750, Speaker B: The reason that's wrong is because they sort of gas fight it away.
00:35:05.820 - 00:35:06.150, Speaker C: Right.
00:35:06.220 - 00:35:19.014, Speaker B: And then so the thing is that there is not one guy ripping these guys off for 8%. A lot of that is probably burned in fee competition, gas competition between different AMMS China, different Arbitrages China for a run.
00:35:19.072 - 00:35:19.680, Speaker C: Yeah.
00:35:20.850 - 00:35:54.630, Speaker B: Okay. So here's a list of things we ignored. So we assumed centralized, all the liquidity is on the centralized exchange. Ignored fees, ignored order flow. That's not arbitrage. There is another thing, even with these assumptions that's ignored, which is if you assume that there is a person who knows where the centralized exchange price is going to go, informed trading, you have to account for that also we ignored that. And then there's this thing that I mentioned, which is that reversion trading is also Arbitrage extractable value, if you thought of it this way.
00:35:54.630 - 00:36:19.962, Speaker B: And then you could imagine once you put noise trading in, accounting for that. Didn't do that, who pays for it? So the pass through point, we ignored gas fees and then sort of yeah, that's a lot of things we ignored. But yeah, so the idea basically is so you want to separate basically it's not really vol exposure. It's not sort of how much prices diverge that this paper argues is what LPs lose. What LPs lose is pure slippage.
00:36:20.026 - 00:36:20.398, Speaker C: Right.
00:36:20.484 - 00:36:40.290, Speaker B: And then so sort of you can set a simple model up and show with these examples how this is a definitional paper, really, so it doesn't make too much sense to define the loss of AMMS in a way which depends on volatility. It's all slippage. And the other nice thing basically about defining it this way you get some internal consistency things. What the AMM loses is exactly what the arbitrager gains.
00:36:40.370 - 00:36:40.566, Speaker C: Right.
00:36:40.588 - 00:36:48.282, Speaker B: And the final thing is it leads to quite nice formulas in continuous time where it can literally give you numbers for how much the AMMS are losing over time.
00:36:48.416 - 00:36:48.874, Speaker C: All right.
00:36:48.912 - 00:36:51.482, Speaker B: I'm like quite early, but all right, done.
00:36:51.536 - 00:36:59.886, Speaker C: Thanks. Is there an obvious reason if you.
00:36:59.908 - 00:37:03.930, Speaker B: Had a very good oracle why you wouldn't want to implement the optimal AMM.
00:37:04.090 - 00:37:05.870, Speaker C: Over the normal AMM?
00:37:07.730 - 00:37:46.234, Speaker B: I think that one thing you might consider is that you face a bit of a trade off in that sort of the closer prices you offer to this, the less the incentive to arbitrage you. So you probably want the arbitrager to keep a little bit and tune that to enough so they actually want to do that. But in some sense you're kind of getting towards the same place and kind of keeping more money. So yeah, I think you would want to do that. If you don't have you stick an oracle in and you expose yourself to all kinds of oracle attacks. So assuming those away, I don't see any reason not to do that. It's not a new idea.
00:37:46.234 - 00:37:58.442, Speaker B: I think the idea that sort of if you had an oracle you should be trading at that you should be using external prices as inputs is an old idea. I think, like the magic at some level of the simple AMM is that you can market make without seeing prices.
00:37:58.506 - 00:37:58.782, Speaker C: Right.
00:37:58.836 - 00:38:00.106, Speaker B: But the thing is you see prices.
00:38:00.138 - 00:38:01.040, Speaker C: You can do better.
00:38:03.190 - 00:38:08.290, Speaker D: So do you think arbitrages kind of reduce price variance somewhat?
00:38:08.710 - 00:38:12.340, Speaker B: In this model they do not. In this model they do not.
00:38:13.830 - 00:38:15.842, Speaker D: Sorry, go, continue.
00:38:15.896 - 00:38:23.842, Speaker B: First, in this model they do not because there is no general equilibrium and price volatility is fully exogenous at binance price volatility.
00:38:23.986 - 00:38:35.654, Speaker D: But you could imagine that one of the roles they play in general equilibrium is that and so once you consider mean variance utility, there is the risk component that they are reducing.
00:38:35.782 - 00:38:48.046, Speaker B: But that's a way of thinking. Arbitragers play a systemically important role in the ecosystem and the same arbitragers need to be capitalized and we're feeding them money that helps them stabilize the ecosystem. I agree with you, a train of thought like that goes through.
00:38:48.068 - 00:38:51.134, Speaker D: It's just a different interpretation of just the same thing.
00:38:51.172 - 00:38:51.614, Speaker C: Right?
00:38:51.732 - 00:39:16.114, Speaker B: In a sense. I mean, the thing is if you have a LaGrange multiplier on the arbitrager's money, that's very positive and you're like, I want to give these guys money, they play a crucial role in the ecosystem. Yeah, that line of thought goes through. I haven't thought about that at first glance. I would not see that as I would vote no on that. But conceivably depending on what they're doing outside in the ecosystem, that could definitely go through. Yeah, there's a universe in which that works, I think.
00:39:16.172 - 00:39:16.780, Speaker C: Yeah.
00:39:20.350 - 00:39:58.820, Speaker A: So one possible point of confusion around the name that AEV is catchy but I feel like the concept has nothing to do with blockchains per se. It's true. The reason we care about simple AMM is because of the constraints of the blockchain setting. Whereas nev it's really about transaction ordering. It's really because of the guts of how the infrastructure is implemented. This feels like in a way, this is almost arguably more pure concepts that's independent of the architecture. It's just about different ways of doing marketing, I think.
00:39:59.210 - 00:40:57.114, Speaker B: Yes, and I think in some sense I intended that way for the following reason. This is essentially identical to Eric Buddhist's work on HFT sniping, which is that if you replace this with a limit order book but a really dumb limit order book which also didn't update in response to prices and then this guy updated when the arbitrager sniped it same economic effect. So I kind of got here by sort of noticing that sort of the convergence Arbitrage on AMMS is qualitatively the same thing as Sniping sort of discrepancies between different exchange prices. So sort of I am in principle okay with this being used to refer both to that on AMMS and that on centralized exchanges. Yeah, but I agree that if one wants to do another way to say that is that one then asks the question is it really an economically different thing? What's happening on decentralized exchanges versus dumb centralized exchanges? I think I would currently lean towards no, it's actually the same thing. Like if you don't update, somebody's going to update it for you and then there's a loss from that.
00:40:57.152 - 00:41:23.570, Speaker A: Yeah, but maybe it's different from like mev, I feel like is not a purely economic yes, or it is, but it's kind of somehow like I said, they'll get intertwined with the way blockchain at least right now. Whereas this feels more like it kind of feels like it's clear that like ten years from now this is still a sort of basic notion. Whereas because we don't know if blockchain architecture.
00:41:28.470 - 00:41:31.314, Speaker B: But yeah, I mean, the AEV is a marketing choice and not by.
00:41:31.352 - 00:41:31.940, Speaker C: B.
00:41:34.630 - 00:42:03.534, Speaker E: I don't know if I heard you correctly, but I feel like I heard maybe a couple of times you made the comment that how much the arbitrager makes doesn't necessarily depend on the size of the price movement. So for example, if it moves one direction, you might not make money. If it sort of continuously goes in one direction I think there is a nuance there where it does depend on very much on the volatility that in your formulas. I mean, basically your AEV is kind of like the payoff of a variance swap, in fact.
00:42:03.572 - 00:42:03.966, Speaker C: Right.
00:42:04.068 - 00:42:10.522, Speaker E: So it actually has an extreme dependence on volatility if volatility jumps or falls.
00:42:10.666 - 00:42:14.702, Speaker B: Yeah. In the continuous time model you accrue this stuff at a continuous flow rate.
00:42:14.756 - 00:42:14.974, Speaker C: Yeah.
00:42:15.012 - 00:42:38.620, Speaker B: So sort of in the discrete time model I sort of work like my definition works. I think in both cases, discrete and continuous time. A more accurate statement would be in the discrete time model. It doesn't depend on that statement. Holds in the discrete time model and continuous time due to the nature of geometric brownian motion. Yeah, like instantaneous law determines instantaneous AV. Yeah, it should have been more precise on that.
00:42:39.950 - 00:42:40.314, Speaker C: Great.
00:42:40.352 - 00:42:41.580, Speaker B: Thanks a lot. Yeah.
