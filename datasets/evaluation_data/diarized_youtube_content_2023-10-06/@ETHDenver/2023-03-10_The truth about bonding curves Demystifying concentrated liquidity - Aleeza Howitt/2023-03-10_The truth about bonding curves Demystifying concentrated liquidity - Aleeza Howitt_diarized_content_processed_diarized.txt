00:00:13.130 - 00:00:40.730, Speaker A: Hi everyone, my name is Elisa. I'm here from Shell protocol. This is Jess. She is also an engineer from Shell protocol. And we are here to tell you the truth about amms demystifying concentrated liquidity. This talk is a layperson's introduction to amms and concentrated liquidity. First, we're going to go over how amms work.
00:00:40.730 - 00:01:27.740, Speaker A: We're going to talk about impermanent loss and how they relate to concentrated liquidity, or how it relates to concentrated liquidity. And finally, we're going to take a look into the future of Amms. So if you don't make it through this entire talk. Here we go. The TLDR Amms are riskier for retail lps than we'd like to think. Concentrated liquidity increases fee revenue for lps, but it exacerbates impermanent loss and it's ultimately harmful for most liquidity providers. So we need to think critically about how we use amms so that we stop harming l peers, keep liquidity in the system, and ensure that DeFi is sustainable.
00:01:27.740 - 00:02:15.868, Speaker A: I wanted to show you guys this quote that I kind of love from the balancer. White paper balancer. So it goes. Balancer turns the concept of an index fund on its head. Instead of paying fees to portfolio managers to rebalance your portfolio, you collect fees from traders who rebalance your portfolio by following arbitrage opportunities. So this sounds great, but in reality, the arbitragers are dumping on you. As shown by this popular meme on crypto Twitter amms are in fact losing money.
00:02:15.868 - 00:02:55.400, Speaker A: There was a recent analysis on Uniswap that showed a negative 30% average ROI. So basically, for every dollar deposited lps lost, analysis estimated that the USDC ETH pool had 100 million of toxic order flow. All right, so let's just start at the beginning. Quick background on Amms. First came the order book. Order books are pretty simple. They list buy and sell orders for bid, ask prices that are added manually by traders.
00:02:55.400 - 00:03:54.190, Speaker A: One of the big problems with them in the crypto world is that they require an intermediary. So automated market makers is actually a pretty general term. It's been used for a couple of decades, but these determine prices algorithmically, and they're really important because amms on blockchains allow you to. So first of all, bypass intermediaries, and they're great for bootstrapping, liquidity for small tokens, especially ERC twenty s with low liquidity. Anything hard to get listed on an exchange, decentralized exchange. And let's go one step further and consider the idea of a decentralized, automated market maker. So, really, an amm probably shouldn't have any sort of centralized source for price data.
00:03:54.190 - 00:04:09.120, Speaker A: So no intermediaries, as I said. And presumably a good Amm lives on a quality blockchain, too, so it's relatively censorship resistant, and no intermediaries can shut down your transaction.
00:04:11.480 - 00:04:12.230, Speaker B: So.
00:04:14.040 - 00:05:04.020, Speaker A: I want to help you get an intuition for how amms work if you are not a math person or a finance person, and not a crypto person. An Amm is basically a market making robot entrusted with an inventory of assets. So, for example, us dollars and ETH. Now, this robot is a very simple robot. It doesn't know or care about the world, about real world prices. The only thing it knows about is the contents of its own inventory. So how could it possibly determine the correct exchange rate between these assets that it's holding? Well, it uses math that is programmed into it to determine the exchange ratios of the tokens that it's holding.
00:05:04.020 - 00:05:51.520, Speaker A: For a very simple example, suppose Robert has $100 and 100 ETH, and it's 2015. So the rate is. The exchange rate is one dollars to one ETH. Alice swaps one dollars for one ETH, and now the robot has $99 and 101 ETH. So imagine, and math might not be great here, but imagine that the rate now changes to $99 to 101 east. Now, an arbitrage trader can come along and swap one e back for one dollars, which resets the price for the Amm. And it also is a good deal for that arbitrage trader who just made a profit.
00:05:51.520 - 00:06:27.710, Speaker A: All right, intro to bonding curves. So the problem is that basically, the ratio of ETH to USDC changes when you make a swap. The exchange rate will change on a Sliding scale. The bigger the swap, the bigger the change in exchange rate. This is also called price impact. How do you calculate the change in exchange rate? Well, you use a bonding curve or a pricing curve. This is very similar to an endurance curve in economics, if you're familiar with that.
00:06:27.710 - 00:07:02.196, Speaker A: And a popular example of a very common bonding curve that you find everywhere is the constant product curve. So this one's pretty simple. Also, the formula is x, y equals k, or x times y equals k. And here, x and y would be the two assets that you've got in your inventory. So it could be ETh and USDC or dollars and euros or whatever you want. And k is the constant. It's also known as the invariant.
00:07:02.196 - 00:08:05.630, Speaker A: And here is a little graph of a bonding curve that we'll get back to later. All right, so how does the amm get its inventory of tokens? Well, it gets them from liquidity providers like you and me. Or hypothetically, why on earth would you provide liquidity to the amm? Why would you entrust your tokens to this very simple robot? Well, hypothetically, you're going to earn fees from traders. You'll also sometimes earn extra incentives provided by a protocol. Each time a trade occurs through the amm, the pool, or the liquidity providers collect a fee, usually on the order of a few basis points. The pool keeps this money and then divides it up among the l peers. So what's the catch? Well, as stated earlier, you're probably going to lose money.
00:08:05.630 - 00:08:53.020, Speaker A: So the robot, the amm, doesn't know real world prices, and it's slower than tradfi because it's on a blockchain. In other words, it's always going to be a step behind l peers are basically through the amm. They're always buying high and selling low. That is the major. So you may have heard the term floating around, impermanent loss. This is the opportunity cost of keeping your assets in an LP position instead of holding them, huddling them. This happens when the price of the tokens deviate from when you originally LP'd.
00:08:53.020 - 00:09:10.640, Speaker A: So you might still make money while suffering from impermanent loss through fees, but you're going to make less money than if you just kept your tokens in the first place. I'll turn it over to Jeff.
00:09:13.300 - 00:09:40.430, Speaker B: Hey, I'm bad at words and good at graphs, so I'll try my best to walk you through this. So, by way of example, we're going to talk about impermanent loss. Let's say that you are an LP in a balanced pool. So right now, this pool that I've arbitrarily put together has token X and token Y. There's 40 of each. You have decided to put in four X and four Y. The price, because it's balanced, is that one x is equal to one Y.
00:09:40.430 - 00:10:10.084, Speaker B: If you're a math person, you can tell the price by the instantaneous derivative at whatever the point is. So the change rate there, if you were to swap one x, it equal one Y. If you wanted to calculate your initial value of your portfolio, well, you put in four X and four Y. They're each equal to one. So omitting units right now, your value would be eight. The total pool value is 40 plus 40 or 80. You own eight, you own 8% of that.
00:10:10.084 - 00:10:34.428, Speaker B: So when you withdraw your funds, you'll get or 10%. Sorry. When you withdraw your funds, you'll get 10% of the fees of the pool. Let's say now that some time passes and x goes up in value a lot, the price quadruples. It's now worth four Y. As a result, traders have come into the pool. They've bought up all the x and driven the supply down.
00:10:34.428 - 00:10:57.504, Speaker B: So now you're hanging out way up here on the curve, where you have 20 of x and 80 of Y. At this time, you decide to withdraw your money. You are entitled to 10% of the pool. So you get two x and eight Y. Your final portfolio value then is you have the eight Y, that's eight, and then two x. Each of those is worth four Y. You have 16.
00:10:57.504 - 00:11:32.450, Speaker B: Great. You, like, doubled your money. That's awesome. Well, it's awesome until you consider what your value would have been if you had just held the coins in the first place. So if you just held onto that four X and the four Y, you'd have the four Y and then 16 four times four, so you'd have a value of 20. So by just simply lping into the pool and hanging out, you lost 20% of your potential profits, which, unfortunately is true, no matter how the price deviates, if there's any deviation in price from when you LP, you're going to lose money via impermanent loss. There we go.
00:11:32.450 - 00:12:10.270, Speaker B: So, on this graph, the holding price of your tokens, or your value, is represented on the red line. And if you were to LP, that's the blue line. The space in between represents impermanent loss. So, we made this assuming that you LP'd when the price was three. So at any change, you can see your impermanent loss there. This maybe is a duh slide, but lps are only profitable when the fees you make outweigh the impermanent loss. And our job, as Defi protocols, is to make sure that that happens and to figure out ways to improve the ods of that.
00:12:10.270 - 00:12:56.280, Speaker B: So, in the last few years, that's been a subject of great debate. The first attempt was to try and address this issue of capital inefficiency, and I'll try and walk through that and talk about how we've addressed it so people realize that, okay, well, a lot of these assets are pretty tightly correlated. A lot of the trades are happening over just like, a small band of prices. So if you look at your bonding curve, let's say, most of the time, the trades are happening within this 10%. Well, when you LP, you LP into all of it. So your liquidity is spread over 100% of the curve, but you're only collecting fees on the 10% that the trades are happening in. That's what we call capital inefficiency.
00:12:56.280 - 00:13:37.476, Speaker B: Uniswap's big innovation with their v three was to concentrate the liquidity and improve the capital efficiency. Basically they said, okay, well, lps. Now, instead of putting your liquidity everywhere, you can pick the two bands where you put your prices. The two price bands where you put your liquidity. So instead of spreading it everywhere, let's say instead of putting $100 over the whole curve, you can put $10 in between the two prices where you think most of the trades are going to happen. And if indeed most of the trades happen there, you could make the same amount in fees using that $10 as you would of investing the whole 100. This is called leveraged liquidity.
00:13:37.476 - 00:14:20.416, Speaker B: The idea behind this is that if you increase the efficiency and leverage your liquidity, you'll make more money in fees, but also the traders will get better swap rates, leading to more trade volume. Then there's a virtuous cycle where you get more fees from that too. Important caveats is that you don't make any money when the prices deviate from the bounds that you've set. So if you are familiar with Uniswap, maybe you've seen this before. I just took a screenshot, like last night, but this is the ETh USDC pool. This is the typical or the liquidity distribution at the time I took the screenshot. You can see those two really tall blue lines.
00:14:20.416 - 00:14:49.020, Speaker B: That's where most of the liquidity providers have chosen to put their liquidity. At the time I took the screenshot, the price is this. It's kind of hard to see. It's this tiny little pink dot over here. So it's outside of that band. So if you were unfortunate enough to have your liquidity in that big blue block and not over there, you wouldn't be making any money. And furthermore, you would be losing a ton to impermanent loss, because all of your assets would be tied up in the underperforming asset.
00:14:49.020 - 00:15:30.904, Speaker B: Indeed, the math checks out on this when you graph it. You can see here, the dashed line represents uniswap V two, and most constant product amns, and their impermanent loss with prices. The bold line is uniswap V three. The red in between is just some arbitrary price boundaries that I put there, but you can see that with any price deviation, you're actually losing more to impermanent loss. With concentrated liquidity, where does the money go? Well, if you're losing money, someone else is gaining money. I call that the law of conservation of money. And if it's not going to you, it's going to arbitrage traders.
00:15:30.904 - 00:16:12.084, Speaker B: So there we go. To summarize pros and cons of concentrated liquidity. Concentrated liquidity actually does work great if you can accurately predict where the price is going to go, if the assets are stable or highly correlated. It's also super profitable for highly engaged lps, like those providing just in time liquidity and traders get better swap rates. But it comes at the expense of someone else, and usually that someone else is the liquidity provider. Indeed, the research has shown this to be the case. The caveat to this is this is like a super nascent science, and no one can agree on how best to measure profit and loss.
00:16:12.084 - 00:16:46.496, Speaker B: And everyone has a different idea. But most analysis show that nearly all retail lps are losing money by providing liquidity and concentrated liquidity pools. I really like this graph, because it was the most intuitive to me. I think a bancorp did this analysis in 2021. They analyzed, these are a bunch of different trading pools here on the x axis. And the fees collected in those pools are represented by the blue lines. The impermanent loss is represented by the orange lines.
00:16:46.496 - 00:17:15.128, Speaker B: So you can see in nearly every single pool, impermanent loss outweighs fees. This is just a bunch of screenshots of the intense Internet debate about the best way to measure impermanent loss. But you can see most all the lines are going down. That's bad for us. So, to recap, amms have an existential problem. Fees are not enough to outweigh impermanent loss. Soon enough, lps are going to get wise to this and realize they're playing a losing game, and they're going to withdraw their liquidity.
00:17:15.128 - 00:17:40.756, Speaker B: No liquidity means no defi. So to make defi sustainable, we got to fix this. Experts have been talking about this recently. These are not our ideas, but we think they're really interesting. One, maybe we could charge premiums for arbitragers to have exclusive access to the pool. Here's a graph that our CEO put together of that. Maybe it would look something like this.
00:17:40.756 - 00:18:20.864, Speaker B: Maybe we could charge dynamic fees, identify the arbitragers, and charge them more. Maybe we can rethink when and where we use amms. Maybe how we're using them is not actually the best use case. Maybe there are different bonding curve shapes, and maybe there's just a way to get pools that have less arbitragers in them. I'll walk through a few of those. In our last minute and a half crocswap, they put a really interesting medium article out where they basically said, okay, well, based on our analysis, it's possible to figure out who's an arbitrager and who's not. Swap size, among many other things, is one of the ways you can identify who it is.
00:18:20.864 - 00:18:57.852, Speaker B: So what if we just find those people and charge them more? They also posed this other idea, which is, well, maybe uniswap is so good, maybe there's such low slippage that arbitragers are not disincentivized. There's not enough price impact. So maybe we deliberately increase slippage to disincentivize arbitrage. This professor, Alexander Nezloben, by the way, he has this really awesome medium article series. I highly recommend it. It taught me a ton. I loved this idea of his, which is real.
00:18:57.852 - 00:19:29.370, Speaker B: Let's think of an amm, more like an order book. What if we created a dynamically evolving curve? We could change the curve in response not only to time passing, but also to trades and reduce the bid. Ask spread our solution. Well, we don't know the right answer. In fact, we don't even really know the right question to be asking. But we think this is a really important question to work together on to improve this ecosystem. We know that it can only be solved with empirical data that we need to test a whole bunch of these ideas and just see what works.
00:19:29.370 - 00:19:58.892, Speaker B: So we have been working on Proteus, which is an AMM engine. It's just basically a way to build a super, super flexible amm and test out a whole bunch of these ideas. It can generate bonding curves of any shape. Those can change dynamically in response to trades or over time. You can include fees dynamically, or you can include fees statically. And we're just excited to talk and collaborate more. We think it's an important issue and we realize defi is kind of at risk if we don't work together on this.
00:19:58.892 - 00:20:02.660, Speaker B: So thanks for listening. With that all closed.
00:20:09.980 - 00:20:10.710, Speaker A: We are over.
