00:00:00.170 - 00:00:52.170, Speaker A: What you're about to see is part of office hours. It's an addendum to the uniswap twelve days of Dune program that we've been running, and it's just me covering MeV, going deeper into explaining what Mev is, and extending the query we did on MeV for problem four. Hope you enjoy. All right, so the MeV tables, I think it definitely can be confusing thing to try to figure out what these different things mean here. So, the symbols, they're a little small and hard to see, but you'll see there's like a symbol next to each of these kind of names. So if you see this three stair kind of symbol, that means it's like a decoded table, which means this is like a decoded project. So this corresponds to some contract on chain.
00:00:52.170 - 00:01:17.192, Speaker A: Figure out which one by just looking at. Okay, this is the contract address. No idea what it is. Some MEV rewards sensei stake thing. So that would be a decoded project. So same with Mev distributor, Mev Army, Mev. Like, these are all just, this is the contract name, and this is the namespace.
00:01:17.192 - 00:01:58.212, Speaker A: If you were to submit a contract for decoding, like this one, it's already decoded, but if I resubmit it, you enter a project name and then the contract name. So in this case, they put the namespace as MeV, and then the contract name is Mev one. It's a little confusing, but these are all submitted, so these all represent contracts on chain. If you see this, like, cloud image, that means this is a community data set. So this comes from flashbots. They have their own database where they keep things, and we essentially read from the database. So this is about MEV transactions, at least MEV transactions that use flashbots.
00:01:58.212 - 00:02:44.340, Speaker A: Obviously, there's many different ways and services to submit a MEV transaction. You don't have to use flashbots, even though I think they are like 80% of the market. This is a MEV transaction, and they have some types and protocols involved and whatnot. So this is something that we could have leveraged, actually, you have these wand emojis on the side. So these are spells. Spells are a little more confusing because they could be made from queries that build off of different tables, such as Dex trades builds off of Uniswap. However, they could also be just like what are called seed files or Excel files, essentially, or not Excel files, but like comma, CSV, comma, separated value files.
00:02:44.340 - 00:03:08.252, Speaker A: To figure out what it is, you have to go into spellbook. So searching up Spellbook GitHub, dune. You'll see this repo here, which I will put in the chat. So you'll see that spellbook is here. You're going to want to click into models. Don't worry about anything else here. And then you look for, okay, this has the namespace of labels.
00:03:08.252 - 00:03:35.204, Speaker A: I'm going to control F. And I'll see, oh, labels is right here. So I can click into it. And then I'll see all of these other folders and then I can look back and say, oh, this is labels Mev Ethereum. So let me just search up mev Ethereum and I'll see that there is no mev Ethereum, but there is a meV. So in this case it's easy to find. I just click in here and then click the SQL file.
00:03:35.204 - 00:04:10.436, Speaker A: Don't care about whatever other files are in here, just click the SQl one and you'll see, oh, this is literally like a comma separated value sheet where Hildebee took the MeV labeled addresses from Etherscan, because Etherscan took a first pass at labeling them and he's labeled them as the address. And the fact that it is a MEV contract. So that is what creates this labels mev Ethereum table. You can find it here. Labels mev Ethereum. You also see there's addresses Mev. So then I'm going to go back and try to figure out what this is.
00:04:10.436 - 00:04:54.352, Speaker A: I go back to models. I see that there's an addresses folder, there's Ethereum and optimism, which I'm just going to look here and I'm going to see the Ethereum symbol. So I'm like, all right, I'm looking in the Ethereum folder and then there's a bunch of these here, but the one I want is addresses Ethereum meth. In this case, this is also hildeby. This was probably made before the other labels table was created. And this is just all of the addresses they should match. The other table depends on if anyone's been updating the other table, but yeah, so in this case, MeV Ethereum is just like a higher fidelity data set than MeV, and higher fidelity in terms of it has more columns, whereas addresses is literally just an address column.
00:04:54.352 - 00:05:29.160, Speaker A: Flashbots. MEV is the community supply data set where flashbots basically gives us the data they track on MEV bundles and put it into our database. And then these other ones here with the three lines next to it, these are decoded contracts. And if there's nothing in front of it, then it's a contract. That was a lot, but hopefully that helps you better understand. Oh, why I searched MeV. Why are there so many different options? I see a chat.
00:05:29.160 - 00:06:36.684, Speaker A: Cool, great. Yeah. Hope that's. Yeah. Any other questions? Give it a minute while we wait is actually something I'm curious about. All right, if there's no questions, let's just look into MeV a little further. So who here doesn't know what Mev is or knows what it is? Does anyone know what it is? Let me just put it that way.
00:06:36.684 - 00:06:48.656, Speaker A: I don't know what it is. No. People don't know what it is. Yeah, I don't. All right. Steal people's gas money. Yeah.
00:06:48.656 - 00:07:27.176, Speaker A: That's not wrong. Yeah. So let's say that there's an arbitrage opportunity, right, where the price of USDC ETH on sushiswap is lower than it is on uniswap. In that case, someone can buy ETH from sushi, swap and then sell it to the uniswap pool and basically make money on the difference. So that's arbitrage that already exists in financial markets, generally outside of web3. However, if you're looking for these opportunities and you find one, you're probably not the only one that found it. There's many other people who are searching for these arbitrage opportunities.
00:07:27.176 - 00:08:10.788, Speaker A: So there's essentially a race condition, right? So if five people see this arbitrage opportunity and they all try to trade into it, only one person can actually realize the arbitrage, right. The other four, by the time their transactions go through, the arbitrage has already been had. So they're basically like, not making any money and just spending gas. Right? Does that make sense? So far, there's five people trying to do an arbitrage. Only one person can actually get the profit. Cool. So if you don't know how gas works, gas on Ethereum is a fee you pay per transaction, and there's like a minimum fee that you have to pay just to get your transaction considered for a block.
00:08:10.788 - 00:08:48.230, Speaker A: And that's, like, hard set, essentially decided upon by the gas demand in the last few blocks. I won't go too much into that. But then you also have a priority fee. And what you used to be able to do is essentially if you want to get your transaction ahead of others, you pay a higher priority fee, right. So essentially you pay a higher gas price so that the miner or validator is more likely to accept your transaction over other transactions in general, and especially if it's the same type. So then you have minor extractable value. Yeah.
00:08:48.230 - 00:09:13.224, Speaker A: When you submit your transaction, it goes into this queue. Right. And then miners or validators, now, after staking or after E 2.0, they essentially pick up transactions from the pool and put it into blocks. That's why sometimes your transaction can sit around for a while, if it hasn't been picked up yet, to be put in a block. They used to call them miners. I think people still just call them miners.
00:09:13.224 - 00:09:34.032, Speaker A: Now it's validators. But essentially there's someone who is picking up transactions and fitting them into a block. And blocks have a limit in terms of how many transactions can fit in it. And also there's an ordering to the transactions. Right. It's not like all the transactions are parallel processed. There's a transaction index basically within each block.
00:09:34.032 - 00:10:25.670, Speaker A: And so if you see an arbitrage opportunity and you want to get in the next block and you want to be at a higher transaction index, basically being first, you have to pay a higher fee. And what fee are you willing to pay? Technically, you should be willing to pay a fee up to the full amount of the profit that you are going to make. Right. In practice, it's not that extractive, but in a sense, you're supposed to be like, all right, if I was going to make $80 from this profit, I'm willing to pay $60 worth of gas, like priority fee to get into the block. Right. So the miner or validator is extracting value from the bot arbitrator. Does that make sense so far? I see one, yes.
00:10:25.670 - 00:10:49.124, Speaker A: If you're lost, don't be scared to tell me you're lost. Cool. I see. Thumbs up. I see, yes. Great. Basically, you can think of it as every time you submit a transaction, there's like dozens of bots watching you and watching your transaction to see if there's some money that can be made off of it.
00:10:49.124 - 00:11:30.336, Speaker A: Right? So then you have something called front running, which is essentially if you're putting in a very large swap, a bot can basically buy from the pool. So let's say you're buying like ETH or something, and you think you're getting at a certain price. If someone really quickly sells essentially to the pool or buys from the pool and basically sells it back to you, they can front run you and you're paying a much higher price. That is also an example of MEV, but that's front running. That's not arbitrage. Minting NFTs from auctions used to also be MEV because you would want to be the one who gets to mint an NFT first. So that's why gas prices would always spike during NFT auctions.
00:11:30.336 - 00:12:01.772, Speaker A: These are all examples of MeV. Right? So in a nutshell, that is what MEV is. It's people competing to be first to some sort of transaction, target or execution. Again, it's not changed. It's changed a lot since staking like proof of stake went live. But the idea is still the same in terms of you're paying validators some amount of your profit. You're basically profit sharing so that you can be the one to get your transaction in first.
00:12:01.772 - 00:12:46.280, Speaker A: Now, obviously, people also do things where it's okay if I'm not first, then I don't want my transaction to go through. And then there's, like, different privacy issues in terms of you tell the validator what you want to do or what arbitrage you're willing to pay for. The validator could just steal that from you, right? And so you're providing them with information, and then they're going to execute it themselves, and you get no profit at all. So there's whole systems built around securing this and making it easy to bribe validators. It's an extremely intense and intricate ecosystem, and flashbots is one of the players that help with that. And that's why they have so much data around arbitrage and MeV in general. So their data set is in Ethereum.
00:12:46.280 - 00:13:21.752, Speaker A: Right. So if I do select distinct on type here, you'll see there's arbitrage and there's liquidation as the main data types. So, liquidation is a lot of this is getting technical, but there is a lot of vaults where you have to hold a certain collateral value. And if your collateral value goes below the loan, then your collateral is auctioned off at some discount, normally 5% to 10%. So that's also like someone has to fight to be first to get that liquidation. Mev, it doesn't look like they have things for, like, NFTs or auctions or whatnot. Yet, and someone's going to ask this.
00:13:21.752 - 00:13:53.520, Speaker A: You can't tell that a transaction was a MEV transaction based off of just, like, the transactions table, at least not to my knowledge, because the bribe is paid separately. You'll sometimes see a MEV transaction, they paid zero gas fees in a sense, because they paid the miner through the back channel. And there's ways you might be able to track that. But anyways, it's complicated. If someone wants to look into that, please do. I haven't dove that deep into it, but, yeah. So we have arbitrage and liquidation transactions here.
00:13:53.520 - 00:15:15.460, Speaker A: And I see the question I'm going to get to in a second, but something that might be fun to check is does flashbots have MEV contracts that we aren't tracking? So like I might do MS and I left join Ethereum transactions on transaction hash equals Ms transaction hash. And I just want the distinct two right as MeV contract. And I know that the labels Mev Ethereum is already MeV contracts. So I can do, I'm assuming all the etherscan ones are already in the flashbot ones, but I can do like an accept and see. Are we missing any MeV contracts? Are we missing MeV contracts in our labels table? So I'll do missing Mev addresses. Again, this is assuming that the first contract being called in the transaction is the MeV contract, which might not always be accurate, but it should be all right and relax. Finally, getting back to your question, is Dexes have any protection from MeVs? Oh boy.
00:15:15.460 - 00:15:40.582, Speaker A: Yeah. Yes and no. Everyone's trying to protect things at different levels. I think danning at Zero X has a great talk on this. Let me pull it up. Give me 1 second. Cool.
00:15:40.582 - 00:16:33.910, Speaker A: Yeah, so it looks like there's 4000 or so contracts that are likely MeV. This one just has a ton of failed transactions. Let me see, I'll left join on Ethereum transactions where transaction success is true. So we'll run this again and then later I might take this and put a PR into our spellbook so that we can add to it with these labels. But yeah, Amm and Mev is complicated. Any other questions? These are great questions. By the way, feel free to chat your question.
00:16:33.910 - 00:16:56.030, Speaker A: I am going to get some water. Cool. I am back. It looks like there's 4000 contracts here. Are these all met? So this is a contract. There's a successful one here. This is someone's borrowing.
00:16:56.030 - 00:17:42.304, Speaker A: They're swapping through Uniswap V two to they're doing the exact same swap back and forth and then repaying. But I don't think they made money from it, did they? Who's the 0800? Wow, that's an address if I've ever seen one. If I go to the state I can see before and after, they actually lost 0.4 E. So this was not profitable as a mev transaction. And that's something you'll notice. MeV is not easy and a lot of the times so not profitable doing it.
00:17:42.304 - 00:18:34.260, Speaker A: I want to do the accept the other way to see if there's any missing from flashbots. The other way around. There were 133 contracts in labels that weren't in the flashbots. So that's 133 out of 300. So if we want everything, we should just do a union all. And I am curious, actually, because we join by labels here, right? So what if I did all Mav as and I join on? So, in this one, we had allmev Mev contract equals the contract interacted. So I'm using all Mev as our labels instead of just the labels.
00:18:34.260 - 00:19:01.888, Speaker A: And then I need to change this. So I'm going to comment this out and let's do am Mevcontract is null, then it's not. So remember here. Let's just take a look. Now, if 84.2 million is not Mev, 94.6 million is Mev on eleven seven.
00:19:01.888 - 00:19:28.452, Speaker A: Let's just remember that. Actually, I'm going to take a picture because I have bad memory. Let's just hang on to this. And I'm going to rerun this so we can take a look at this mev where it looks like now most of the volume is Mev, but this value is not correct because it doesn't sum to what it did before. So we're going to come back to that. The error is, I did a union all instead of a union. Union all gives me everything, including duplicates.
00:19:28.452 - 00:19:45.970, Speaker A: I don't want duplicates. So I need to not have the all in here. So this is going to give me all addresses here and all addresses here and do a distinct on it. And that should give us the right answer without duplicates. Yeah. So it ran this time. Let's see.
00:19:45.970 - 00:20:34.796, Speaker A: Does this match up? This adds up to 178.8, which is what this adds up to as well. But you'll see that now we are a lot higher in terms of number of MEV addresses. This is now saying it's like, I can't do the percentages. Where were we November 7? November 7 is 85% MeV, not just 15 point, not just. What was it before? Like 50%? So, this just goes to show you again, this might not be 100% accurate, because there might be MEV transactions where it wasn't a MEV contract called at the top, but it should be, because I don't know of any other way you can do it besides maybe putting it together yourself in fruit combo or something. But I don't think fruit combo drives that much volume.
00:20:34.796 - 00:20:59.050, Speaker A: If you don't know what that is, don't worry about it. Yeah. So by this measure, we're looking at close to 85% MeV sometimes 95% by day. That's pretty crazy if you think about it, that much of transactions is like that much of transaction volume because this actually doesn't apply to the number of swaps. And that's something we're going to look at on Saturday. The percentage is so high. That's pretty crazy.
00:20:59.050 - 00:21:35.674, Speaker A: Yeah, I mean, this was a pretty deep dive into Mev. A lot of people call it the dark Forest. If you haven't read Sam McSon's dark Forest paper or essay, please read it. It's very informative. Yeah, highly recommend you check it out. I should explain what it means. He essentially wrote a paper where he found that there's a hack on some smart contract.
00:21:35.674 - 00:22:34.274, Speaker A: That's possible, but he can't just, he can't be a white hat and call it himself because Mev, like some bot, might see him making that transaction. And since you can execute, like, you can simulate a transaction before it happens on chain, people can simulate every transaction in the med pool and see how much you're making from it. And if you're making like 9.6 million from a transaction, then they'll mev it by submitting the same transaction, but with a higher gas fee to steal the money. Right. So white hats and flashbots, or like miners and validators work pretty closely together, because if there's a hack, you have to try and make sure that you can securely save the money if you can't pause the contract in time or whatnot. It's a very good story.
00:22:34.274 - 00:23:10.222, Speaker A: You should read it. It's 2020, it's old, but it's still a very good story. He's a great writer. If you haven't seen it yet, you should watch this talk. I'll put it in the chat and then I have notes on another one. Yeah. Amms are a category, right? So they all have different kinds of, quote unquote protections, but there's no way of completely stopping Mev.
00:23:10.222 - 00:23:49.280, Speaker A: There's just like different types of it. Like the front running I was talking about earlier. There might be ways of stopping that, but like, arbitrage is harder to stop unless you have some sort of like on chain price. Oracle, hold on, I'm looking for. Yeah, honestly, I don't know much of that, but there is a great presentation by Alex Stokes I put in here. Where is it? There's a slide on. Where is.
00:23:49.280 - 00:24:22.886, Speaker A: No, no, I scroll to better. Where's better block space. Better block space? Yeah. So there's like extraction smoothing and protection rebates is what's being explored. Let me find the YouTube video for it. Those watching the recording, you just search the name, but I'll put it in the chat as well. Yeah, I think Xerox, they're working on a lot of different protection methods and like, gasless swaps.
00:24:22.886 - 00:24:39.760, Speaker A: Abstractions. Yeah. There's like a of ways you can try to mitigate different issues, but it's still very much a topic under research. And it is unsolved. It's been unsolved for years, but we're getting there. There's some cool solutions. Did this.
