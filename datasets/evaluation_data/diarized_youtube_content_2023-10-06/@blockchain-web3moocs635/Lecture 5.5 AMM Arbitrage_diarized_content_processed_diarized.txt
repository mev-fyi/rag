00:00:00.490 - 00:00:39.958, Speaker A: Welcome back. Next lecture is on AMM arbitrage. Arbitrage is the practice by which different prices on various exchanges, various markets become synchronized. And we'll dive into the details how this is actually possible on various AMMS. So if you look at arbitrage, you have an example here of different markets. These markets are all selling or I mean, they all offer you the possibility to sell or buy a specific asset. For example, here Bitcoin and the US dollar.
00:00:39.958 - 00:01:24.646, Speaker A: And we have in total one, two, three different markets. So the price of Bitcoin to a US dollar might be, for example, one to one here. It might be two to one here. It might be three to one here. So naturally, if you see those prices, what you intuitively would like to do is to, for example, you can purchase a bitcoin on this market because it only costs $1. And then you can go to this market and you can sell it because $1 gives you three bitcoin. So this is basically a very easy example of an arbitrage here.
00:01:24.646 - 00:02:44.110, Speaker A: In this particular instance, we have three markets. So you might be able to do like a cyclic arbitrage. So basically here form a cycle among these exchanges and calculate the optimal distribution of how many coins you should buy where. And this naturally depends also on the liquidity that you find at each of these exchanges. So the deeper the liquidity, the more you can swap, the more you can exchange. If you have very little liquidity, for example, on on this market here, then this discrepancy in price or the arbitrage opportunity might not be as big as you would like it to be. So this is quite an interesting problem where basically every exchange that somehow is exchanging the similar or an overlapping asset with another market will need to deal with, in particular AMMS, where we don't have the order book, right? If you remember, we don't have this order, this order book of bids and asks that meet at some middle price because these orders here are being removed and added ad hoc by market makers.
00:02:44.110 - 00:03:57.646, Speaker A: There's less arbitrage necessary. However, in an AMM, there's no such thing as an order book. So we only have a liquidity pool, as you remember, with asset X and Y. So arbitrage is essential to keep the price because the ratio of asset X of the quantity of asset X over the quantity of asset Y defines the price of this market, right? So this is basically the price that's defined over these assets. And therefore arbitrage is one of the reasons why most of the trading volume, likely most of the trading volume on AMMS nowadays is arbitrage, just the effect of synchronizing prices among various exchanges. So, as I just mentioned, if we have multiple markets with the same asset X and Y, or different markets with various assets, and they can form like a cycle and we have different prices for X and Y, then there's an arbitrage opportunity. So prices are synchronized by so called arbitragers.
00:03:57.646 - 00:05:09.626, Speaker A: These are the actors that create transactions to benefit from an arbitrage opportunity. And they do this because they incentivize to do so because they basically profit from the price difference among these markets, right? Among these, for example, three markets here, and similar to the difference in a limit order book between bids and ask, this is referred to as a spread. So the arbitrators can benefit from the spread. So naturally, this requires to perform at least one transaction, right? You could think that you only want to perform an arbitrage transaction on this market, but this is under the assumption that you already own some of the coins x and Y, and maybe you want to replenish your portfolio. But typically, an arbitrage is done by having like, one transaction that either purchases an asset on one market and sells a market on another. So in these two actions, these are swap actions. They can be all done in a single transaction, ideally.
00:05:09.626 - 00:06:07.300, Speaker A: So in particular, in blockchain based exchanges, what you do is you do the three or N swap transactions. You do them within one transaction. So in this case here, we have three transactions. So swap one, swap two, swap three. And if these are all executing atomically, then you're guaranteed that you get a certain price at the certain execution price, right? Because if you modify the price on this market, then on this market, then on the third market, you're guaranteed that intermittently. So between your actions, between your swap actions, there won't be any state change. So you're not certain about the initial state that your transaction will execute on, but you're certain that once the action number one is executed, action number two and three can execute immediately based on action number one.
00:06:07.300 - 00:07:12.950, Speaker A: So Atomicity or the atomicity of blockchain transactions, here, again, is a very important property, allowing arbitragers to profit in a reasonable manner while being able to, let's say, calculate or estimate the expected revenue. So let's dive into a specific example. So here we have an arbitrage on two markets. So the two markets are the curve Y pool and the curve SUSD pool. So these pools, they host both the same assets. They might host several further assets, but these are not important for this particular detail, for this particular example here. So, most importantly, they host USDC and die, right? So we can do on both exchanges, we can both sell and purchase USDC and die.
00:07:12.950 - 00:07:50.658, Speaker A: Now, the first action of the arbitrage transaction, so there are two actions in this one arbitrage transaction that the arbitrage is performing is that he's exchanging 2.48 million USDC for 2.28 million die, okay? So it's a stable coin swap. So the exchange rate between those two coins is nearly one, but it's not one. And here we're speaking about relatively significant volumes on the order of millions of US. Dollars. So the price here is 1.1
00:07:50.658 - 00:08:22.282, Speaker A: USDC per die. And interestingly, the price of USDC over die is higher. It's higher by 0.8 USDC over die when compared to the other market, when compared to the curve y pool market. So, and this discrepancy here, this eight discrepancy creates an arbitrage opportunity. And that's what the arbitrage is basically aiming for. So he started his arbitrage with USDC, he exchanged it for die.
00:08:22.282 - 00:09:13.680, Speaker A: Now he has die and he's exchanging it back to USDC on this other market. So what he end up, he ends up with is 2.64 million USDC, which is higher than his initial capital. So the overall profit that he gains from this particular arbitrage is a bit more than 16,000 USDC, equivalent to about $16,000. That's a very basic example of an arbitrage. And with only two markets, and naturally you can extend this to N markets, the more markets you're arbitraging out, the higher the gas fees of these transactions naturally become. So there's a certain upper limit based on the blockchain that you're operating on.
00:09:13.680 - 00:10:24.574, Speaker A: So now you might ask, where does this arbitrage actually find? Or how does this arbitrage, how come this arbitrage has access to 2 million USDC? It's a non negligible amount of capital deployed in a particular stable coin. And this is where so called flash loans come into play that we'll be discussing in another lecture in more details. But basically, what a flash loan allows you is that you have a pool of liquidity here that is given by a flash loan provider. And you can borrow two point something million USDC from this pool. Then you can perform the two arbitrage exchange transactions that actions that we have earlier discussed. And by the end of that transaction, you can repay the loan. And in particular here, this dYdX provider is only requiring one way of fee for a flash loan.
00:10:24.574 - 00:11:02.650, Speaker A: So it's nearly free. So this is like about zero US. Dollar. And you can see here it's sufficient to pay back the initial amount that you lent and the arbitrator can realize the profits. So this particular example here that I'm showing is not a fictive example. It's one that we took from the ethereum blockchain in particular. And so this basically should help you to answer your question how to achieve or how to gain access to initial capital to perform arbitrage.
00:11:02.650 - 00:11:50.206, Speaker A: And what's probably the most interesting and intriguing aspect here of DeFi is that anyone can really take this flash loan and perform this arbitrage. So anyone, any one of you who are listening to this lecture is able to basically perform these types of arbitrage. All you have to do is to understand how the DeFi space operates, how to write a smart contract that can perform these two atomic actions within a transaction and borrow the flash loan initially from a flash loan provider. So, thank you very much. I hope you enjoyed listening to this lecture and you're quite keen now and excited to jump in and code up your own Arbitrage bot. Try it out. It is a very competitive game.
00:11:50.206 - 00:12:07.300, Speaker A: There are a lot of nuances. Be aware of front running, of being front run or backrun, even by other traders. Some might replay your transactions, which we will dive into further lectures. It's a very competitive game, but also a very rewarding game if you get it right.
