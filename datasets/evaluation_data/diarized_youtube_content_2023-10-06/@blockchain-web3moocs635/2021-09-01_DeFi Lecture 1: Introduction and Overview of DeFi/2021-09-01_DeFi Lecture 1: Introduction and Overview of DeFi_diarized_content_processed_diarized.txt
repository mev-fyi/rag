00:00:00.410 - 00:00:30.114, Speaker A: Hi, my name is Dong Sung. I'm a professor in computer science at UC Berkeley. Welcome to the class on decentralized finance. This class is top co taut with four other co instructors. Dan from Stanford, arthur from Imperial College London, andrew from UIUC and Christine, also from UC Berkeley. DeFi is an exciting new area. The world is changing fast and the area of DeFi is changing even faster.
00:00:30.114 - 00:01:13.998, Speaker A: We hope together you will enjoy the learning journey of DeFi in this class. Before we talk about DeFi, first let's talk about what is finance? Finance is a broad term. Anything that involves the creation, management and investment of money and financial assets is essentially part of finance. And there are many different types of financial assets and financial instruments. For example, bank deposits, stocks, bonds, loans, derivatives, and so on. A financial asset essentially is a nonphysical asset whose value is derived from a contractual claim. And there are many different types of financial services that we use on a daily basis.
00:01:13.998 - 00:02:01.810, Speaker A: For example, banking, lending, borrowing, insurance funds, and so on. And a financial market is a marketplace for trading financial assets. And first, let's look at how traditionally finance is done. Traditionally, we have centralized financial institutions that provide these financial services to us. There are different types of financial institutions depending on the type of financial services that they provide, such as banks, securities companies, fund management companies and so on. And for more details, you can see title 33 of the United States Code. There are a number of characteristics for these financial institutions.
00:02:01.810 - 00:03:02.994, Speaker A: First, typically the financial institutions hold custodies of customers, funds and assets. For example, my money in my bank account. Essentially, my bank holds custody for them. And the bank has the power to freeze someone's accounts if there is illicit activities, for example. And also these financial institutions, they serve as intermediaries for transactions. For example, if I want to transfer money from my bank account to Dan's bank account, if we use the same bank, then the bank will decrease the balance of my account and increase Dan's account and essentially serve as the intermediary for the transaction. And if Dan uses a different bank, then my bank will communicate with Dan's bank and perform the transaction as intermediaries.
00:03:02.994 - 00:03:38.430, Speaker A: These financial institutions has a lot of power. For example, they can censor the transactions. For example, if the money transfer is a type of money laundering, then the bank may censor the transaction. And also, these financial institutions take fees for providing the financial service. And these financial institutions typically are highly regulated. They need to adhere to strict onboarding and continuous compliance rules. And there are different types of rules and regulations.
00:03:38.430 - 00:05:02.778, Speaker A: For example, KYC know your customer AML anti money laundering and CFT combat the financing of terrorism. As you can see here, as a consequence of how these financial services are provided, the customers usually have no privacy to the service providers. So, for example, my bank knows my real identity and also knows the full account transaction information from my account. But however, to the customers, the financial services are very opaque and the information and records are kept in Siloed databases and applications. And as a consequence of how financial institutions operate, again, as holding custodies of customers funds and serve as intermediaries for transactions, they essentially need to be fully trusted to operate correctly and securely. So we place a lot of trust on these financial institutions. On November 1, 2008, the famous and anonymous Satoshi Nakamoto released his Bitcoin White Paper and this ushered the world into a new era for public blockchains.
00:05:02.778 - 00:06:42.720, Speaker A: Public blockchains also called distributed ledgers. They are a new type of technology that enables mutually distrusted nodes to come together and collectively maintain an immutable ledger that's open to anyone and that maintains immutable records and transactions. With the birth of Bitcoin, it provided for the first time the capability for users to provide self custody of money, in particular digital currency. In 2014, Ethereum has been proposed as a next generation blockchain platform, in particular a smart contract platform with Turing complete smart contract language. And with Ethereum, it allows different types of applications to run on top of the smart contract platform and has provide the capabilities for the first time for open programmable money and financial assets. And this essentially enabled a new way of doing financial services called decentralized finance. So, what is decentralized finance? Essentially, this is a new type of financial infrastructure as an open permissionless and highly interoperable protocol stack built on top of the public smart contract platform.
00:06:42.720 - 00:08:09.610, Speaker A: And to determine whether a financial application is decentralized as part of DeFi, we can go through a three step determination process, and in particular, looking at three different aspects of the degree of decentralization for the financial application. So first we look at custody and settlement, whether users have full control of their financial assets, in this case, whether they take custody of their financial assets. If not, then that's clearly a DeFi application. And if yes, we go to the next step looking at the transaction execution. Can someone single handedly censor a transaction execution? If yes, then this means that the application uses DeFi settlement, but it has a CFI intermediary. And then the next step we look at is can someone single handedly censor the protocol execution or change the protocol? And if yes, that means this is essentially governed DeFi. And if no, this means this is a fully decentralized finance application, DeFi.
00:08:09.610 - 00:09:35.490, Speaker A: So why do we talk about DeFi? Decentralized Finance so, first let's look at a comparison of the different characteristics between CFI and DeFi. Centralized Finance versus Decentralized Finance so, in traditional centralized finance, it's a permission system. The financial systems are typically closed source and built on top of centralized Siloed databases. And one needs approval and agreement for a third party to use these financial services and build on top and these traditional finance custodial assets are usually custody by these traditional financial services. And the traditional financial services are built on top of centralized trust and governance where the financial service is responsible for making upgrade decisions and has admin privileges. And also to use these financial services one need to provide real identity, for example for KYC and AML compliance reasons. In contrast, decentralized finance DeFi applications and services are permissionless.
00:09:35.490 - 00:11:00.640, Speaker A: They are typically built as open source systems on top of permissionless blockchains and anyone can use on top of these financial services and interoperate with them without needing any third party approval or agreement. And the financial assets are non custodial in DeFi where they are controlled and custody by individual users. And DeFi applications and services are built on top of decentralized trust and governance and they don't require so they don't have any single entity that's responsible for upgrade decisions, are having admin privileges, and are also called trustless. And for DeFi applications, users are pseudonymous and often do not provide their real identities. Given its characteristics, DeFi application services provide a number of advantages over traditional finance. One, they can be more efficient by removing the rent seeking intermediaries. And DeFi enables open finance and universal accessibility where anyone can use the financial services.
00:11:00.640 - 00:12:38.320, Speaker A: DeFi also provides unparalleled transparency and public verifiability. Anyone can inspect the smart contract code and verify its execution and state of the system and hence verify the execution of the financial services. DeFi also enables self custody and hence its censorship resistance, where the users custody their own financial assets and their financial assets in this case cannot be frozen or taken away. DeFi also enables automation and programmability as being built using smart contracts on permissionless blockchains, and with its openness, DeFi also enables unprecedented composability and interoperability. Different DeFi protocols and applications are often considered as Lego building blocks that one can stack up together to build new financial applications. And DeFi is a great playground for fast innovation. DeFi applications often are much simpler and faster to develop than the CFI counterparts and also enables new capabilities such as atomic composabilities that can enable new powers and applications that do not exist in the CFI world.
00:12:38.320 - 00:14:27.918, Speaker A: Given its advantages, DeFi has been growing rapidly by a metric called TVL Total Value Locked, which measures the total value of financial assets deposited and locked in different DeFi applications. We have seen a tremendous growth of the usage of DeFi applications where the TVL has gone over $80 billion and also we see a rapid growth of the total DeFi users over time as well, where we see over 3 million users have been using DeFi applications. So how is DeFi done? What is the DeFi stack? So, DeFi is built on top of a decentralized smart contract platform and within the DeFi ecosystem there are different roles. So first, users use the DeFi application and services and the DeFi service is often implemented as a smart contract and in particular for a DeFi application there are a number of layers. So first at the bottom is the settlement layer. For example transactions are committed on the blockchain which keeps an immutable log of the transaction. On top of the blockchain there is the Slayer which implements the different financial assets.
00:14:27.918 - 00:15:36.294, Speaker A: There are different types of financial assets, one is the native protocol asset, for example Ethereum is ETH. There are also other types of financial assets that are implemented as smart contracts. For example the ERC 20 standard specifies a type of financial asset called fungible tokens. For example a smart contract implementing ERC 20 can maintain the balance of different accounts for this financial asset. Another example is the ERC 721 which specifies standards for nonfungible tokens NFTs. On top of the asset layer is the protocol layer where different types of financial services are implemented. This includes for example decentralized exchanges, decentralized lending onchain asset management and derivatives and so on.
00:15:36.294 - 00:17:11.830, Speaker A: These protocols are implemented as smart contracts and gets executed on the smart contract platform. And on top of this layer is the application layer which is user facing that users can use to interact with the underlying protocol layer. And on top of the application layer is the aggregation layer which can aggregate different applications into one user facing application. For example as a wallet that user uses that can help user to utilize different types of financial DeFi applications and protocols. In addition to the users and DeFi protocols the DeFi applications and also the blockchain also need to interact with the outside world. So for example a blockchain is essentially a distributed database with atomic settlements. It may need to interact with another blockchain which may have other types of financial assets on this other blockchain and this is usually done using a bridge connecting the two different blockchains.
00:17:11.830 - 00:19:28.050, Speaker A: And also the different applications on top of the blockchain may need information from outside world that's off chain, for example it may need pricing information from centralized exchanges or even for example many information about the weather and so on. So Oracle essentially helps provide such information that brings information outside of the blockchain onto the blockchain. And also there's another type of entity that we call keeper essentially is a type of bots that will send trigger events to the blockchain. So for example certain DeFi applications on the blockchain as you will learn in the later part of the class, for example there may be collateral in different application that may need to get liquidated during when certain events happens, for example when token price drops and so on. Such liquidation can be performed by outside entities that we call keeper here that actually send such requests or transactions to the DeFi applications on the blockchain which essentially helps the DeFi application to operate. And of course in this case the DeFi application is designed with the right incentives so that it will incentivize external entities such as keepers to send such transactions and triggers to the DeFi application to make sure that the application properly runs. And in this case we can see that we have the DeFi world and the CFI world essentially can run side to side in parallel and there can be connections between the two.
00:19:28.050 - 00:20:48.358, Speaker A: For example, as we already discussed, Oracle can help bring information in CFI into the DeFi world. And on the other hand, on DeFi certain assets may be reserves of packed assets and such reserve may be kept in the CFI world and hence the CFI and DeFi world has a lot of connections between them. There are different types of DeFi services that have already been built. Essentially any service that you can think of in CFI its counterpart in DeFi exists. For example, there are DeFi services for exchanges and trading, lending, insurance, asset management and so on. So now let's look at a few examples of these DeFi building blocks and services. The first we are going to look at is asset tokenization, which is the core of DeFi how DeFi assets are created tokenization is essentially the process of adding new assets to a blockchain.
00:20:48.358 - 00:22:14.802, Speaker A: And in blockchain token is the key where token is the blockchain representation of the asset. And this token representation makes assets more accessible, easy to transfer and programmable. And there are different types of tokens, for example governance tokens where the token holders of the governance token can vote and to decide the future development and import decisions on the protocol. And there can be security tokens which for example represent tokenized physical assets such as tokenized real estate. And another type of token assets is nonfungible tokens called NFTs. Many of you may have heard about the recent craze on NFTs, so NFTs, these are nonfungible tokens that can represent different types of assets such as music, art and so on. In fall 2017, CryptoKitties created as a game, which is the first explosion of NFTs where these crypto kitties are traded for high prices.
00:22:14.802 - 00:23:28.730, Speaker A: And more recently in March this year, artist people everyday NFT was sold for over $69 million. So NFT has become a new way for arts and for representing art ownership and for trading of art. Another important type of tokens, especially for DeFi services is called stablecoin. So, as you may notice that a lot of the tokens, the treatable tokens, their price can be very volatile. But for a lot of the DeFi applications it needs a type of asset with a stable price and hence motivates the creation of a type of token called stablecoin. So these stablecoins essentially are tokens whose price is packed to certain other types of assets such as fiat and precious metal and so on. And there are different ways for creating stablecoins.
00:23:28.730 - 00:25:13.250, Speaker A: For example, there can be stablecoin can be created using off chain collateral such as off chain fiat or precious metal. It can also be created using onchain collateral, essentially using collateral of onchain crypto assets or they can be non collateral and are purely created using algorithmic methods. And this is a real invention in DeFi that does not exist in the CFI world and in the later part of the class we are going to study in more detail the different types of stablecoins and study their stability or instability and what are good ways for creating stablecoins. Another example of DeFi building blocks and services is decentralized exchanges. So exchanges is a marketplace that allows users to trade different financial assets and traditionally this has been done with centralized exchange. Like any other centralized financial services, a centralized exchange holds custody of users assets and there has been many attacks on centralized crypto exchanges. The most famous one is the attack on Mount Gox in 2014 where over 800,000 bitcoins were stolen and this was valued over 450,000,000 at the time and today it would be valued over $30 billion.
00:25:13.250 - 00:26:29.762, Speaker A: And in year 2019 alone over twelve centralized exchanges have been attacked with over 300 million worth of crypto stolen. And also there can be rock centralized exchanges which simply takes users money away and then disappears. So with these centralized exchanges also there is a lot of nontransparency that users do not know how decentralized exchanges operate. In contrast, decentralized exchanges provide a number of advantages. One is noncustodial users take custody of their assets and two, these decentralized exchanges provide full transparency on how the transactions and trades have happened. Centralized exchanges determines the trade using an order book where sellers and buyers put up their orders that get matched on the centralized exchange and then get settled. Whereas in decentralized exchange there has been a number of innovations that allows different types of order matching to facilitate the trade.
00:26:29.762 - 00:28:10.330, Speaker A: For example, there is standard order book methods but also there is a new type of method called constant function market maker which does not need an auto book. It's also called EMM automated market maker which we will learn more in later part of the class. And also there are other methods such as reserve aggregator and so on. The biggest decentralized exchange so far is Uniswap and over time we have seen that the trading volume decentralized exchange has grown drastically over time. In fall 2020 it was the first time when uniswap's trading volume exceeded the centralized exchange coinbase trading volume. This is a great example that even though decentralized exchange such as Uniswap is built with a much smaller team but however it can be very powerful and with the trading volume exceeds centralized exchange such as Coinbase which is now a publicly listed company with billions of dollars of market cap. The third example of DeFi building block and service that we will see here is decentralized lending.
00:28:10.330 - 00:29:36.518, Speaker A: Lending is an important function in finance where people who have money lends money to people who need money. And an important part of lending is to make sure that the loaned money eventually gets returned and when the loan money fails to be returned. This is called a default. In centralized finance CFI it tries to reduce the rate of default because processing default is very expensive and in case of even when it's fully collateralized and when it's under collateralized, of course the default rate is even more expensive. And hence for lending in DeFi it relies on evaluating the credits for the borrower. In DeFi, the lending is largely done in different ways as collateralized loans, in particular with over collateralization, and also because in DeFi oftentimes entities are pseudonymous and there's no real identity and there's no real credit. And hence lending in DeFi is often not based on credit.
00:29:36.518 - 00:31:09.518, Speaker A: And there are different types of collateralized loans, including collateralized debt positions. So essentially borrowers put up collaterals and use the collateral to create new tokens. For example in MakerDAO's case, another example is collateralized debt markets where borrowers put up collaterals and then borrow funds from lenders as other types of crypto assets and a popular type of collateral debt markets uses pools funds such as in compound and ali and there's new DeFi services that's exploring the lending in underclateralization case as well. Another really fascinating invention in DeFi is called flash loans. So blockchain, unlike the CFI case, has a new capability that ensures atomicity in transactions. In particular, what this means is that the actions within a transaction are executed entirely in sequence or fail collectively. So with this type of atomic transaction capability, blockchains can enable very interesting new capabilities such as flash loans.
00:31:09.518 - 00:33:15.206, Speaker A: So in the flash loans case, a lending service could provide loans without any collateral but within one transaction under the condition that the provided loan are paid back by the end of the transaction plus interest on the lend amounts. Because of the atomicity for transactions, this flash loan can be done in a very secure way because if the borrower at the end of the transactions cannot return the loan plus the interest, then the transaction will fail and the state will revert back just as if the borrower has never borrowed the loan. And the amazing part for this is that this means that without any resource, without any collaterals, anyone can borrow with this flash loan that actually could be very high amount can be millions or even billions of dollars without any upfront costs and this does not exist in CIFI at all. So here is an example flowchart of the flash loan the borrower within one transaction the borrower first take out the flash loan from a loan service and then it uses the borrowed money to go wild. For example, it could use the borrowed money for arbitrage and so on and then at the end repay the loan with interest. So here is a concrete example where the arbitrager borrows a flash loan and then use this loaned amount on the exchange to exchange. For example, it borrows this much USDC and then exchanges this USDC to Dai.
00:33:15.206 - 00:34:42.390, Speaker A: Given the current price of USDC and Dai on this market, and then on another market, it exchanges the Dai into the USDC. Given that there is a difference between the price on the two markets and essentially just performed arbitrage and this arbitrage generated a profit so that at the end of the transaction the arbitrage can return the original flash loan and then keep the remaining as the profit. So these are just a few examples for DeFi building blocks and services and there are many other examples as well. For example, decentralized derivatives derivatives are essentially financial assets whose value is derived from certain underlying assets. And there are different types of derivatives, for example asset based derivatives such as synthetics and mirror that creates derivatives based on for example, stocks. And there can be event based derivatives such as Auger or prediction. These are essentially prediction markets that creates assets based on external events.
00:34:42.390 - 00:35:35.638, Speaker A: Another type of DeFi building block and service is on chain asset management. So this essentially provides asset management to help users to manage different DeFi assets. However, the interesting thing for these asset managements is that it's done on chain as smart contracts different from traditional asset management. And hence these are noncustodial and they can do a lot of different things. They can perform semiautomatic rebalancing of portfolio or even perform for example, trend trading. And there are a number of examples of these on chain asset management such as Yearn and SAP protocol. And another interesting example is decentralized insurance done on chain as well.
00:35:35.638 - 00:36:52.830, Speaker A: And in the rest of the semester we are going to take deeper dives for these different types of DeFi building blocks and services. DeFi provides great innovation and many opportunities, but at the same time there are also many risks in DeFi that we need to be aware. So first let's talk about DeFi security. Given that DeFi runs on a number of layers, essentially there are security issues on all layers, for example, including network layer attacks, consensus layer attacks and smart contracts can have bugs and vulnerabilities. And when we compose DeFi protocols, there can be composability attacks. And as DeFi gets information and communicates from the outside world, there can be breach attacks, Oracle attacks, and given that DeFi is governed in a decentralized fashion, there can be governance attacks as well. And DeFi security is a huge risk in DeFi.
00:36:52.830 - 00:38:23.966, Speaker A: When we talk about DeFi security, essentially there are two different types of security issues that we need to consider. One we call technical structure security or technical security. So these are essentially secure issues risen from the underlying technical vulnerabilities and in the technical structure of the blockchain systems. And often attackers can take the profits in a risk free manner by exploiting these technical vulnerabilities. And another type of DeFi security issue is what we call economic incentive security or economic security. And in these type of security issues, attackers exploit the incentive structure of the protocol to realize unintended profits at the expense of the protocol or its users. In the rest of the semester, in the rest of the class, we will study the details of the different types of DeFi secure issues for example, looking at different types of smart contract vulnerabilities and can be exploited for attacks as well as the economic security issues.
00:38:23.966 - 00:39:46.258, Speaker A: So here is a simple example of a DeFi attack called front running attack. In this case, an adversary observes a transaction on the blockchain, peer to peer network and for example this is a trade, a profitable trade that a user would like to do to make some money. However, given that all the transactions are open in clear text on the PeerToPeer network so attackers could see these transactions before they are committed. So in this case, instead of having the user taking the profitable trade, the attacker then decides to create a transaction that actually front runs the user's trade so that the attacker gets to take the profit. An attacker can do this by paying a higher transaction fee. And given that in a blockchain, for example ethereum the miners mine transactions based on their paid fees. And hence in this case, the miner will execute the attacker's transaction before the user's transaction.
00:39:46.258 - 00:41:25.160, Speaker A: And hence frown run the user's transaction and enable the attacker to be able to take the profit. And similar techniques can also be used for back running a transaction in what's called a sandwich attacks. And in later part of the class you will learn more about different types of such attacks. And these different types of attacks also allows miners to essentially be able to extract more value from the blockchain other than just mining for block rewards. They could perform these different attacks or facilitate attackers to perform different types of attacks. And we call this minor extractable value or blockchain extractable value where the miners and attackers can in this case extract values from the different DeFi applications or other blockchain smart contract applications to extract value from the ecosystem. And we'll also study more about these mevs and seeing that these mevs has become a tremendous amount of value ranging in hundreds of millions of dollars.
00:41:25.160 - 00:42:59.254, Speaker A: Another type of risks in DeFi that want to consider is systemic risks. On one hand, for DeFi, the composability enables great innovation and fast progress in developing new DeFi applications. On the other hand, this type of composability also introduces wide dependencies in DeFi applications. Thus, issues in one DeFi application can quickly cause issues in other DeFi applications as a ripple effect. So for example, in the recent past there has been significant price declines, huge drops on a single day in cryptocurrency and in this case, given crypto assets are used as collateral in many different DeFi applications, such huge price drop can easily cause huge ripple effects causing liquidations, deleveraging and so on in different DeFi applications. To the extent that could destabilize the different DeFi applications and services and causing the price to fall down even further. So in traditional financial markets such as stock markets, it has circuit breakers when the loss becomes too much.
00:42:59.254 - 00:44:53.062, Speaker A: In blockchain and DeFi world, there is no such circuit breaker so far. So this in particular is important for us to further investigate and explore the different ways to reduce systemic risks. There are a number of exciting and important open research challenges one scalability for example currently Ethereum has limited scalability, can only perform about 20 transactions per second and such scalability limitations severely limit the scalability of DeFi applications. As a consequence, today most of these DeFi applications are very expensive to use, oftentimes can cost tens of dollars or even hundreds of dollars to perform a single transaction on these DeFi applications. And hence it's also an important open research challenge to see how we can enable the broader population to utilize these DeFi applications, how we can also make it easier for end users to use these DeFi applications. As I already mentioned, the privacy is another open research challenge in DeFi and in particular how we can enable greater privacy for users and at the same time can also enable regulation, compliance and security is a huge open challenge in DeFi. And as we already discussed, there can be security issues at all layers of the blockchain and DeFi applications.
00:44:53.062 - 00:47:53.418, Speaker A: How can we design and build more secure Oracles to provide authentic and correct information in a timely fashion? On chain protocol and smart contracts can have different vulnerabilities and have been exploited in the past for huge loss to the users and we need to design and develop new program and protocol analysis and formal verification techniques to ensure the security of these DeFi protocols and smart contracts. How can we design and develop new approaches and techniques for better analyzing composability risks and mitigate systemic risks? We also need to develop more effective incentive designs to ensure that the players in the ecosystem have the right incentive to behave properly and minor extractable value is a huge phenomenon in the DeFi ecosystem today how can we design better DeFi applications and services that can reduce these minor extractable values and provide more benefits to users? And governance is a new domain for exploration, for research, how to design better governance mechanisms to ensure that the DeFi application services is decentralized and at the same time can operate properly and be secure. And DeFi area is very new, it's very different from how traditional finance works and there are many open questions for legal and compliance and this is a huge area for open research as well. So overall in this class we hope to help shed light in this interdisciplinary domain at the intersection of computer science and finance and for each financial function we hope to investigate the CFI and DeFi options is either one of these optimal? And we'll evaluate both through the lens of. Computer science and finance? Is the application computable programmable. Is application welfare enhancing and stable? How do the new and old systems interact? We also hope to explore new questions and challenges in regulation and legal frameworks. And there are a number of references and recommended reading for this first lecture.
00:47:53.418 - 00:48:09.060, Speaker A: Thanks for being with us for this first lecture. We hope that you will enjoy the learning journey of DeFi and in the next lecture we will see introduction on blockchain. Thank you.
