00:00:00.570 - 00:00:38.810, Speaker A: Welcome back. This is the decentralized finance lecture. Today we'll be speaking about decentralized exchanges. My name is Arthur and I welcome you. Financial exchanges are ubiquitous services all over the world on all different continents. We have these centralized entities that are creating financial value by bringing together all types of traders and brokers and participants. Whenever you perform a trade, whenever you want to actually exchange financial value, whether you're paying in your home currency or another currency, there's likely an exchange involved in your purchase.
00:00:38.810 - 00:01:34.902, Speaker A: So how do financial exchanges actually function? What is the architecture? What are their components? So let's break them down. So a financial exchange typically has a trade matching engine. So trade matching means that if you have two participants, two or more participants, you want them to find a matching trade, something that they agree on in terms of quantity of assets and in terms of price of assets. So once you found a few trades that are matchable, you do forward them to the trade settlement engine. And this is the place where the assets actually get swapped. So these are the traditionally main components. So we'll be seeing later that the trade matching also contains something like a price finding mechanism.
00:01:34.902 - 00:02:05.342, Speaker A: So that's typically in the trade matching encapsulated. So let's look further here at how this particular mechanism works. So this is really the entire exchange, right? But let's assume now that we have here Alice and Bob, they have each coin on the trade settlement layer. So this is their current possession. These are the current values that they own. So Alice has a black coin and Bob has a white coin. And it seems like they want to trade this.
00:02:05.342 - 00:02:50.094, Speaker A: So Alice will put in an order. An order means she would like to execute an exchange. So she would like to exchange her black coin against a white coin. It so happens in this example that Bob does the same, but in reverse. So he has a white coin and he would like to purchase a black coin. Ideally, here we can see that the quantities are the same, right? Alice and Bob each have one coin, and they would like to exchange it to another coin of another color, and the quantities in both cases equal. So the exchange rate that they are both okay with, that they both agree to, would be one black coin for one white coin.
00:02:50.094 - 00:03:32.110, Speaker A: So one to one. So the price is basically one to one. Now, once these two orders are matched through the trade matching engine, they're forwarded to the trade settlement layer. So the trade settlement here will perform the swap. So you will see this. Now then, at some point, whenever the trade settlement layer settles, the various trades that it's aggregating, the actual assets become swapped in the accounts of the respective traders. So this was the trade matching, right? This was the entire exchange engine basically in full operation.
00:03:32.110 - 00:04:19.470, Speaker A: Let's go into bit more details on the trade matching. So trade matching functions, for example through an order book. So an order book is a very traditional way of aggregating orders. So what you can see here is basically that you have on the left side, you have, for example, Alice and she's like putting in an order. And you can see here that this is quite a significant order, right? And you can also see here that this is on the visual chart of the order book. This is quite a significant amount. So the price that she's willing to here purchase, in this case, this asset is at the price of 418, $0.40.
00:04:19.470 - 00:05:08.960, Speaker A: So in the 418 dollarsforteen cents. So in the other case, we have here Bob, who is willing to sell a few of these coins. It's a bit less, it's only a quantity of 9.5, but he's willing to sell it at a price of 418.41. So these two orders are currently not matching, so they cannot execute because there's no agreement between the bids and the asks or between the selling and the buying order of what should be the price at which we actually perform a trade. And this is also something that you can basically call the spread. So the difference here between the bids and the ask is referred to as the financial spread in an order book.
00:05:08.960 - 00:06:24.630, Speaker A: A term that you will also often encounter is the lob or limit order book. The limit here comes from the fact that the seller or the buyer specifies a limit. So price X at which the buyer or seller is willing to purchase or sell an asset. And that's the kind of the upper bound, the limit that the buyer or seller is willing to agree to. Now, if you look a bit deeper into this order book so you can see here the quantities on the sell side here are rather small compared to at least the prices close to the spread. So if you consider basically, for example, this here in isolation, you could sum up the price and you can sum up the quantities and this will give you a certain sum, a certain amount of value that you can extract or that you're able to trade on this particular market, the more deep the order book is. So by depth we are understanding the quantity here times the price, right? This is basically accumulative quantity.
00:06:24.630 - 00:07:11.670, Speaker A: Times the price is referred to as an order book debt. The deeper an order book is, the better, because the more liquid a market is, meaning the more money this market can provide to you as a trader. So typically we're looking for rather liquid markets because these are efficient and you pay less fees. So just for you to understand these terms that are being used interchangeably also in the traditional finance world. So what are the two order book models? In a blockchain that we can think of, there might be further ones. But let's just discuss here two basic components. So you have the server order book and you have an onchain order book model.
00:07:11.670 - 00:08:26.430, Speaker A: So what are the advantages? So on the server side, if you just operate an order book, on the server side, you have a fast matching, which is great because speed matters. In financial trading, there are no fees for canceled orders, which is great because you can just put in orders, you can cancel them at any point in time and you're not incurring any fees. Now, the drawback, however, is that there's no clear censorship resilience if you have an order book on the server and you can also not prevent the exchange from actually front running your orders, right? So if you put in an order and the server then decides to front run you to put an order in front of your order, then well, first of all, you don't see it, it's not transparent. And second, the adversary might financially profit from your order, which is executed at a later stage. So here it's always important. We're discussing or thinking about what is the threat model, right? What is the adversarial model, what can the adversary do? Always ask yourself, if you look at its solution, what can possibly go wrong? Right? This is like always something that you should ask yourself. So then we have the onchain model.
00:08:26.430 - 00:09:30.286, Speaker A: So in the on chain model, we have quite a few interesting characteristics. So first of all, we have a censorship resilience, right? So this is at least if the smart contract is written in a way that nobody else can censor the protocol, there are no admin keys and so on. Then there's a relatively strong censorship resilience because the blockchain is running possibly much more reliably than a server. It's relatively robust. Obviously you will have some higher fees in exchange for that. So there are few drawbacks which presumably slow matching, right? So the faster or the slower the confirmation latency of your blockchain is, the slower the entire system works. And naturally, for on chain transactions, you must pay a fee to the miners, even if you just want to cancel your order, right? So you can create an order, you can cancel it, you will pay twice the transaction fee.
00:09:30.286 - 00:10:37.400, Speaker A: So that's quite significant depending on how active your blockchain is and how low the fees are. So you're also not immune from front running. So again, right, I mean, we are looking at the adversary model here and we can see, well, another minor, basically a blockchain miner or a blockchain trader or both of them, they could collude even to front run your trades. And this is happening, this is wide practice on existing blockchains already and it's a major issue which is extracting hundreds of millions of US dollars per year from innocent users. So this is certainly something that you should be aware of and that can happen. So I would like to draw your attention to Ether Delta, which was one of the pioneers in this space. So I think this was one of the first, maybe the first, but let's say one of the first decentralized exchanges with an onchain model.
00:10:37.400 - 00:11:47.966, Speaker A: There was still a server that kind of helped the exchange to coordinate trades. But in order to participate in this exchange, the first thing you had to do is here to deposit some amount at the very beginning, right? So you couldn't basically start trading right away from your wallet as you may be used from uniswap or similar AMMS that we will discuss much later. But basically here you're really required to deposit some coins into a contract at the very beginning and you can later trade and then finally you can withdraw these coins again. So this is initial step of depositing assets into a contract and only once they're deposited you can create a buy or sell order. So here you specify the amount, you specify the price and it will calculate you the total costs that this particular order will create. Similarly, here you have the visualization of the order book as we discussed in a previous example. It's a slightly different visual representation, but in essence it explains the same.
00:11:47.966 - 00:12:48.660, Speaker A: So in the middle you have the price, here we have the spread, right? So the spread between this price and this price represents the spread of this particular limit order book. And the quantities are denoted here in this PPT coin for this particular market. In addition, there's some candle bar chart here that you can see and the price to Ether. So it's just an example. What's also interesting is you get here the last executed trades that are helpful obviously to look into. So overall, I mean, Ether Delta was quite a successful exchange. It was one of the most actively used DEXes, but still it didn't get to the same popularity I would say, as for example, binance or centralized exchanges in general.
00:12:48.660 - 00:13:51.890, Speaker A: So what are the lessons learned? So what are the advantages of limit order book decks and what are its disadvantages? So the good, bad and ugly things. So well, some of the advantages certainly was at the time there was no KYC AML requirement when these exchanges existed in the very early stages because these were really new technologies and no regulators had any clear vision of how they should be regulated. To my understanding there were fees pages to exchange. So the market makers who are actually filling the order book, so market makers are putting in orders and taking out orders to serve the market. That's called market making. They are gaining from the fees from the exchange, but there were no fees paid directly to the exchange. An advantage of a limit order book is that there's at least no direct impermanent loss if you just put in an order with a certain limit.
00:13:51.890 - 00:14:37.030, Speaker A: Because you're not a liquidity provider, you're not a market maker. So you're just trying to execute a particular trade and impermanent loss in AMMS will be discussed later in this lecture. So the disadvantages of this model are the following. So certainly we have fees, like an excessive amount of fees for every deposit, withdrawal, trade creation and cancellation. And this is unfortunately affecting a blockchain quite significantly. In particular, if blockchain doesn't have a strong transaction throughput. Right? So that's certainly a problem and something that needs to be addressed somehow.
00:14:37.030 - 00:15:21.390, Speaker A: The slow execution is not great either. It reduces competitiveness of these exchanges. So arbitrage will be slower, like if you want to synchronize the price with different other exchanges. And centralized exchanges are just much faster than such a limit order book dex. Although they're called dex, they may still not be fully decentralized. So this is something I would recommend you to be a bit careful about. If a project, or like in general a protocol, claims to be decentralized, then there might be different definitions of what is decentralized or what particular components are decentralized.
00:15:21.390 - 00:16:14.974, Speaker A: So please always be a critical mind of asking the right questions about what is decentralized and what does that actually mean. Very good. So we went over the trade matching in more details and now let's go into the noncustodial trade settlement layer. So noncustodial means to repeat, it just means that you are in control of your assets. So you are the one that actually controls whatever is happening with your coins and nobody else is supposed to be able to take away your funds. So why do we need dex? So imagine you have, for example, Alice. She's rich, so she wants to provide her money for other traders and in that process she would like to earn some fees, but she doesn't want to trust anyone.
00:16:14.974 - 00:17:15.026, Speaker A: So she doesn't want to give control about her money to anyone as she has some trust concerns, which is very reasonable in this particular case. On the other side, we have Bob, which is an intelligent trader and he would like to buy the latest coins and he struggles to find a trusted source to buy once he provides some funds, he wants to make sure that the funds are actually being exchanged against something that he wanted to purchase. So DEXes or decentralized exchanges, really, the underlying idea is that you have a price discovery and a trade matching engine. So this is the trade matching part that we discussed earlier and a trade clearing, all defined in a smart contract. So this is the underlying architecture, as I mentioned earlier. So here we are. Now a bit more specific how this works on a blockchain based decentralized exchange.
00:17:15.026 - 00:18:09.554, Speaker A: So naturally, the price discovery and the trade matching can happen in a limit order book. But as we will see in the following sections, there are also so called automated market makers which basically operate in this way and they have a few advantages in terms of transaction creation costs, transaction canceling costs, et cetera. So just to give you a bit of an intuition of how important DEXes actually are. So this part here is the part of 2021, and you can see that the monthly Dex volume grew significantly, which is a great indicator. So if you compare the daily volume of the Dex, we are here at about 3.5 billion US. Dollar, whereas the Nasdaq is still at about $244,000,000,000.
00:18:09.554 - 00:18:50.930, Speaker A: So clearly, DEXes are still lagging behind centralized traditional stock exchanges such as the Nasdaq. But they're getting there. They are not negligible any longer, which is really promising. And another amazing sign, I feel, is that a lot of centralized exchanges, especially in the crypto space, were prone to wash trading. So wash trading is the process whereby you create fake volume on an exchange in order to artificially increase the trade volume. So on a Dex, you need to pay transaction fees. So the process of wash trading is much more expensive.
00:18:50.930 - 00:19:24.090, Speaker A: And therefore, I believe that the numbers that we are seeing here for the daily volume on DEXes is likely more accurate than the accuracy of numbers reported by centralized exchanges. So I invite you to perform some research on finding wash trading on chain. There are some papers already out there, but, ah, things can always be improved. All right, thank you very much for listening to this first part of a lecture. I hope you liked it and looking forward to see you in the next part. Bye.
