00:00:00.330 - 00:01:05.118, Speaker A: So what are flash loans all about? And how can they be used to borrow millions of dollars worth of crypto with no collateral? You'll find answers to these questions in this video. Before we begin, if you want to learn more about decentralized finance, make sure you subscribe to my channel. A flash loan is a feature that allows you to borrow any available amount of assets for from a designated smart contract pool with no collateral. Flash loans are useful building blocks in DeFi, as they can be used for things like arbitrage swapping, collateral and self liquidation. Flash loans, although initially introduced by the Marble Protocol, were popularized by Ave and dYdX. So what's the catch? A flash loan has to be borrowed and repaid within the same blockchain. Transaction the concept of a transaction on a blockchain such as Ethereum is no different to the traditional definition of a transaction in computer science.
00:01:05.118 - 00:01:40.686, Speaker A: A transaction represents a set of operations that must be executed in an atomic way. Either all the steps are executed or the transaction is rolled back and none of the steps take place. Let's take a simple database transaction as an example. If you're already familiar with this concept, feel free to skip this part. Imagine a database table that represents users balances. Alice's balance is $1,000 and Bob's balance is $500. Alice sends Bob $500.
00:01:40.686 - 00:02:40.266, Speaker A: In this case, we of course, have to subtract $500 from Alice's balance and add $500 to Bob's balance. So we start writing our database update statements. The first update statement subtracts $500 from Alice's balance. The second statement adds $500 to Bob's balance. This is cool, but what happens if the first update executes but the second one fails for some reason? Maybe ID Two is not present in the system and we made a mistake thinking it's Bob's ID. If this happens, we would end up in an inconsistent state, with Alice's balance equal to $500 and Bob's balance also equal to $500. To avoid situations like this, we have to use transactions in the above situation in SQL.
00:02:40.266 - 00:03:41.694, Speaker A: We just need to wrap both statements with Begin and commit keywords. Once we do that, we can safely assume that either both statements are executed correctly or none of them are leaving Alice's and Bob's balances untouched. We often say that if different steps are a part of the same transaction, they are atomic, hence indivisible all or nothing when it comes to Ethereum. Every common operation such as sending ETH, sending ERC 20 tokens, and interacting with smart contracts, are executed within a transaction scope. Transactions are grouped together and included in Ethereum blocks. We can easily see all the transactions that were included in a particular block on any popular block explorers such as Etherscan. One Ethereum transaction can consist of multiple steps.
00:03:41.694 - 00:04:36.018, Speaker A: For example, you could supply ETH and borrow Dai on compound swap. Half of you borrow Dai for USDC on Curve and provide liquidity to Daiusdc pool on uniswap all in one single ethereum transaction. Of course, if any of these steps result in an error, the whole transaction will be rolled back and none of the steps will take place. Remember, you will still pay gas fees even for failed contract executions. The number of steps in a single transaction is only bounded by the gas cost. So although in theory you could create a valid transaction with thousands of steps, realistically it would be rejected because of the max gas cost limit per block. Now, let's dive a little bit deeper into Flash loans.
00:04:36.018 - 00:05:31.570, Speaker A: First of all, the most important part of executing a Flash loan is to find a Flash loan provider. Projects such as Aver or dYdX developed smart contracts that allow DeFi users to borrow different coins from a designated pool under the condition that they are repaid within the same ethereum transaction. There is usually a fixed cost associated with using Flash loans. Ave contracts, for example, require the borrower to return the initial amount plus an extra 0.9% of the borrowed amount. The fee is split between depositors who provide the funds that can be borrowed and integrators who facilitate the use of Ave's flash Loan API. A part of this fee is also swapped to Ave tokens and burned.
00:05:31.570 - 00:06:29.770, Speaker A: Once the amount is borrowed from the lending pool, it can be used for any other arbitrary actions. Assuming that at the end of the chain of different steps, the initial Flash loan is repaid, because the loan has to be repaid within one transaction, there is no risk of borrowers not repaying their borrowed amount. The only risk is the always present smart contract and platform risk. Flash loans are becoming more and more popular, with some of the users borrowing as high as 14 million die on Ave. There are three most common use cases for Flash loans. Arbitrage Flash loans can magnify the profit of executing a successful arbitrage opportunity. Let's imagine that there is a price discrepancy in the die USDC pools between uniswap and curve.
00:06:29.770 - 00:07:32.266, Speaker A: You can trade one die for one USDC on curve, but you only need zero point 99 die to buy one USDC on uniswap. Now you can try to execute the following arbitrage borrow 100,000 die from Ave via Flash loan swap 100,000 die for USDC on Uniswap and receive 101,010 USDC. Swap 101,010 USDC for 101,010 die on curve repay. Initial 100,000 die plus 0.9% fee equals 100,900 profit. 110 die this looks nice, but we have to take a few extra things into consideration. Network Fees arbitrage transactions with multiple steps can be quite expensive.
00:07:32.266 - 00:08:30.346, Speaker A: Always take transaction fees into account when calculating your profits. Price Slippage always calculate how much price slippage you'll experience while executing your order. A hint it depends on the size of your order and the liquidity present in the liquidity pool front running, there is a high chance that someone else will spot the same opportunity and will manage to get their transaction mined ahead of you. On top of that, bots that monitor the Mempool can pick up your profitable arbitrage opportunity ascend the same transaction with a higher gas fee. Profiting them instead of you basically stealing your ARP opportunity. The next use case for Flash loans is a collateral swap. Let's say you have borrowed Dai from compound with ETH as collateral.
00:08:30.346 - 00:09:23.310, Speaker A: You can swap your collateral from ETH too, for example, but in the following way take a Flash loan in Dai to cover the amount of Dai that was borrowed. Repay your compound loan with borrowed Dai withdraw your ETH swap your ETH for Bat on uniswap supplied Bat as collateral on compound borrow die against your Bat collateral. Repay Flash loan with borrowed die plus fees congrats. You just swapped your collateral from ETH to Bat and paid 0.9% of the borrowed amount for this. The last but not least example is self liquidation. Imagine the following scenario you have a loan in Dai on compound with ETH as collateral.
00:09:23.310 - 00:10:24.162, Speaker A: The ETH price keeps going down and you're approaching the liquidation level. You also don't have to or don't want to deposit more ETH to increase your liquidation level, and you also don't have the Dai required to repay the loan. Now, instead of allowing the MakerDAO contract to liquidate your collateral and charge you the liquidation fee, you can take the following steps take a Flash loan for the amount of die that you owe, repay your die loan and withdraw your ETH. Swap enough ETH to die in order to repay the Flash loan plus fees. Keep the rest of your ETH these were the three most common use cases for Flash loans. Of course, the concept of Flash loans is quite new and there are still a lot of use cases to be discovered in the future. Flash loans, similarly to crypto, can be used for both good and bad.
00:10:24.162 - 00:11:32.314, Speaker A: When it comes to the latter, flash loans were used in most of the recent DeFi hacks and allowed hackers to magnify their potential profits as they do not require any upfront funds. One of the most famous hacks was the BZX hack, where a Flash loan was used to manipulate the uniswap Oracle price. As usual, the problem was not in the use of Flash loans, but rather in some incorrect assumptions when it comes to using uniswap as a price Oracle. Events like this are sometimes costly for the people affected by them, but they are usually result in the strengthening of the whole DeFi ecosystem, making it more and more antifragile in the future. Although Flash loans are predominantly used by developers, it is also possible to use them without doing any coding. Projects such as collateral swap, DeFi saver or Fury combo. Make it possible in the description box below.
00:11:32.314 - 00:12:04.300, Speaker A: I have included links to our guides on how to code a Flash loan with Ave and how to use Fury combo. So no matter if you are familiar with coding or not, you can find something that works for you. So what do you think about Flash loans? Have you ever used them? And do you think they are good for the DeFi ecosystem? Comment down below. And as always, if you enjoyed this video, smash the like button, subscribe to my channel and check out Phinematics on Patreon to join our DeFi community.
