00:00:17.520 - 00:00:27.594, Speaker A: All right. How's it going, everyone? Okay, before we get started, just out of curiosity, has anyone actually looked at that stake pool contract by any chance?
00:00:28.884 - 00:00:29.340, Speaker B: Hey.
00:00:29.412 - 00:00:50.300, Speaker A: Oh, yeah. Thanks, guys. So it's, I guess first I should introduce myself. So I'm John, as Bartosz. Very nicely said, we started working together on the token swap program, which eventually we worked with the CRM team a bit that became serum swap, and then that sort of got sunset. Yeah, serum swap fans. Hopefully that was for that.
00:00:50.300 - 00:01:20.654, Speaker A: All right, so today we're going to be talking about the stake pools. So this has been a thing that Anatoly talked about yesterday. If you caught his talk in the beginning, sort of the next frontier for how he wants to see stake distributed throughout the network. And we're very excited about it. The problem is, it's kind of complicated. There's a lot of documentation there that I wrote hoping it would be very, very useful to people, but then it got a lot of people confused. So finally I was like, let's make a quick start guide and let's just do this together.
00:01:20.654 - 00:01:45.154, Speaker A: We're going to create our own stake pool here today. Then this way, if you ever want to check it out yourself, you'll know that actually you can do this. It's really just a couple of steps. So right now, you'll see I'm literally on our documentation. I know that people have very strong opinions about our documentation, us included. Hopefully this one is going to be all right. If it's not, you just send me a message.
00:01:45.154 - 00:02:05.560, Speaker A: I usually fix it up within the day, especially if it's going to be this. Since I said it, now, my honor's on the line. So the things that you need for this, it's two things. You'll need the Solana tools and you'll need the stake pool. Cli. There are already links to do that. When you go through it by yourself at home tonight, when you're at your place, you're like, you know what, I kind of want to start a steak pool.
00:02:05.560 - 00:02:20.620, Speaker A: It's been such a good time. I'm really riding the high of Solana. Let's do it. You'll install all that there. So there's a bunch of sample scripts, they're all on GitHub. It's all open source for you. We wanted to make this as easy as possible.
00:02:20.620 - 00:02:45.524, Speaker A: And then, you know, obviously if it's not easy, you come bug me, I'll answer your questions. So essentially what we're going to do, we're going to set up a test environment we're going to create a stake pool. We're going to throw some validators onto it. We're going to deposit into it. We're going to do a rebalance, and I'm putting this in huge quotes. It's going to make a lot more sense later, trust me. And then maybe we'll do some withdrawals if we feel like it and have the time.
00:02:45.524 - 00:03:07.884, Speaker A: So the first thing is I'm just going to set up a little test environment with a local validator. I don't know if you've ever done this before. We have to do something a little special, which is a little sketchy, but it's fine. It's your local network. It's not going to affect anybody. You're going to create a bunch of fake validators that you can delegate to. So I will run this script.
00:03:07.884 - 00:03:36.332, Speaker A: All right, thank you. Autocomplete. So this will go ahead and set up your validator. It'll give you the stake pool program directly in it, and then it's going to create a bunch of vote accounts. Great stuff is happening. So you see you've got a bunch of pub keys for validators that you can now add to your stake pool. So if we look at that file, the validators file, you'll see ten keys.
00:03:36.332 - 00:03:57.940, Speaker A: Great. None of these are real. These are really just for your fake testing environment. They're not real. Eventually, if you want to deploy to Mainnet or testnet, you can create your own file just like this. You put all of the pub keys of the different validators that you want to add and then eventually it'll add them for you. So that's step zero.
00:03:57.940 - 00:04:33.604, Speaker A: That was step zero. So next step one, we're finally going to create the stake pool. So there's a cli to do this. It can be really tricky for people because it's just like a ton of flags. And I understand that like a CLI command that has 40 flags is going to be really confusing to people. So there's another script that we're going to update and I'll go through all these bits as we update it together. All right, so I tried to make this clear, but like, shell scripts, it's like, shell scripts are some of the most, like personal things.
00:04:33.604 - 00:04:58.874, Speaker A: You think you've done it right and people are like, who would write it this way? It passed the lint. So this is like the closest that we can get. So I'm going to go through the fees. People have been very confused about these fees. Before I even get to that, people think sometimes fees are like scammy or weird or like, no, I don't want to do that. I want to be pure about things. Just keep in mind, if you have no fees on your stake pool, you will lose money.
00:04:58.874 - 00:05:31.254, Speaker A: Oh, maybe I should really define what a stake pool is. Stake pool, essentially, before we even get to that, what you're going to do is take on a whole bunch of different validators inside of a stake pool, and it's just going to be a bunch of stake accounts underneath. So if you've ever used phantom or soulflare or any of the command line wallets, you can delegate your soul to a validator. You can only do one. And the stake pool is essentially just a bunch of stake accounts. And you have one stake account per validator that you want to include. That's pretty much it.
00:05:31.254 - 00:06:02.866, Speaker A: And then it takes care of doing a lot of the inner manipulations for you. So now with the fees, there are really main three sources of fees inside of your stake pool. The first is going to be every epoch. So since your stakes will hopefully be gaining some rewards every epoch, you can get a portion of those rewards. This part confuses people. There are two sources of fees that will come in. There's the normal validator commission.
00:06:02.866 - 00:06:43.570, Speaker A: So if you've ever staked with a validator and you've seen like, oh, they're a 10% commission, they're 100% commission, 0% commission, they already get a portion of your rewards from your stakeholder. So now on top of this, your stake pool will be taking a portion of the rewards perceived by the stakes in the pool, a portion of the rewards perceived by the stakes in the pool. Every part of that was important, I swear. And this makes a lot of sense because if you're running a stake pool, you actually will have costs. You will be making transactions to rebalance your pool. Maybe you'll be adding, removing validators. Depending on what you see in the network, you actually have a cost to running a stake pool.
00:06:43.570 - 00:07:04.082, Speaker A: So it's really just fair to charge something for your services. So we're going to set this to, let's say five basis points. So this is kind of cute. You put in your numerator and your denominator. So five basis points is 510 thousand. The other ones are a lot clearer. As far as fees, they're deposit and withdrawal fees.
00:07:04.082 - 00:07:43.404, Speaker A: So when people either deposit their soul or their stake and then eventually withdraw it, a portion of that will go towards you as the manager. This one is actually really important too, because especially the withdrawal fee is a very interesting one. If you have a stake pool that has just like zero fees for withdrawals, you can use it to arbitrage between different validators. This is. A lot of people find this quite interesting. If you're into the economics of different attacks, this can be quite important. For example, if you know that a validator is going to misbehave and you have a big stake on it, if there are no fees, you can deposit it into the pool and then take it out on a different validator.
00:07:43.404 - 00:07:56.424, Speaker A: If there's a slash, you don't suffer. So fees are pretty good. I guess we'll do. Let's do five basis points again. I'll do it for both.
00:07:57.604 - 00:07:58.344, Speaker B: Great.
00:07:59.044 - 00:08:41.702, Speaker A: The next one is pretty nice. It's a referral fee. This is one I'm pretty excited about. We took this actually off of the serum model, the idea that if someone administers or helps with a deposit into your stake pool and you have a deposit fee, the referrer can get some percentage of that back to them. So sort of the big thing that we're thinking about is a defi app or a wallet. If they want to integrate with stake pools, perhaps a stake pool with a 50% referral fee will encourage the wallets to start using you, will encourage the defi apps to start integrating you as well, because they'll get back a little bit of stake pool tokens every time a deposit goes through them. So let's be nice.
00:08:41.702 - 00:09:18.696, Speaker A: We're going to put this at 80 and then this other parameter, the max number of validators. I don't know if you guys have programmed on chain, maybe you know that compute budgets are very tricky and very low. So this is like the absolute maximum that we're able to fit. I had to do some things that I'm not altogether proud of, but they were audited and they were fine, but you had to do some gross things. So we can get 39.50. It was 4000 for a bit, and then we added like one extra transfer somewhere and then we blew past that limit. So it's 3950.
00:09:18.696 - 00:09:28.084, Speaker A: The only reason this is important is because it creates a bigger additional upfront cost. So a pool like this is probably going to cost a bit over two soul to deploy.
00:09:28.414 - 00:09:31.834, Speaker B: So let's go ahead and run that.
00:09:32.294 - 00:09:47.102, Speaker A: So you see, it just spits out a bunch of info. The important things you probably don't care about the full command to create the pool. The interesting things are going to be the mint. Whoops, the mint. That's going to be your pool. Token. And then actually that's probably the most interesting one.
00:09:47.102 - 00:10:03.840, Speaker A: And then also the stake pool address you can provide. All of these parameters are totally customizable, so if you want to use something else, you can. Don't worry about that. And now we can see that this exists if we run the list command on the stake pool Cli. And so we'll see that there's nothing in it.
00:10:03.912 - 00:10:04.216, Speaker B: Great.
00:10:04.280 - 00:10:27.112, Speaker A: But then you see all of your fees are displayed there, your referral fees, all good. And so nothing's been deposited. So the next thing that we're going to do, step two, step one is a tough one. Step two, we're going to add validators to the pool. So back in step zero, we set up those ten validator vote accounts. We're just going to go ahead and throw those into the pool using that command. There's a nice little script that does it.
00:10:27.112 - 00:10:30.444, Speaker A: It takes your little file that you created earlier.
00:10:33.144 - 00:10:33.456, Speaker B: Great.
00:10:33.480 - 00:10:35.564, Speaker A: So this is going to go ahead and throw them all in.
00:10:37.864 - 00:10:38.696, Speaker B: Cool.
00:10:38.880 - 00:10:56.364, Speaker A: It's nice when it's fast. By the time I'm done talking is when it's done. So let's take another look. And so we'll see that there's now those ten validators that are included inside of the stake pool. There's still no stake. We haven't deposited anything in there. So the next step is we're actually going to deposit.
00:10:56.364 - 00:11:12.960, Speaker A: Oh, another, just one last thing. The cost. So to create the pool costs us about two sol. And then to add each validator, you'll have to put in a certain minimum. And that one is 0.00,328,288 sol for every one that you add. And this is for the rent exemption.
00:11:12.960 - 00:11:40.534, Speaker A: And then one tiny little amount so it stays staked and or cruise rewards. So the next thing is we're going to deposit. There's two ways that you can deposit. Honestly, the simplest one for most people is just going to be depositing. Sol most people don't really like to work with stake accounts, especially new users. So that's the one that I'll demo. Just be aware that it is possible to deposit stakes into a stake pool.
00:11:40.534 - 00:11:57.914, Speaker A: So this means that it's another way of attracting users. People that already have big stake accounts but don't want to miss out on any of the rewards. They can deposit their full stake account into the pool and get back pool tokens. Same as when you deposit soul. So I'll go ahead and deposit.
00:12:00.214 - 00:12:05.654, Speaker B: Stake pool. Whoops. Great.
00:12:05.694 - 00:12:07.880, Speaker A: So we'll deposit 100 fake soul.
00:12:08.062 - 00:12:08.548, Speaker B: Great.
00:12:08.636 - 00:12:24.304, Speaker A: So you'll see that that 100 was deposited, we'll take another look at our soul. So you'll see up here there's 100 sol available inside of the pools reserve. Everything else is still at zero. And then if I look at my token balance, I'll see that I have 100 tokens.
00:12:27.524 - 00:12:28.140, Speaker B: Cool.
00:12:28.252 - 00:12:40.124, Speaker A: So the next bit is rebalancing. So this part's a bit tricky. This is something we really been wanting to make easier, and people get a little bit confused about it. So the point is, over time.
00:12:42.264 - 00:12:42.576, Speaker B: As.
00:12:42.600 - 00:13:12.546, Speaker A: The network evolves, as certain validators maybe perform better, perform worse, or maybe you get along more with some over others, you'll want to rebalance the pool. So that means that you'll probably want to maybe decrease the stake on some of the validators in the pool, you'll want to increase on others. Right now, there's really only one good, well, good one program that really does it, and that's the Solana Foundation's stake o matic, which is referenced in the documentation. You can go ahead, you can give it a whirl.
00:13:12.610 - 00:13:13.258, Speaker B: It works.
00:13:13.346 - 00:13:42.154, Speaker A: The foundation runs it every night for their foundation delegation program. I really thought I was going to get around to it. I started on Python implementation. It's not totally done, but it'll make things easier for people. I know that there are a few people that do. If you do any sort of data analysis, if you really want to take a lot of chain data, a lot of validator data, start crunching it in order to figure out what are the optimal amounts that you want to put on each one. You'll have a python implementation that you can use.
00:13:42.154 - 00:13:56.494, Speaker A: It's like 50% of the way there. I'm getting there, but I'll give you a very simple example. I just made a quick shell script that we can run, which won't really rebalance. It'll simply increase the amount of stake on each validator.
00:13:58.574 - 00:13:59.594, Speaker B: Rebalance.
00:14:01.974 - 00:14:43.224, Speaker A: So really all this is doing is it's going to be depositing a little bit into the pool, and then it's going to increase the amount of stake on each of those validators. So we can go ahead and check this out. So you see now each of the stake, I'm sorry, each of the validators have a little bit of a balance on them because we increased the stake. If you're running a test validator, you can do something cool and have it really short epochs, which means that the rewards accrue a lot faster, which means you can see these things evolve over time. For this, I wanted to be safe. And I just used a normal test validator. And then eventually, if you want to withdraw, that's also a possibility.
00:14:43.224 - 00:15:21.890, Speaker A: Oh, it's not going to work because I'm using long epbox, but that's pretty much it. We've now started a stake pool that has ten validators inside of it that we've deposited some soul into that we've gotten some pool tokens out of. So again, we can see we're still at those hundred pool tokens because me as the pool token holder, nothing changed. It was the pool manager is the one who actually rebalanced everything. So we're really excited about this. It's sort of like the next frontier. We hope for staking and will really help spread out stake in a way that's a lot easier.
00:15:21.890 - 00:15:33.934, Speaker A: And this way, if you're just an end user, you don't need to delegate to 100 different validators. You can trust yourself. Well, if you trust the pool, you can trust your stake to the pool and know that they'll actually distribute it in an equitable way.
00:15:34.634 - 00:15:35.426, Speaker B: And that's it.
00:15:35.490 - 00:15:36.654, Speaker A: Thank you very much.
00:15:41.314 - 00:15:58.294, Speaker C: All right, this was awesome. We have extra ten minutes, so if you have questions for John, you can answer them. Just raise your hand and I will walk around with the mic. Anyone has questions? No, no questions. Oh, there. Aye.
00:16:02.074 - 00:16:02.934, Speaker B: Go ahead.
00:16:03.634 - 00:16:47.520, Speaker D: Yeah, sorry I made you hike a half mile there. So this was an excellent presentation. I really appreciate it. I have some fundamental questions about, like how do you maintain the validators inside of your actual pool? So take for example, you have maybe more than ten validators. You actually have more like 100 or some larger set like this, let's say, for God knows whatever reason, one of them is like, oh, I'm taking a vacation, I'm going to shut down my validator and goodbye. Then what happens when you want to rotate out some of the lower performing ones and rotate in some new ones? Do you have to redeploy an entirely new contract or are there some good ways to do this, kind of like list maintenance?
00:16:47.712 - 00:17:19.251, Speaker A: Yeah, so that's a huge part of it. So what we were doing actually, with those sort of increases that rebalance, it's exactly what we're trying to do there. So if you know that someone's going to go offline or something, you can, through the stake pool program, you decrease the amount of stake on them. It all works through stake accounts inside, which I won't bore you with, like the really fundamental nitty gritty of how it all works. But the idea is that it will deactivate a portion of that stake. And then you have to wait two days for it to deactivate. And then the stake pool program takes care of it for you.
00:17:19.251 - 00:17:34.094, Speaker A: It'll merge it back into the reserve. And then you can go ahead and increase on other validators. So you always can rebalance as you wish. The one specific thing is you can only do really one thing per epoch, per validator. So it's either you increase or you decrease or you do nothing.
00:17:34.674 - 00:17:37.014, Speaker B: Is that good? Yeah.
00:17:37.354 - 00:17:46.666, Speaker A: I wasn't able to touch on the fundamentals. Mainly because this was. I wanted this to be quite technical. So that we can actually get it up and running. But if anyone does have fundamental questions, I'm happy.
00:17:46.730 - 00:17:48.694, Speaker E: Yeah, I have a question.
00:17:50.034 - 00:17:50.954, Speaker B: Oh, sorry.
00:17:51.074 - 00:17:53.554, Speaker E: Yeah, I'm wondering about the nitty gritty of it.
00:17:53.634 - 00:17:54.154, Speaker B: Yeah, sure.
00:17:54.234 - 00:18:11.328, Speaker E: And so I have a smart contract I want to write about that uses staking. It doesn't necessarily have to do with the validators, but I'm wondering if I could either ask you questions about your code. Or check out your smart contract to kind of reappropriate it for my dap.
00:18:11.496 - 00:18:24.208, Speaker A: Yeah, sure. So I guess I have to be really specific. So the staking that we're talking about here. Is the Solana native staking. So that's just like, just sole stake to validators. If you're talking about, like, radium pools, things like that. It's a different form of staking.
00:18:24.208 - 00:18:27.484, Speaker A: We can definitely still talk about it. I'm also into Defi and all that.
00:18:28.584 - 00:18:30.064, Speaker E: I'll find you after then for that.
00:18:30.144 - 00:18:30.440, Speaker B: All right.
00:18:30.472 - 00:18:31.016, Speaker A: Yeah, sure.
00:18:31.120 - 00:18:31.376, Speaker B: Yeah.
00:18:31.400 - 00:18:53.112, Speaker C: For the staking contract, you can also check Solrise team. I think they released their version. And if you stop by the hacker house, I think there's few people that are working on the heroes staking contract. That's specific to the SPL tokens. Any other questions for John? Could be Defi doesn't need to be stake pools. No. All right.
00:18:53.112 - 00:18:53.896, Speaker C: Thank you, John.
00:18:53.960 - 00:18:54.184, Speaker B: All right.
