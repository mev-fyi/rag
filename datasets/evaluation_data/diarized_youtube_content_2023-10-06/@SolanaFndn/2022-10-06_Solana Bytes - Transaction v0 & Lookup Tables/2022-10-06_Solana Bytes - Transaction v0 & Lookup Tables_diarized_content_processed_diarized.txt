00:00:05.200 - 00:00:44.440, Speaker A: Hey, guys, so we're going to go over version transactions and address lookup tables real quick, right? So in case you haven't heard, pretty soon you're going to be able to use the new version of transactions on Solana. So right now, if you want to use this stuff, you actually need to download the edge release of the CLI. So instead of like adding a version number, just do edge and you can actually use the address lookup table from the command line. And we're going to look at it with web3 js. So version transaction, it's a different kind of transaction structure and we're going to have some resources on it that you can find out more information about why and how. This is actually a guide you can go to. I'll have the link in the description.
00:00:44.440 - 00:01:30.554, Speaker A: And so what we're going to do is we're going to cover exactly how this thing looks, right. So in our test here, what we're going to do is we're going to create an address lookup table, and then we're going to just like add some addresses to it, some like example ones. We're going to fund one of those accounts so we can do some transfers, and then we're going to send a transaction without using the address lookup table and then with using it. And we'll take a look at what those look like on the explorer. Right. So to break this down, if we first look at creating an address lookup table, you can see that we are going to actually use this method here and we're going to send, well, pass over this payload here, right. And we're going to get our authority payer and the recent slot from our connection.
00:01:30.554 - 00:02:00.994, Speaker A: So we pass those in and we'll get back the instruction and the public key of the address lookup table, right. So we can send this thing in a transaction and then we also have the address of the table so we can use it in the future. So that's how you get the instructions to create one. And then here's how you get the instructions to extend one, meaning add addresses to it. And as you can see, you can pass in a list so you can add multiple at once. You don't have to do one at a time. And these are the parameters to do that.
00:02:00.994 - 00:02:51.328, Speaker A: And so before we go into the transfers and look at the transactions, let's take a look at what this send transaction v zero actually looks like. Right? So first things first. We've got send transaction v zero, and we've also got the printing of the lookup table. So I've packaged this all into this util file, and here's the send transaction v zero. So the new transaction is called v zero, and the one that you're used to is called legacy. So as you can see, there's a little bit more work involved with sending a v zero, right? So we have to get the block hash, we have to create a message with the block hash and then you compile it to v zero, or you can compile it to legacy, right? And so you can kind of do this dynamically depending on what transaction you want to use. And then finally you create a version transaction.
00:02:51.328 - 00:03:52.804, Speaker A: You sign it with whoever your signers are and then you use the connection to send it, right? So pretty straightforward once you get down to here. But up here, obviously there's a little bit more manual work involved. So you're going to have to obviously grab this block hash, but no big deal, right? So here where we're sending the transaction v zero, we're not using the lookup table, so we're just sending this transaction, and if you notice here, we're just compiling it to the v zero message without any kind of parameters. But if you look, we can actually optionally provide an address lookup table. And that's actually all you need to do to use the lookup table with these transactions. So if you look at this function where we are using one, you can see down here, we just pass in the lookup table account and that's just us going and getting our lookup table using the pub key, right? And then we're coming back with that object and we're passing it in. So one additional step allows you to add a lookup table to your transaction.
00:03:52.804 - 00:04:37.466, Speaker A: And so what the runtime will do when you add a lookup table is when you include a list of accounts, it'll actually know to go to the lookup table and find those accounts instead of you having to like pass them into the transaction in raw form. And so we can see evidence of that on the explorer, which is why I've included the signature. So finally, to print the address lookup table, we can use the connection. And this is on a newer version of Solana Web three j's I'm using in this particular video, one dot six three dot, one. You might have a newer one by the time this is out. They're making rapid changes to it, but you are able to use these, you know, functions and stuff from the connection object. So we go get the lookup table and then we iterate over it.
00:04:37.466 - 00:04:58.474, Speaker A: And we just look at each of the addresses and we just print them out. Right? So and then we're just printing the balances of some accounts, you know, et cetera. So let's run this test and let's see what this kind of looks like. And then we'll check out the explorer. So this looks like a little bit of a mess here. I probably should have skipped some lines. But basically if you look, this is where we create the lookup table.
00:04:58.474 - 00:05:24.072, Speaker A: So here's the signature to do that. And you can see that we've created these two test accounts, but our lookup table is still empty. But these are the addresses that we're going to be referencing. Right? So two test accounts. And then our lookup table is at this hn UPA. So finally we go ahead and add some addresses here. And now this is the table itself right here from that print address lookup table function.
00:05:24.072 - 00:05:55.502, Speaker A: And you can see that at index zero is that first test account, you know, et cetera, index one. And so we can see that those public keys match. Right? And like here's the public key of the lookup table. So pretty cool. And this mimics exactly what the CLI looks like too, if you want to do this with the CLI. And then finally we go ahead and fund our first test account so that we have some soul to work with. And we go ahead and start making some transfers without and with the address lookup table, but both using the new transaction version.
00:05:55.502 - 00:06:43.252, Speaker A: Right. So let's take a look at the signature of a transfer without using the address lookup table. So we can see in here that we had one address transferred to the other one, right? So fee payer, signer, etcetera. And if we go ahead and look on chain here, we can see those addresses match up with the ones that we've created and are now using. And now if we look at the signature of the one where we use the lookup table, check out what changes here. So same addresses, but the explorer has recognized in the transaction meta that we have used an address lookup table in here. Right? And so this may make things faster.
00:06:43.252 - 00:07:15.682, Speaker A: It may make it, you know, capable of being larger. In this particular example, we're only using two accounts. So like there's not a big significant advantage here. But the idea is you can use these lookup tables to add more addresses to your transactions and thus, like expand on what you're doing, you know, almost double the size of your list of accounts. Right. And so there's some really good information on these new features coming out. By the time this video is released, there should be other videos and documentation.
00:07:15.682 - 00:07:48.602, Speaker A: And I encourage you guys to take a look, at least at this doc here. That will give you guys an idea of how to set up these new transactions. And down here at the bottom, you can actually see how to do the lookup table stuff, too. And this is pretty much everything I just kind of like had in that file there. But again, just want to quickly take another look. The new transaction here, v zero, you know, block hash message, v zero, compile to v zero message, and then set up a version transaction. And then of course, down here, when you do the compile, you can add your lookup tables as well.
00:07:48.602 - 00:08:10.824, Speaker A: Right? And that's it. Pretty straightforward. But take advantage of this powerful technology, guys. It's really, really cool. It's essentially one big hash map for accounts. And if you realize, like, the size comparison between like a single byte integer and a public key. Right? Like, the more keys you add to the table, the more space you're going to save on the transaction size, so go nuts.
