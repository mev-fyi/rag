00:00:01.210 - 00:01:09.650, Speaker A: Hi everyone, this is Max Resnick. I'm the head of research at Special Mechanisms Group, which is the division of consensus. I'm going to be presenting my FRP contingent fees and order flow auctions, which is an exploration of one of the intricate but important details in order flow auction design, which is the difference between upfront payments and contingent fees. So this is particularly relevant now as we see the order flow auctions gaining volume, especially uniswap X, which uses contingent fees. And we'll talk about some of the reasons you might do that and some of the reasons you might not do that if you were to design it all over again. So the basic idea that we're going to be studying is if you hold an auction for order flow, you have some orders you can choose two ways to charge people. Either you can charge them when their order executes on chain, or you can charge them when they win the auction.
00:01:09.650 - 00:01:34.282, Speaker A: So naively, let's just think of some reasons you might want to do the first one, and some reasons you might want to do the second one. The first one, it's nice because it's more convenient. You're already executing an order. You can kind of add a simple transfer. The gas fees are low. It's easy to code up in a smart contract if you want to. That's one reason.
00:01:34.282 - 00:02:48.480, Speaker A: Another reason might be if something goes wrong in the blockchain, say the proposer missed their slot, or the order doesn't make it in time, then a valuable order might not be executed, and then the searcher might be charged for the order, even though they didn't get any value out of it. So those are the basic ideas behind contingent fees and why we see them a lot. And I think we'll get into why you might want to do upfront payments instead, because I think that is a little bit more complicated discussion and it's what this focus is on this paper. So our basic model is that we're going to be selling a single item for sale, a single transaction, and that transaction, for simplicity, is going to be a limit sell order. So we have a lot of different types of orders on the blockchain, but most of them involve most of the ones that carry value. And consequently the ones that you want to do an order flow auction for consist of buying or selling something. And so in this case, let's just say we're auctioning off a limit sell order, which is I want to sell some ethereum at a price of 2400, say.
00:02:48.480 - 00:03:44.110, Speaker A: So. If you're a market maker and you get this order, you can choose to execute it or not. So it actually turns into an option for you, and it turns into an option to buy, which we call a call option. So you get to buy it at whatever the limit. Sell order they're selling it at is if you want to, but only if you want to, because if you don't want to, you could also just not do it. So if you do execute it, you're going to earn a profit as a market maker of s, which is the external reference price of ETH, which is always kind of moving around minus tay, which is the strike price. Maybe it's $2,400 because you're paying $2,400, and maybe the price of ETH is 20 415.
00:03:44.110 - 00:04:32.014, Speaker A: So you bought one ETH for 2400, and you can go turn around and sell it for $15 more. You've made $15. So that's where that formula comes from. K is the strike price, as we call it, an option theory. So a little detour just so we're all on the same page in terms of options, because the theory is important to understand the intricacies of this. The strike price, in this case 50, is the cut off point between when you want to execute the call option and when you don't, or the other way around when you don't execute to when you do. If the external reference price is 40 and the strike price is 50, you're buying something for 50 and it can be only sold for 40.
00:04:32.014 - 00:05:20.078, Speaker A: So you could have just bought it in the external market. You're losing $10 if the external reference price is 60, then you are profitable in executing the option because you can buy it for $50 and sell it for $60. That's a $10 delta. You're making $10. So you can see the payoff looks like this linear spline, which says, I'm zero if I'm below the strike price and I'm linearly increasing when I'm above the strike price. So one thing to keep in mind, I think we see these Wall street bets, options traders kind of using options as a way to bet on delta, which is the direction that the price is moving. So they're saying, I want to buy bed, bath and beyond options.
00:05:20.078 - 00:05:57.290, Speaker A: I want to buy one year call options because I think it's going to go way up. So it does carry some directional value as well. Right. But it also is speculation on variance. So you're making more money when the price is more volatile, even when the expected price is the same in the future. So even if you think that the price of e is likely to be exactly where it is today in a year, modulo the interest rate, you may still be profitable buying an option, because there may be some variance. So here's an example.
00:05:57.290 - 00:07:10.930, Speaker A: When the variance of the price is low with the same expectation, the value is only worth less than two expected value of the option when it's high on the other side, the value is 4.34. Okay, so just the more variance you have, even when the price is expected to be the same, the more valuable the option is. The other point about options is that usually they're sold based on a premium. Basically, you pay upfront for the option whether you execute the option or not. Why? Well, actually, if you put an execution fee on an option instead of a premium upfront payment, then it's as if you gave away a free option with a modified strike price of the execution fee. So here you can see a $50 strike price option with a $10 execution fee. Actually looks like a free option has the payoff of a free option with strike price 60, whereas an option with a strike price of 50 with an unconditional fee of $10 is what you would expect from a call option.
00:07:10.930 - 00:07:52.346, Speaker A: So the two are very different, even though you may think that they're similar. Here's our model that we're going to look at. Bidders are going to submit bids for the single sell order. The highest bidder is going to win and they're going to pay their bid. B. The winning bidder observes the new price and decides whether to execute or not. So you can see the payoff down there and the difference in the contingent fee option, which again is like what UniswApx uses, is that the winning bidder is going to do everything the same, except when they don't execute, they don't have to pay their bid anymore.
00:07:52.346 - 00:08:11.800, Speaker A: So that changes their decisions to execute or not execute. Let's look at the equilibrium in the upfront payment game. In this case, it's relatively simple. It's just the expectation of the value of the option. Great. I mean, we're selling something, we're getting the expected value of it. That seems like a pretty good situation.
00:08:11.800 - 00:09:38.426, Speaker A: If we assume that the auction is perfectly competitive and so we can use the zero profit condition in the contingency game, we have to look a little closer. We have the value of the option now is moderated by that b term, which only has to be paid when you execute. That's the bid. If you apply the zero profit condition on that, you say the expected profit is zero for the winning bidder, then the probability that they make money has to also be zero, and therefore they must have bid so high that there's no probability that the price moves enough that they want to execute. So that's a startling result. And of course, it's true in this stylized model that in the upfront payment game, you get exactly what you want, which is you've made some revenue and it's proportional to how much value the thing is worth. And in the contingency game, you've made no money and nobody's executed any orders.
00:09:38.426 - 00:10:15.354, Speaker A: So the users are not happy and you're not happy. Okay, let's maybe look at some extensions here. We have an extension to a mixture between the two. So you do have some upfront payment. Maybe it's a reputation, maybe there's some probability that you execute regardless of what you want to do, and there's some portion that is contingent. So that's what this looks like. And I have all the math here, but I think we are a little short on time.
00:10:15.354 - 00:10:54.542, Speaker A: So I'll just go through it. You can solve for the equilibrium, it's the solution to this equation. And if you go through the math, you can solve for the probability of execution, the revenue, the effective spread, which is a measure of execution quality. The summary is basically the closer you are to up front, the better. So we look at these mixtures. The ones that are closer to up front with higher alpha have better probability of execution. So the users are happier, auction revenue is increasing, so the auctioneer is happier, and the effective spread is decreasing.
00:10:54.542 - 00:11:34.706, Speaker A: Good for users. So let's illustrate that with a uniform noise factor on the price, and see the bids are decreasing, but actually the revenue is increasing because bids are coming down, but the probability that you have to pay them is going up. And on the margin, the interaction between those two means higher revenue, not lower. The effective spreads coming down, great for users, and the probability of order execution is going up. Again, good for users because they want to trade. Now, maybe you say, max, that was just the uniform price. So here's a bunch of other distributions.
00:11:34.706 - 00:12:26.962, Speaker A: So you can see this is not just a uniform price thing. This is something that's true of a lot of distributions. And you can see the regularity conditions in the paper, but you can see basically this trend holds of execution probability going up, spread going down, and revenue going up. So what can we do about it? Let me just discuss one thing that has been floated around, which is if you're uniswap x, you say you have to execute at least x percent of orders. So very quickly you can see that this doesn't necessarily work very well, because what they will do is simply cut the most painful things to execute so that they stay within the margin. So you say you have to execute at least 90% of your orders. Well, they're still going to play games.
00:12:26.962 - 00:13:41.000, Speaker A: They're just going to not execute when it's most unprofitable for them to do so, and execute when it's only slightly unprofitable, so that they can remain within that margin. So we can also extend the model to involuntary execution and failure. Some probability of execution without some say for the market maker, and some probability of failure without some say for the market maker. Nice that it turns out to be this mixture model with just a different mixture parameter, which is good, so we don't have to do any more work. So I'm at time, but I just want to say a few acknowledgements. Thank you to flashbots for the FRP that funded this research, and to Quintess, who was a great sounding board while I was working on it, and to molesh PI, who works with me at SMG, who also gave a lot of comments at the time. And now and then also, thank you to uniswap for going ahead and building this and putting it in a production so that hopefully, eventually we can write a paper with data and see whether this attack that I'm describing actually happens in the real world.
