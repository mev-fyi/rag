00:00:02.810 - 00:00:49.142, Speaker A: Oh, you hear. I was just trying to do some yield farming with my plan, but it's not working really well. It probably works better with spot contract if you don't know what yield farming is. That's a new investment technique in DeFi in which you supply liquidity to a DeFi protocol and you get rewarded with some tokens. So that's on top, top of the normal interest rate that you get for supplying this asset. So when you combine the interest rate plus the token reward, the total return on investment is pretty high. So this technique was introduced by compound a couple of weeks ago and it instantly became super popular to the point that compound became the first protocol on DeFi.
00:00:49.142 - 00:01:43.226, Speaker A: And the total market cap of DeFi just went through the moon. And many people actually think that we might be at the beginning of a new booming area for crypto and blockchain, a bit similar to the ICo era back in the day. So that's really exciting. And in this video I'm going to explain a technique to do some leverage yield farming with compound. So that's basically yield farming, but on steroids, even more powerful. And if you don't know me, I'm Julian and on my channel eat the blocks, I teach blockchain development and how to find your first blockchain job. And before we continue, make sure to register for my free training on flash loan where I will teach you the basics about how to make profitable flash loan on ethereum flash loan.
00:01:43.226 - 00:02:42.138, Speaker A: This is another thing that is super, super exciting for DFI and blockchain. So go register every day. The compound protocol gives 2900 comp token to the user of each protocol, both the borrowers and the lenders. So what's crazy is that if you borrow money, borrow tokens from compound, you can still make money because the value of the comp token that you're going to receive sometime more than offset the interest that you pay. So what people have been doing is that they try to borrow as much money as they can from compound and they have also supplied all the token that they have so that they can earn comb tokens from both sides. But I find a way to push this even further. And so that's what I'm going to explain you in this section.
00:02:42.138 - 00:03:22.370, Speaker A: So here is the id. So we're going to start with 100 die. Okay, we invest this 100 die in the compound protocol. So they're going to be locked as collateral and we're going to start to earn some comp token based on that. But because we have some collateral now we can also borrow from compound. So we're going to also borrow some new token thanks to our collateral. So now we are earning comp token both for our borrowing and for our lending, and for the token that we just borrowed, we're going to reinvest them as collateral.
00:03:22.370 - 00:03:58.390, Speaker A: And now since we have new collateral, then based on this new collateral, we can borrow again. And so we're going to do this loop a couple of times. So can we do this forever? No, because in the end there is something that is called the collateral factor. And that means that if you have, for example, 100 token of collateral, you cannot borrow for 100 die of collateral. You can borrow maximum for 75 die token. So that means that the process will be limited. But that kind of makes sense.
00:03:58.390 - 00:04:20.670, Speaker A: So let's say we start with 100 die as collateral. So we borrow 75. With the 75 we reprovite them as collateral. So now with this 75 collateral, we can borrow 75% of that. So 75% times 75. What is this? I don't know, maybe 50, 56 die token. And we're going to repeat the process a couple of times.
00:04:20.670 - 00:05:14.514, Speaker A: And I've actually made the calculation and you can see that if we just do it a couple of times, we can increase massively the amount of diet token that are producing some comp token versus compared to if you were just lending 100 diet tokens. Trade. So now there is something else important to know, is that the number of comp token that are distributed across different markets on compound depends on the interest rate of each market. The higher the interest rate, the more comp tokens. So you might wonder, why don't we do this with bad tokens? Because bat tokens will give you much more comp token. Yes, but one problem is that the interest rate is also much higher for bad tokens. So that means for each borrower we do, we're going to have to pay way more interest.
00:05:14.514 - 00:05:59.418, Speaker A: So this will offset some of the profitability of this. And second, the biggest reason why I don't want to use bat is because if we use bat, that means we need to buy some bat before we can start the whole process. And so we are exposed to the variation of the price of bat. And that's an exposure that I don't really want to have for this trade if we choose Dai. The thing that is great is that Dai doesn't change in value because like its name implies, this is a stable coin. So this is just something clever that we do, but we don't really take a risk on the price of DAi. So that's why we're going to stay with Dai and not use the bat token.
00:05:59.594 - 00:06:02.382, Speaker B: So now we have a problem because.
00:06:02.436 - 00:07:00.820, Speaker A: This strategy I explained is really exciting, but there isn't any visual GuI, any visual interface that can help us to do this trade. So how are we going to do this? Well, we can code this ourselves, we can code our own solidity smart contract. So I know that's the moment when all the non technical people who are watching this video start to freak out and say, oh, coding, I don't want to do this. Okay, so there is something super important that you need to understand as an investor in the DeFi space. DeFi is different. This is a very technical field and if you want to win at this game, you need to start to learn some coding, not all coding. You don't need to become a hardcore coder, but at least you should be able to write simple smart contract and also use some smart contract that are created by other people.
00:07:00.820 - 00:07:32.430, Speaker A: So yeah, if you accept to make this effort just to learn the basics, you're going to have this massive advantage over all the other crypto investors that just think that DeFi is exactly like trading bitcoin or litecoin. No, this is very different. So yeah, just make this effort and you're going to unlock a massive power. So in the next section, we're going to start coding our smart contract to implement the strategy that I've just explained.
00:07:36.610 - 00:08:08.682, Speaker B: So this is the code of the spot contract in the GitHub repo of the blocks. So I've used truffle, the framework for spot contract to create this project. So let's have a look at the spot contract. So the main smart contract is yield farmer. It's where we're going to write all the code. This spot contract is going to interact with other spot contract belonging to compound. So here we have various interfaces that we need.
00:08:08.682 - 00:08:17.494, Speaker B: So let's see exactly what are all this spot contract. So here we're going to interact with this risk, but contract.
00:08:17.542 - 00:08:21.950, Speaker A: So controller. So that's the main spot contract of.
00:08:22.020 - 00:08:51.394, Speaker B: Compound and we're going to use it to call the enter markets function that enables a collateral to be used for borrowing other assets. Then we're going to interact with CDI. So in compound, each asset has its own c token smart contract. So if you want to borrow die, then you need CDAI. If you want to borrow bat, it's going to be CBAT, et cetera. And after we have the die, yes, 20 token. And so here in the constructor.
00:08:51.394 - 00:09:12.366, Speaker B: So that's the function that is executed when we deploy the spot contract. We going to pass the addresses of these three spot contract, controller, CDI and die. And after we instantiate pointer in solidity so that we can interact with this contract after and we also call the enter markets function of the controllers so.
00:09:12.388 - 00:09:13.914, Speaker A: That we can use our die collateral.
00:09:13.962 - 00:09:54.422, Speaker B: To borrow other assets. Next we need to create a function to open the position. So we will send Dai to compound. Then we will borrow die and we will repeat the process five times. So that's what I call open the position. So here this is this function open position and we're going to specify the initial amount of die that we're going to send and we going to create a for loop so that we can repeat the operation five times. And we going to create another function, supply and borrow.
00:09:54.566 - 00:09:56.314, Speaker A: Let's see how it works.
00:09:56.432 - 00:10:31.330, Speaker B: So first we approve the die to be spent by the CDI spot contract for the amount that we want to initially invest. Then in the CDI contract we call the min function. So that's actually going to do the transfer from our spot contract to the CDI spot contract. And in exchange we're going to have some CDI token. That is the proof that we have sent some collateral to compound. And with this CDI token later we can redeem our CDI against the real die. And after that we're going to calculate how much we want to borrow.
00:10:31.330 - 00:10:35.286, Speaker B: So we want 70% of the collateral amount.
00:10:35.388 - 00:10:45.386, Speaker A: So the collateral factor is 75. That means we could in theory borrow up to 75 die. But here I took five less so.
00:10:45.408 - 00:10:59.902, Speaker B: That we have enough to pay for the interest. And after we're going to call the CDI function borrow. So that's where we do our borrow of die. And it's only working because we already.
00:10:59.956 - 00:11:01.774, Speaker A: Have enough collateral and we also call.
00:11:01.812 - 00:11:06.194, Speaker B: Enter markets before and after we return.
00:11:06.312 - 00:11:09.554, Speaker A: The amount that was borrowed. And so that's going to be the.
00:11:09.592 - 00:11:12.398, Speaker B: Next collateral amount for the next loop.
00:11:12.494 - 00:11:14.990, Speaker A: And so repeat the operation five times.
00:11:15.080 - 00:11:49.614, Speaker B: And in the end we have our open position. So now we need to do the opposite operation, that is to close the position. So that's something that you can do a few weeks or a few months after you open your position. So first we will need to reimburse our die debt. So for that we will call borrow balance current function on the CDI spot contract and we're going to give it the address of this smart contract and.
00:11:49.652 - 00:11:51.834, Speaker A: We'Re going to have the total Dai.
00:11:51.882 - 00:12:43.650, Speaker B: Balance that we have. So the CDI smart contract doesn't care that before we did our supply and borrow operation five time, it will just tell us what is the total Dai balance. And after we're going to approve DAi to be spent by CDI for the total amount that we've borrowed. And after we repay our debt with repay borrow and after we get the CDI token balance, so that represents the collateral that we have in the CDI contract. Finally we call redeem to exchange this CDI against DAi. And when you call repay borrow compound it's going to automatically send you the comb token that you earn during this time. Same thing for the redeem function.
00:12:43.650 - 00:13:34.026, Speaker B: So at the end we got our die back and we also earn some comb token. So before you can use this spot contract you need to deploy it on the Ethereum blockchain. So I'm going to show you how to do this. So first I wrote a migration script in a migration folder right here. So here I import the yield farmer spot contract and then I give it as argument for its constructor the addresses of the different spot contract. We're going to interact with controller CDI and die. And after that we need to install APAC here, HD wallet provider.
00:13:34.026 - 00:14:27.418, Speaker B: We're going to use this to add a private key. So of course you need to have an address on mainnet already created and with some ether in it so that you can pay for the transaction fee. And in truffle config we're going to import this dependency and we're going to create a new entry in the network's entry called Mannet. And it's going to have two key one provider where we return a function with the private key and the infra URL, and after the network Id, so the private key. So that's something that you need to define here as well as the infra URL. So Infira is a service to easily access the Ethereum network. It runs some publicly accessible ethereum node.
00:14:27.418 - 00:15:16.002, Speaker B: If you don't use Infira, you can still deploy the spot contract, but you need to run your own ethereum node and that's really not easy. So I just recommend to use Inferra and you can create a free account very easily. And after you create an ethereum project and you copy the HTTPs URL, and here you paste it here in infra URL. And after, once you've done this, I've created a command in package JSon. So to deploy you run NPM, run deploy, and it's going to run this migration command for Mainnet. And there is also two script to call open position and close position here.
00:15:16.056 - 00:15:17.166, Speaker A: In the script folder.
00:15:17.198 - 00:15:20.340, Speaker B: So if you are curious you can check it out.
00:15:24.150 - 00:16:06.386, Speaker A: So what I showed you just before is super cool. But what's crazy in Defi is that no matter how crazy something is, there is always something even more crazy. And so in defi right now, the most crazy stuff that happened is flashloan. With flashloan you can borrow as many tokens as you want without any collateral. And you can use this money to do all sort of cool stuff like arbitrage, swapping your collateral on the compound, or do leverage yield farming. So everything I showed you before, we can do it in a more simple way with flash loans. So let me explain you how this works.
00:16:06.386 - 00:16:49.386, Speaker A: So let's say that you have 2500 die and you want to do leverage yield farming on compound for 10,000 dies. So leverage time four. So you're going to create a transaction where you will provide 2500 die. And within this transaction with a flash loan, you're going to borrow 7500 die. So 7500 plus 2500 equals 10,000. With this 10,000 die, you send them to compound as a collateral. So you'll be a lender and with this 10,000 on compound you can borrow 7500 of die.
00:16:49.386 - 00:17:39.002, Speaker A: So you borrow 7500 and with this money you can reimburse the flash loan and that's the end of your transaction. So after this transaction you have a position on compound where you have 10,000 die as a lender and 7500 as a borrower. And you start to accumulate comp tokens based on that, even though you personally you only provided 2500 die. Now what about when you want to close this position? Well, once again we can use a flash loan. So in this case you will create a transaction where you will provide the interest for the 7500. Then with a flash loan you're going to borrow 7500 die. So 7500 plus your interest, you are able to pay back your debt on compound.
00:17:39.002 - 00:18:29.354, Speaker A: And after once you paid back this debt, then you can withdraw your 10,000 die that you provided as a collateral. Out of this 10,000 you take 7500 to pay back the flash loan and you are left with 2500. So that's your initial capital, so you have your money back. And during all this time you were able to accumulate comb token on a total capital of 10,000 as collateral and 7500 as a borrower. And what I just explained here is actually how instadap does its leverage comp investment feature. And there are still many other cool stuff that you can do with flash loans such as arbitrage. So if you want to learn how you can do profitable flash loan arbitrage, register for my free flash loan training on my website cryptoblocks.
00:18:29.354 - 00:18:30.140, Speaker A: I'll see you there.
