00:00:00.330 - 00:00:47.782, Speaker A: I've always been fascinated by decentralized exchanges. With decentralized exchanges you can buy, sell, borrow, lend, token in a decentralized way without any middleman, all going through a smart contract. Most of the popular DeFi projects are decentralized exchanges. So if you are an investor in DeFi, this is very important that you understand how decentralized exchange this work. And if you are a developer, this is also very important because with this knowledge you can build your own decentralized exchange and this will be a great asset for your blockchain portfolio and funding your first blockchain job. And you can also leverage this knowledge to build your own Defi project. And who knows, maybe you'll be as successful as uniswap or compound.
00:00:47.782 - 00:01:44.286, Speaker A: So in this video I'm going to explain how decentralized exchanges work. And for this we're going to go through the different generation of decentralized exchanges, starting from the first primitive decentralized exchanges of a few years back, like ether delta, going all the way up to the modern decentralized exchanges that we see today, such as Uniswap or curve. If you don't know me, I'm Julian and on my channel, etherblocks, I teach blockchain development and how to find your first blockchain job. If you want to understand decentralized exchanges, first you need to understand centralized exchanges. I'm talking of exchanges like Coinbase, binance, kraken, etc. They make up most of the trading volume for cryptocurrency. So they have a very good liquidity, they are very fast and the user experience is usually very good.
00:01:44.286 - 00:02:20.566, Speaker A: So how do they work? So you have traders and you have the server of the exchange, and first trader need to fund their account so they will send their crypto to the address of the exchange. So bitcoin, ether or other cryptocurrencies. So that means that after this transfer, the crypto don't belong to them, they belong to the exchange. Then before any trading can happen, we need some liquidity on the exchange. So these traders will create limit orders. In a limit order, you specify a couple of things. First, you specify which market you want to trade.
00:02:20.566 - 00:02:49.922, Speaker A: For example, bitcoin USD or ether USD. Then you specify if you want to buy or if you want to sell. Then you specify your limit price. So if you are buying, that's going to be a maximum buying price. If you are selling, that's going to be a minimum selling price. And finally, you specify the amount that you want to trade after you send your order to the exchange. And this is going to be put in a database that we call an order book.
00:02:49.922 - 00:03:39.614, Speaker A: An order book is a database with two columns, buy orders and sell orders. On each of these column the orders are sorted by prices. So for sell order they are sorted from the lower prices to the highest prices because the best sell orders have a low limit price. And for the buy orders, that's the country, they are sorted from the highest price to the lowest price because the best buy orders are the one with a high limit price. At this point you basically have a database that is a summary of the intentions of traders, but at this point you don't have any trading happening. If you want some trade to happen, you need some market orders. So market orders are another kind of order where you specify which market you want to trade.
00:03:39.614 - 00:04:32.690, Speaker A: So bitcoin, USD, ether, USD, et cetera. Then you specify if you're a buyer or a seller, then you specify the amount that you want to trade, but you don't specify any price in a market order. You just say, hey, I want to trade this much at whatever price. And what happened is that after you send your order to the centralized exchange, it's going to be matched in the order book with account party. So for example, if you want to sell an asset, it's going to be matched against a buy limit order and it uses what we call the price time matching algorithm. So that means first it's going to start from the best price. So if you are a seller, the best price are the highest price, and after that in priority, it's going to take the oldest order, it's going to consume the liquidity of this order.
00:04:32.690 - 00:05:15.762, Speaker A: And if your order is too big, then the algorithm is going to move on to the next order. So maybe if we have another order at the same level, but that was created after, that's going to be the second one that's going to be used, et cetera, et cetera. And maybe that if your order is really too big, it's going to use all the liquidity for this price level. So after that you're going to move on to the second best price and you're going to repeat the algorithm until you have fulfilled your order. And after, when you're done trading, you can finally redraw your crypto assets. So bitcoin and ether will be transferred from the wallet of the exchange to your own wallet and that's the end of the operation. So centralized exchanges work great, but they have a couple of problems.
00:05:15.762 - 00:05:58.126, Speaker A: One of the biggest problem is security because everything is centralized, and they manage centrally all these private keys, they act as a sort of honeypot for hackers. And there were many, many hack of centralized exchanges in the past. One of the most famous one is Mongox in 2013 in Japan, but there were many others. Another problem is that it's very easy for government to seize your crypto if they don't like you for any reason. They just give a phone call to decentralized exchange, ask to seize whatever asset. And since they control their private key, decentralized exchanges can do it very easily. Can we solve this problem? Yes.
00:05:58.126 - 00:06:43.786, Speaker A: With decentralized exchanges. In 2016, 2017, we started to see the first generation of decentralized exchanges, such as ether delta. So the big difference between these exchanges and the centralized exchanges was that with the decentralized exchanges, you don't need to give the ownership of your asset to another entity. You always keep control of your asset. Everything happened in a smart contract that was written in advance, and it's not possible for anybody to modify the code of the smart contract. And also there is no backdoor. So technically, before trading, you still have to send your asset to the smart contract of the decentralized exchange.
00:06:43.786 - 00:07:32.486, Speaker A: But in the code of the decentralized exchange, there is no function that allow anybody to seize your asset. You can always withdraw your asset whenever you want. The order book works very similarly to centralized exchanges with the price time matching algorithm. For the very first attempt at doing some decentralized exchanges, we try to put the order book directly on chain, but it posed some big problem because every time you want to create an order, you need to pay for gas fees. And if you want to cancel an order or update it, then it takes a lot of time because you need to mine the transaction before this is stored inside the blockchain. So that's minimum 15 seconds. But that can be a huge problem if the market changes suddenly.
00:07:32.486 - 00:08:48.034, Speaker A: So Etherdata find a better solution by doing off chain order books. So when you create a limit order or a market order, you sign a message with your private key, that is the private key of your Ethereum address, and you send this order to the centralized server of Ether delta. So they have a centralized order book. And when the order Book of Ether delta has a match, so that means a market order matches against one or several limit order, then the server of ether delta is going to send a transaction to the smart contract of ether delta on the Ethereum blockchain. And this transaction will include the signature of all the traders involved in this trade. And after the smart contract of ether delta, that has the ownership of the assets of the different trader, will verify the signature of the different traders to make sure that everybody really wanted to make this trade, and it will actually proceed to transfer the ownership. So that's a very clever system, because although you are decentralized, you don't suffer from some of the problem of having an on chain order book.
00:08:48.034 - 00:09:39.714, Speaker A: So Etherdata was one of the first decentralized exchange that worked like this. You also had IDEX, but the big problems we had on these exchanges was liquidity. So there were many different markets, and at any time it was very difficult to get some decent volume. So for example, if you want to sell for 1000 or $2,000 of tokens, sometimes you have to wait for a couple of days because otherwise you will consume too much of the liquidity for a market and you'll end up getting this huge slippage. And that's really not good. And some clever people decided to fix this problem by creating second generation of decentralized exchanges. The next generation of decentralized exchanges was created by Uniswap.
00:09:39.714 - 00:10:16.182, Speaker A: The revolutionary idea of Uniswap is to not use orderbook anymore and instead use what we call liquidity pools. So with liquidity pools, you don't have market makers, but you have liquidity providers. So these are people who have asset and want to earn interest on their asset. So you have one pool per market. For example, for the market ether die. So this is one liquidity pool. And if some liquidity providers want to participate in these pools, they're going to send in equal proportion ether and die.
00:10:16.182 - 00:10:57.370, Speaker A: And after they send the asset to the smart contract of the decentralized exchange, in exchange they get another token that prove that they have supplied this asset. And so with this other token, at any time, they can redeem the token that they sent at the first place. And after that, when a traders want to buy or sell some token, it's going to send an order to the liquidity pool. But you notice that at this point, I haven't specified any notion of price. Liquidity providers don't specify at which price they want the asset to be bought or sold. Instead, the price is calculated automatically by the smart contract of the decentralized exchange. And it does it by using what we call the constant price formula.
00:10:57.370 - 00:11:52.106, Speaker A: So the more you deplete one side of the liquidity, the more each asset is going to become expensive. And the goal is to maintain the liquidity pool's balance with an equal value of the two assets. So not having to decide on the price is really great, because now you don't need to be a professional market maker who constantly readjusts your limit buying price or limit sell price. If you want to provide liquidity to some exchanges, you just need to own some tokens and you send them to these liquidity pools and you earn some profit. Because every time a trader want to buy or sell some token, he will pay some trading fee, and this trading fee will be passed on to the liquidity providers. So uniswap and liquidity pools are great, but they also come with their own problem. One of the problem is that because of their pricing function, sometimes you can have a lot of slippage.
00:11:52.106 - 00:12:46.366, Speaker A: If you want to buy a large quantity of a token, you also have another problem which is called impermanent loss. And that basically means that for liquidity providers, sometime if you compare the situation where a they invested their token in a liquidity pool and b they just hold on to their asset, sometimes they're actually worst off by investing in a liquidity pool. And to fix this problem, some people decided to create decentralized exchanges of third generation. The project that created decentralized exchanges of third generation is curve. Curve still uses the system of liquidity pools created by uniswap. But the big change is that the pricing function is different. The problem with using the pricing function of uniswap on all the assets is that different assets have different risk profiles.
00:12:46.366 - 00:13:25.354, Speaker A: Some assets are more volatile than others. So maybe we could have different pricing function depending on the volatility of the assets. So curve decided to specialize in stablecoin, for example, USDC versus Dai. So because these markets are stable coins, they are very stable, their price will never fluctuate a lot. So maybe that we can adjust the pricing function by making it worse on both extremities and making it better in the center. And so that's the whole idea of the pricing function of curve. And so with this pricing function, you have less slippage and less impermanent loss.
00:13:25.354 - 00:14:07.158, Speaker A: And in the end, that's a more efficient market for traders. So curve was wildly successful. As soon as it launched, it attracted an insane liquidity. And I think that going forward, other exchanges are going to take the same idea as curve, by creating different pricing function that are adapted to the volatility of the assets. There are still some other issues that I haven't talked about, such as the problem of scalability for decentralized exchanges. So you still have another area of research, which is decentralized exchanges on layer two, an example of this will be loop ring. So these exchanges are extremely scalable.
00:14:07.158 - 00:14:46.150, Speaker A: But the problem is that you lose the composability that you have with decentralized exchanges in layer one. So on the minute on real Ethereum blockchain. So for that reason, at the moment I'm a little bit less excited about layer two, decentralized exchange. So now that you know how a decentralized exchange work, the next step would be to build your own decentralized exchange. That's a great way to have an awesome project for your blockchain portfolio, and that can help you a lot to find your first blockchain job. It can also help you to launch your own defi project. So how can we create a decentralized exchange? Answer in the next section.
00:14:46.150 - 00:15:34.694, Speaker A: So to build your decentralized exchange, the first step is to decide what's going to be the design of your decentralized exchange. So as I just explained you, there are a couple of generation of decentralized exchanges and you could try to create an exchange of third generation. But the problem is that a decentralized exchange is quite an advanced project. So for your first decentralized exchange to learn, I really recommend to try to make it as simple as possible. So that's why I think you should do a first generation exchange. And you should not even try to do an off chain order book, but you should try to do an onchain order book because that's going to be easier. So you're going to have three parts in your project.
00:15:34.694 - 00:16:17.526, Speaker A: The first part will be the spot contract. So it's possible to have several spot contract in a decentralized exchange system. But for learning, I just recommend to put everything in a single spot contract that's more simple. Then you're going to have to test your spot contract to make sure that everything works well. So probably that your test will be pretty long because a decentralized exchange is something that is quite significant. And after this you will need to build a front end so that traders can use your smart contract very easily. So for your front end you probably have some table that shows the different orders that you have on the order book.
00:16:17.526 - 00:16:52.010, Speaker A: You probably also want to have a graph that shows the trades that were done recently. You also need to have a wallet function so that traders can transfer back and forth the asset between their wallet to the smart contract. And in my course, six figure blockchain developer for the final project, we built a decentralized exchange for ESC 20 tokens. I took a lot of time to make it super beautiful, and that's a great chance to add a super good project to your blockchain portfolio. If you have any question about the course, ask in the comment below. Bye.
