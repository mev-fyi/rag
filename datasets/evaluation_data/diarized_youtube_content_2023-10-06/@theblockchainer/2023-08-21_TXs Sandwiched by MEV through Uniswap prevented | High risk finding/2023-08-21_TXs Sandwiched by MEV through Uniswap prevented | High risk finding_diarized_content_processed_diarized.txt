00:00:00.330 - 00:00:53.018, Speaker A: Alright, let's go for the last high, the 8th one staking, unstaking and rebalance to weight can be sandwiched. A lot of people found this and raised it. Not bad. Let's find out what's it about. Our e derivatives can be bought through uniswap if the deposit contract is not open while a max lipid variable is set. The price of our ETH on Uniswap is the spot price and is only determined during the transaction opening sandwich opportunity for MEF researchers as long as the slippage stays below max slippage. This is also true for WGST ETH on withdrawal and FRX ETH on deposit and withdraw that goes through a curve pool when unstaking.
00:00:53.018 - 00:01:49.822, Speaker A: Unstaking for FRX etH, while the curve pool has much more liquidity and the assumed price as one on one ratio for WST and FRx eth seem to be using a twelve price before applying the slippage. These attacks are less likely to happen. So I will only describe Arith one, the proof of contract. While the current re derivative contract uses Uniswap V 30 comma zero 5% pool. I'll be using the Uniswap V two formula to make this example simpler. In both case, sandwiching is possible. Default slippage is set to 1% on Aries contract at deployment on arrays on deployment on the initiate yeah, let's take a pool of 10,000 ras for 10,695 e.
00:01:49.822 - 00:02:27.030, Speaker A: Same ratio is on the units. Obviously user wants to stake hundred ease. A third of it will be staked into Aries according to a one third weight for each derivative. So bundle transaction one researchers have 100 e in 492 63 area. New pool balance is that much. Okay, after this and 10,795 transaction two users take his eth. The rocket pool deposit contract is closed.
00:02:27.030 - 00:05:00.490, Speaker A: So the deposit function takes the current spot price of the pool and applies 1% slippage to e to get minimum out. Current ratio is zero 91 77 e to swap for Re 33 53 so minimum amount that is 30 comma 284 e seems lower than this contract swap 33 comma 3430 comma four nine eight Re is a slippage of zero 90 61 so below 1% and receive more than minimum hood. New pool balance is that transaction three researchers swap back the 92 63 reed for around 160 comma 61 eth new pool balance that researcher made zero comma 61 is to profit. Could be more as we only applied a zero comma 61 slippage, but we can go as far as 1% in the current arid contract unison p three pool could be even worse as researcher with a lot of liquidity could be able to drain one side liquidity is very concentrated add liquidity in a tight range, execute the stake and then remove liquidity and swap back yeah okay I remember reading somewhere that when you depend on a third party for some operations or for some. Well yeah any kind of logic it's worth to look very closely because you don't know what's on the other side. So the recommended mitigation steps the RF price should be determined using swap price and users should be able to input minimum out in the stake and stake and rebalance to weight function interesting okay so that means because it's max slippage okay it's hard coded that will help me investigate further when I will see somewhere else that the maximum slippage is set by the owner I will remember that there might be an issue there depending of course on the feature but yeah okay so that's all hives.
