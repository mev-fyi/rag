00:00:06.760 - 00:01:06.375, Speaker A: Okay, welcome everyone to sequencing call number 13. The topic here is preconf tip pricing. I think this might become a series of calls because it's such a big topic and we started to go down the rabbit hole and really what I wanted to do here is summarize some of the thoughts that I've had in the last few weeks as I've gone down the rabbit hole. And I don't think what I'm presenting is 100% fully baked and bulletproof. And I'd love to see the discussion that ensures from it, but at least I hope that it is directionally correct or at least a possible direction for tackling preconf tip pricing. So without further ado, let me share my slides. I shared the link in the telegram chat.
00:01:06.375 - 00:02:19.977, Speaker A: Okay, so preconf tip pricing, the background picture here is a black hole in the middle of a universe and we have this jet coming out and hopefully it will become clear what the metaphor is here. Feel free to ask questions as I go along. So the tldr, the summary slide is basically that I'm trying to achieve the same thing that we have for gateways. Sorry, the same thing that we have for relays. For gateways. So in the context of relays and PBS and mefboost, we have this very simple auction where basically where we have the auctioneer, the relay, take the maximum bid across all the bids that were provided by the builders. And really this is super simple from the point of view of the auctioneer and all the magic, all the complicated mathematics and modeling and simulations and whatnot is happening by the builders.
00:02:19.977 - 00:03:17.205, Speaker A: And what I'm hoping we can do is do the same thing for the gateways except that we replace the max by a min. And instead of having block bids that come from builders, we have so called preconf bids from prices. And so the basic idea is that we have different prices competing against each other to provide the smallest bit possible for, sorry, the smallest possible preconf tip for the users. So the talk will be in three parts. First of all, I want to highlight the problem, which in some sense is much more general than pre confirmations. And this is good motivation because it's something that the space is going to have to need to tackle regardless of pre confirmations. Then I'm going to talk about some of the design goals that I have for the gateway auction.
00:03:17.205 - 00:04:15.175, Speaker A: And then three, I'm going to talk about actual construction. Someone's microphone is not muted. Let me mute folks, just a second. Okay. Okay, let's start with the problem so in framing the problem, I'm suggesting two new terms. One is the window and the other one is the sacrifice, specifically the proposal window and the commitment sacrifice. So today what we have is this mental model where there's one slot, one proposer per slot, and basically one commitment per slot, which happens at the very end of the slot.
00:04:15.175 - 00:04:56.285, Speaker A: And this is the proposer window. It's the amount of time during which the proposer has monopoly power to sequence and order transactions. We basically have this one to one correspondence between slots, windows and commitments. But the basic observation is that this one to one correspondence actually breaks down in various situations. Situation number one is when you have multiple slots in a row. So you have one operator on Ethereum, for example, that controls two slots in a row. And so the window is now two slots.
00:04:56.285 - 00:05:58.725, Speaker A: And we've broken down this one to one correspondence. If we take an operator like Kiln, for example, which has about 5% of Ethereum validators, and roughly 5% of the time they're going to have two slots in a row and they're also going to have these two commitments. I guess the reason why I highlighted Kiln in particular is because they're fairly large, but also fairly sophisticated and willing to do experiments that are rational. And so it's possible that we're going to see some multi slot stuff at least at some point in the future. Another very interesting example is Solana, where even without the randomization, basically they have this mechanism where every proposer, when selected, is given four slots in a row and each slot is 400 milliseconds. And so the window, the minimum size of the window is 1.6 seconds.
00:05:58.725 - 00:06:27.759, Speaker A: It could be multiples of that. So it could be 3.2 seconds, for example, if one large operator was selected twice in a row, but at least it's 1.6. And you have this 4 to 1 ratio between slots and windows. But things actually become even more interesting with Solana because they have this notion of ticks. So within one slot they have 32 ticks. Each tick is, I believe, 1.25
00:06:27.759 - 00:07:28.509, Speaker A: milliseconds. And they commit to the ticks in real time using this cryptographic function called a proof of history or delay function. And the idea here is that you need to feed in the so called shreds, which are like shreds of blocks, into your delay function. And it's difficult because of the laws of physics to go back in time and recompute the delay function on a different input. So effectively you're making these commitments within the slot. And so not only have we broken the one to one correspondence between slots and windows, but we've also broken down the one to one correspondence between commitments and slots. And because Solana in some sense is so ahead of the industry in this respect, it's possible that they're going to be faced with this pricing problem before everyone else.
00:07:28.509 - 00:08:24.659, Speaker A: And the bull case here is that Solana does all the work to try and address this problem. Now relevant to this talk is preconf. So preconfs also break down the one to one correspondence between commitments and slots, where we have lots of preconfirmations that happen during this lot. And pre confirmations are not unique to base roll apps or Ethereum. They can be applied more generally to leader based consensus mechanisms where there is a look ahead, so where you know who the next proposer is. So that's basically almost all blockchains with a few exceptions like Bitcoin for example, where because of the proof of work mechanism, you don't know who the next leader will be. Okay, so that was the first concept of a window.
00:08:24.659 - 00:09:20.695, Speaker A: But the other one is the notion of a sacrifice. So when you make a commitment which is intra window, so not at the end of the window but within the window, you have an incentive to make that commitment. So you're receiving some sort of tip. And the question from the point of view of the proposer here is to ask themselves, does the tip here compensate for what I call the sacrifice, which is the opportunity cost here of constraining yourself here. So if you make a commitment here, by the time you need to propose your block and make the final commitment, your hands are tied to a certain extent. So you're constrained and that could be negative, there could be a negative externality for you. And so you kind of need the tip to compensate for this constraint.
00:09:20.695 - 00:10:30.167, Speaker A: And two examples of sacrifice are related to congestion and contention. So let's say that you made a commitment at this point in time within the window to include a specific transaction at X gwei per gas and you think it was a good decision because more likely than not the block is not even going to be full. And so you might as well just include transactions. But it turns out that it was one of these blocks where there was a lot of congestion that happened in the next few seconds within the window. And so now you're at the end of the slot and you realize that had you not made this commitment, you would have had the option to include a transaction which is paying a higher gas price. And so here in some sense you're losing money relative to the counterfactual of not having done the commitment. And there's a very similar thing here with execution where there's some sort of price of eth.
00:10:30.167 - 00:11:44.347, Speaker A: For example, in US Dollars you can go buy or sell assets on Uniswap and then you for example, do a trade here and you realize that it was the wrong trade to do because the price moved against you. Okay, any questions on this first section before I move on? Okay, great. So part two goals. So there's various people involved in the auction and let's look at them. Let's look at the guarantees that we can provide them one by one. So first let's look at the the user and the wallet on the one hand. So one of the big guarantees that we want is for the auctioneer, which is the gateway in this case, to not front run the users whenever a pre confirmation request comes in.
00:11:44.347 - 00:12:54.229, Speaker A: And we want both to prevent the on chain front running, but also the off chain front running. So for example, if the price on chain and off chain of an asset is the same and there's a pre confirmation request that comes in that changes the price on chain, we don't want the gateway to go do the arbitrage, basically off chain. Instead we want the proceeds of the arbitrage to go back to the user. The other thing that we want is some sort of competitive pricing, right? We don't want to be in a position where the gateway can just single handedly do price gouging or just have arbitrary pricing. Instead we want the price to be fair and transparent and set by an auction. And so there's this idea of a price at auction that comes in. Then the other thing that we want is basically users or wallets to be able to capture the background.
00:12:54.229 - 00:13:38.783, Speaker A: So nowadays it's mostly wallets that are capturing the background. For example in the case of rabbi wallet or MetaMask. But it's possible that at some point some fraction of that or all of it will go back to to the user because ultimately they are the ones that are creating the flow. And then we also want this guarantee of optimal latency. We don't want a pre conf request to come in and for the gateway to just sit on it and execute it whenever it's best for them. And so we don't want any artificial delays. And from the point of view of the user, I want to have this guarantee that it's fill or kill.
00:13:38.783 - 00:14:50.453, Speaker A: So as soon as the gateway receives the preconf request, either it gets executed or it doesn't get executed, but the decision has to be done now and then and the user needs to be informed immediately. And the basic direction, kind of the basic hand wavy direction that I'm suggesting here is just use Suave here as infrastructure to try and satisfy some of these goals. So for example, no front running can be done using encryption. Here you have kind of an auction, a competitive auction that's happening within Suave. And then for the latency here, you can potentially rely on the notion of time within Suave, or you could have some sort of policing that is done by the wallet. Now on the other side of the auction, you have the gateways and the proposes. And this is maybe like the number one design requirement here that I'm trying to achieve, which is that we want the gateway to not be financially sophisticated.
00:14:50.453 - 00:15:52.683, Speaker A: So it's okay for them to be relay like in the sense that they are sophisticated from a DevOps perspective and they're sophisticated from a reputational perspective, but they don't need to have lots of capital or lots of fancy algorithms and mathematical models to price things. And so really what we want is the gateway to delegate the pricing to a class of actors which I call prices. Another kind of guarantee that I'd like is this notion called strict profitability. So every time a gateway gives out a pre confirmation to a user, they need to have some sort of guarantee that this is actually a rational move. They're making some sort of epsilon for every pre confirmation that they're doing. And there's kind of two flavors of this profitability. You could have profitability in expectation.
00:15:52.683 - 00:16:35.485, Speaker A: So if you're a very large operator, for example, then everything will smooth out and in expectation you'll make profits from your preconfirmations. But there's something even stronger, which I guess you could say it's in realization where for every single preconf you're actually making money. And then we also want this notion of no abuse. So we don't want users to be able to probe the auction, to leak information from the auction. And you don't want also to give a free option to the users. So in some sense. Well, in a real sense, the gateway has the last look.
00:16:35.485 - 00:17:37.555, Speaker A: It's not the user that has the last look. And again, all of this stuff is directionally something that that flashbots has been thinking about with Seraph. Now one notion that I guess that we have with pre confirmation is this notion of a max tip. So the user or the wallet is the pre conf buyer and they're willing to say I want this transaction preconfirmed and I'm willing to pay a certain maximum tip. This is very similar to a maximum priority fee that you're paying and this is more of a safety feature for the user. And then on the other hand you have the gateway proposer that is selling the pre confirmation and you have the notion of the minimum tip that needs to be paid by the user for the pre confirmation to go through. And this is this market set.
00:17:37.555 - 00:18:47.455, Speaker A: And so whenever the max tip is greater than the min tip here, then there is an actual trade, sorry, an actual pre confirmation that happens. And the reason why I mentioned this is because one of the questions that people ask is our preconfirmations for arbitrages are there for sophisticated entities. And at least in terms of the consumers of pre confirmations, let's assume that we have an arbor here that's that wants to buy a pre confirmation from a gateway. The way that they would set the maximum tip is that they would set it to the sacrifice minus epsilon for the arbor. So this would be the arbitrage opportunity that they want to capture. And on the other side the gateway will set the minimum tip that they're willing to accept to be the sacrifice plus epsilon because because of strict profitability they want to be able to make a profit for this particular preconfirmation. And so arbors will never agree with gateways on tip pricing.
00:18:47.455 - 00:19:58.375, Speaker A: And so really what pre confirmations are all about is for users. Users are willing to pay a UX premium, so they're basically willing to pay sacrifice plus epsilon, UX premium or something. And this UX premium needs to be greater than whatever the epsilon that the gateway wants to extract. Okay, now this is a bit of a side goal. This is my last slide in the goals is that it's actually possible that with pre confirmations we naturally have better OFAs. So the way that some of the OFAs work today with the wallets is that for example, MetaMask will sell access to, at least as I understand them, MetaMask will sell access to individual transactions in an auction. And let's say that I, I have the highest bid for this particular transaction.
00:19:58.375 - 00:21:06.485, Speaker A: Now it is my job to actually get it on chain and extract some sort of background from this transaction. And there's all sorts of uncertainty. So I don't know, for example, what is the pre state that I'm building on? I don't know because I'm basically a searcher that's including a bundle, but I don't know where this bundle will necessarily get included. I don't know if even if I will get included and executed within the next slot or in the next two slots or next three slots. And similarly, there isn't this notion of timeliness, but with preconfirmations, you can basically bundle the auction for the tip pricing, the preconf tip pricing with the ofa. And the OFA auction becomes better because you, you have guaranteed state, you know exactly what you're building on, guaranteed execution and guaranteed timeliness. And so what we could potentially hope for is that users and wallets on the other side of the OFA get a better deal.
00:21:06.485 - 00:21:42.495, Speaker A: And most importantly is that they get bigger rebates because there's like less uncertainty here in the auction. You're in a position where the various searchers can bid more aggressively. And that's going to lead to bigger rebates for the wallets today. But hopefully in the future, users also get a cut of the rebates. And then a nice thing is that it's a single unified auction. So right now every wallet has their own fragmented auction. So there's the MetaMask auction, there's the Rabi wallet auction, whatever it is.
00:21:42.495 - 00:22:44.065, Speaker A: And, and with preconfirmations, you basically have this one logical point, which is the gateway where a unified auction happens. So it fixes fragmentation in some sense of the OFAs. And then a really nice thing as well is that it's an OFA, which by default is turned on. It's not something that, not infrastructure that the wallets need to go build. So my understanding, for example, is that MetaMask acquired SMG, they paid potentially millions of dollars or whatever it is, they spent many, many weeks building their own proprietary ofa. It's a huge lift for the wallets to do all this work. It would be nice if there was just infrastructure that all the wallets on an equal footing could just plug into and provide all the benefits of these background rebates to themselves or to their users.
00:22:44.065 - 00:22:51.865, Speaker A: Okay, I've done a lot of speaking. Any questions so far?
00:23:01.975 - 00:23:14.755, Speaker B: Hey, Justin, can we go over the goals again? Particularly there's no financial sophistication and another goal and maybe we can dive into why those goals, like the strict profitability one, for example.
00:23:16.695 - 00:24:20.563, Speaker A: Okay, so I think no financial sophistication. The idea here is that the barrier to entry, to becoming a gateway is relatively low. So this is, you know, this is more of a, of a, you know, in order to minimize centralization. And I guess, you know, this might, all of these goals might be like Slightly less important once we have APS and we have like a very clean separation between our testing and proposing. So but you know, at least in the short term, I think this is important to have. And then strict profitability here basically is about giving proposers the confidence that opting into pre confirmations is a rational move. Because by default, giving a pre confirmation is constraining yourself in some sense, it's reducing the block value naively.
00:24:20.563 - 00:25:08.865, Speaker A: And so you need to be compensated with this tip. And the question is, is this tip greater than what you're losing? Now if you have this market kind of work for a period of time and it's been bootstrapped and maybe you don't need this in realization versus in expectation, maybe people will be fine just being profitable in expectation. But yeah, I guess it depends on the risk tolerance as well of the proposal. Does the proposer want the exact same rewards plus epsilon that they're currently having or are they willing to have more volatility and instead only be profitable in expectation?
00:25:10.325 - 00:25:23.915, Speaker B: Well, the per pre conf one is I think is a difficult optimization, right, because you're trying to optimize something that you don't know. So it's going to lead to a lot of overpayment. If that's a goal.
00:25:27.495 - 00:25:50.715, Speaker A: It may lead to overpayment. Yes, but you know, we'll go to that and we'll talk about that in the construction part of the, of the talk. Okay, but yeah, you're right. Like if I were to say that, okay, which one could be relaxed? Definitely this one in the middle is the one that could be relaxed as a, as a requirement.
00:25:53.095 - 00:26:06.435, Speaker B: First one it goes preference over like DevOps sophistication over financial sophistication, which is unclear to me why, but I'm happy to move forward as is.
00:26:07.295 - 00:26:38.231, Speaker A: Well, DevOps sophistication is. DevOps is like a commodity. Anyone can do, can do DevOps. But you know, financial sophistication is, it's much, much harder because. Why? Well, potentially it means that you need to be a very high volume trader on binance in order to get these lower fees. Or it might mean that you need to be very close to jump to have access to their microwave towers or whatever it is. It means that you need to have an army of PhDs or just that's the meme.
00:26:38.231 - 00:27:08.055, Speaker A: It's very, very difficult. The ultrasound relay for example, in some sense DevOps experts and it's like a rag tag, three people on a really, really tight budget. But financial sophistication think Winter Mute like think Jump or Jane street or something. So yeah, there's a very big difference in barrier to entry.
00:27:09.355 - 00:27:33.305, Speaker C: Justin, you just started. Sorry, go Mara. We just wanted to touch on this but I was just going to ask two quick questions which is one, who do we expect the gateway operators to be from the current set? Are they the relays? And then two, related to that, what are the economics for them? So this per pre confirmation profitability is interesting but does it go to the proposer? Does it get split? Is there a standard there? Because we've been down this road before.
00:27:36.645 - 00:28:35.127, Speaker A: Right. So who would it be? Well if we look at the skill set DevOps and reputation that aligns very much with the relays and we actually have three different relays, the Estus relay, the Titan relay, ultrasound relay, they have all kind of signaled that they'd be interested in spinning up a gateway. And then you're right. In terms of the epsilon for the gateway, where is it? Yeah, that would be split between the proposer and the gateway in the same way that so yeah, here, the epsilon for the gateway here is actually split between the proposer and the gateway. And what I expect will happen is that the gateway will take none of it, at least at the beginning. Just like relays didn't take anything. And it's actually a very similar thing to the relay.
00:28:35.127 - 00:29:00.695, Speaker A: So to the wallet user like right now 100% gets taken by the wallet. But I don't think that's a long term equilibrium. Eventually once there's competition between wallets and whatnot, what I expect will happen is that there will be rebates given to users to incentivize users to join this particular wallet and eventually in the long term almost everything will be given to the users.
00:29:02.075 - 00:29:36.745, Speaker C: On this point I would strongly encourage us to consider rational economic incentives for the gateway operators because we'll have a network that's dependent on awesome DevOps. We have people who benefit economically but we don't incent the people who are doing the hard work of that. I'm not saying how what the incentives should be, but I think one of the big weaknesses of the current relay market is the lack of this. And so I would hate to see us here repeat that same pattern. And now we have all sorts of out of band incentives that get weird quick. So anyways, just my two cents.
00:29:37.125 - 00:30:06.695, Speaker A: Yeah, I mean it depends on your time horizon. Like if you're like short term in terms of like your time horizon is only a few years, then yes, it is a problem. If your time horizon Is the end game in some sense, then it's not a problem because of aps. With aps, there aren't two entities a proposal in Gateway, there's just one entity which you could call the Gateway, I guess that just wins the execution ticket or wins the execution auction and there's no proposer in sight.
00:30:09.635 - 00:30:30.949, Speaker C: Again, that would then suggest that we're back to financial sophistication. Because the only people who can play this game are those who have the financing necessary to wait until the end game. Right. And so my view of the financial sophistication is you don't want to have deep pockets in order to. You don't want to require deep pockets to play. Right. So hey, the only way to do this is if you have $100 million bank, because not everyone's going to have $100 million bank.
00:30:30.949 - 00:30:43.705, Speaker C: Right. Similarly, do we want to create an open market for Gateways or any ragtag group of three guys can do it, or do we want to have a insurance? So anyways, we've been down this road before, so I'll stop. But just food for thought about incentives here.
00:30:44.685 - 00:30:52.285, Speaker A: Yeah, you're right. It has the same issues as relays for in terms of being sustainable.
00:30:53.865 - 00:30:58.185, Speaker D: I also have a quick question about this arbor slide that shown.
00:30:58.265 - 00:30:59.993, Speaker A: Yes, and so there's this one.
00:31:00.169 - 00:31:03.881, Speaker D: Yeah, exactly. So there's this sacrifice now both for the ARBA and the Gateway.
00:31:03.913 - 00:31:04.081, Speaker A: Right.
00:31:04.113 - 00:31:21.695, Speaker D: And it seems that this conclusion assumes it's the same kind of. But so I mean, if the Gateway, I would assume, does not do the arbitrage himself kind of, I'd say that the arbor could potentially make more profit than the Gateway would lose from this opportunity.
00:31:23.915 - 00:32:19.485, Speaker A: Yeah, So a great question. So even though I'm trying to argue here that the arbor is not a buyer, the arbor will actually be on the seller side of things. And here I showed Gateway, but actually it's Gateway plus prices. And so you basically have all the prices combined that are competing against each other. And so any individual arbor maybe won't be able to compete against the set of all arbors here on the right hand side. But you're right. If it so happens that there's one arbor that's just extremely good relative to the others, then yeah, sure, they can make use of of pre confirmations, but I don't know if the pre confirmation buys them anything.
00:32:19.485 - 00:33:37.695, Speaker A: Maybe it does. Maybe they can make all of their profits just by being on the other side here or by basically participating in the final block building, which I guess is the polishing stage. Where you take all the older pre confirmations and then you do the final background over the whole block. But yeah, I agree with your initial statement that if one of the searches is exceptional here, then yes, they can be on the left hand side. But the thing is that it's maybe not rational I guess for the arbor to be on the right hand side purely because of the last look thing. So a request takes time, even if it's say one millisecond. And so there's going to be one millisecond at least of adverse selection where in some sense the right hand side here will only pick your arb if the price moved against you on the left hand side, whereas if it moved in your favor then they'll say no, sorry, your max tip is not high enough.
00:33:37.695 - 00:33:45.735, Speaker A: And so really as an arbor you want to be on the right hand side here because you have the last look.
00:33:47.115 - 00:33:55.975, Speaker D: But it's kind of also assumes that you allow the arbors to be this prices. It depends. Also how do you select, how does the gateway select these people?
00:33:56.425 - 00:34:53.131, Speaker A: Aha. Great question. So this is where Suave comes in, where you want this to be maximally open and permissionless and in order to do that you need privacy because otherwise you need trust and you can't trust all the arbors. But yeah, we'll talk about that a little bit in the construction section. So relays today the trust foundation is just pure reputation, I guess, and I guess that's fine. It scales to a certain extent. So if you look at MetaMask, my understanding is that Metamask only sends their flow to two or three builders because those are the only ones that have enough reputation to be trusted to not front run either on chain or off chain and not do other bad stuff with the flow, which is, you know, in plain text.
00:34:53.131 - 00:34:54.295, Speaker A: It's not encrypted.
00:34:58.515 - 00:35:23.817, Speaker E: I just, I wonder around some of these dynamics if you have like cash settled like block space features and that could impact some of the dynamics of who would be a buyer or a seller outside the constraints of just thinking about transactions on chain. I don't know, like the implications. But just one thing I was kind of thinking through, like does this impact some of the assumptions we're making or we can't design for something? You know, there's obviously not cash settled.
00:35:23.841 - 00:35:26.405, Speaker A: Box based features, but there could be at some point in time.
00:35:28.345 - 00:35:40.965, Speaker E: It's like you may want to be on one side of this for other reasons unrelated to a transaction in the current spot gas price, but for some other reason because you sold a block space feature or went long one that's, that's in a cash subtle market.
00:35:44.795 - 00:36:19.595, Speaker A: So just to make sure I understand. So basically what you're saying here is that I have this model where there's a window and there's like an intra window commitment. And what you're saying is that the commitment doesn't even have to be within the window. It could be like ahead of the window where you're selling a block space future. And yeah, it's the same problem. You want to make sure that the tip that you're receiving for making this commitment is greater than the sacrifice at the time that you make your final commitment here. And maybe this is another example of this more general problem that we need to solve.
00:36:19.595 - 00:36:49.785, Speaker A: I mean another example where the correspondence between windows and slots starts breaking down is denial of service attacks. Let's say that I control one slot and then I don't control the next slot, but I control the slot after that. Now I'm incentivized to go denial of service attack the guy in the middle. And now, ta da, I've created my window just by ddosing the guy in the middle.
00:36:58.205 - 00:37:05.465, Speaker F: When you said arps, are you thinking also about six ticks arbitrage or just dick sticks?
00:37:05.965 - 00:37:08.333, Speaker A: In Sextex? Yeah. As well?
00:37:08.349 - 00:37:18.785, Speaker F: Yes, yes, in Sextex. So the gateway will know the sacrifice in that case too.
00:37:21.205 - 00:38:16.739, Speaker A: Well, this is the thing. Like this value here is kind of an emergent thing from the auction. Like the gateway is unsophisticated, it doesn't have direct connections with the sexes. In some sense it's for the market to tell the gateway what the sacrifice is. But yeah, this is difficult because actually I kind of cheated a little bit here. It's expected arbitrage as opposed to the actual arbitrage. This is the expected sacrifice at the end of the slot.
00:38:16.739 - 00:39:34.841, Speaker A: And being able to price the future is difficult. Being able to price it in low latency is even more difficult. And so what the construction part is going to be talking about is basically having the prices take all of the price risk related to this expected sacrifice. And then the idea is that pricing the sacrifice post facto, where you don't have this low latency constraint and you have full information about the full auction dynamics during the slot is, is quite a bit easier than pricing the sacrifice in real time with partial information. Okay, let me continue and then we can take more questions. So part three, construction. So the high level kind of structure that I'm suggesting here is that we have the user, the gateway the user sending a request.
00:39:34.841 - 00:40:30.385, Speaker A: And we have this block which has been partially built. So each strip here is like one shred or one tick or whatever unit of granularity you want to use. And it has been partially built. So the blue stuff is built, the top of the block is built, but not the, not the rest of the block. And this request is given to prices. And there's this competition amongst the prices to provide the smallest possible tip. And if the min tip that they're willing to accept as a group is less than the max tip that the user is willing to pay, then this transaction here in green gets added to the top of the block and the user is notified that there's a request, that there's a pre confirmation for that transaction.
00:40:30.385 - 00:42:00.915, Speaker A: And one of the things that I'm suggesting we do is that we use the prices to shift the risk. So the user, instead of paying the gateway the tip, the tip actually goes to the pricer, but a little bit like an insurance mechanism for the benefit of receiving this tip, which is the tip that the pricer was willing to accept, they need to compensate the sacrifice at the end of the slot. So just to put this in formulas here, the pricer kind of set that tip to be the expected sacrifice at the end of the slot plus the epsilon for the gateway. So that what makes the gateway happy and then plus an epsilon for the pricer itself. The pricer needs to be a profitable endeavor. And then what they compensate is at the end of the slot, or I guess sometime after the end of the slot, the actual realized sacrifice plus the epsilon for the gateway. And so the gateway, they have this strict profitability where they always make an epsilon relative to what they could have made had they not made the commitment.
00:42:00.915 - 00:43:21.875, Speaker A: So yeah, this is where the strict profitability comes from. And so as a pricer, I'm taking on the price risk. So for example, if there's unexpected congestion within the slot, then I'm going to have to pay the gateway much more than I received as a tip. If the price moved against me, then again I'm going to have to pay pay the gateway more than I received as a tip. But vice versa, if the default situation happens, which is that there isn't a full block in that slot, then I collect the whole tip essentially for myself and I don't have to pay the gateway anything other than the epsilon for the gateway. And so if we put ourselves in the shoes of the pricer, the pricer at this point in time during the window is receiving as a tip the Expected sacrifice, but then at the end of the window they have to pay the realized sacrifice. And going back to this question of which prices is the gateway going to work with? That depends on the trust foundations.
00:43:21.875 - 00:44:21.475, Speaker A: And there's this usual trust progression, I guess, which is first rely on reputation and then rely on tes and then rely on fancy cryptography. And I think it's okay to kind of fake it till you make it start. Just like relays have started with reputation. And then once Flashbots has perfected that TE technology, we can move to enclaves. And then eventually once the cryptographers, the applied cryptographers have something good enough, we can use threshold cryptography. And in these two regimes here on the right hand side, we can have any pricer trustlessly and openly participate in the price auction. And the mental model that I have here, going back to the opening slide, is that you have this black box of information.
00:44:21.475 - 00:45:02.425, Speaker A: You have the black hole in the middle here, which is this unified auction where transactions come in, strategies from prices come in, price feeds come in and nothing comes out except for this jet here which are the pre confirmations and necessarily have to be made public. So have this policy of like maximum encryption or like minimum plain text that is delivered to the public and yeah, that is the end of the presentation.
00:45:06.405 - 00:45:19.605, Speaker B: Maybe just a very quick question here, by swap, do you mean like a certain way of using TES or swap as ease out of the box?
00:45:20.305 - 00:46:09.615, Speaker A: No, I mean the general notion of suave, what it literally means like single unified auction for value expression. Basically this single place where there's an auction happening within the gateway and the trust foundations are either either one of these things. So traditionally when someone says suave they mean the TE based version of suave. But you could have an equivalent Suave which is just based on trust. So for example, the ultrasound team could just build Suave but without tes and he's like, trust me bro, kind of suave. And then you could also build this super fancy version of Suave based on official cryptography. And this is actually what Flashbots, you know, is working towards in the very, very long term.
00:46:26.835 - 00:46:53.525, Speaker F: What do you think about the granularity of these pre confirmations? As in do you think they will price per picom for pre transaction or something going to happen? Because if it's per transaction, seems like there can be two transactions coming and the later one might invalidate the first one, but it might be much more profitable to include that one. That kind of situation. It happened.
00:46:56.505 - 00:46:57.033, Speaker A: Right.
00:46:57.129 - 00:46:59.755, Speaker F: So I guess rational to like bundle.
00:47:03.295 - 00:48:00.187, Speaker A: Right. So I guess, you know, it would be rational for the gateway to be able to sit on a transaction request and execute it at some point in the future once you have more information, for example about other transactions. And this is something that I think we explicitly want to to prevent. And this is something that can be done with suraf, for example, where you can have this encrypted pre confirmation request that comes in and it will only get decrypted if an auction is run on it, an encrypted auction. And the minimum bid that the prices are willing to accept is lower than the maximum bid. So it actually transforms into a real pre confirmation. So let's say that the pre confirmation request is paying too low of a preconf tip.
00:48:00.187 - 00:48:15.295, Speaker A: Well, the encrypted transaction never gets decrypted, so it's not like the gateway now has the option to abuse it in some later point in the future.
00:48:20.045 - 00:48:50.335, Speaker F: Kind of related, but like how do you think the incentives will play out? Will the gateway actually be incentivized to run this whole thing as like who's gonna enforce this whole system from the L1 protocol or the pre comp protocol perspective? You just have. Or will the L1 pre comp protocol itself force this kind of pricing mechanism happening?
00:48:52.835 - 00:49:22.105, Speaker A: So this is fully off chain outside of the L1. And in terms of the entity that I expect will run it is the relays in some sense they already have this kind of sunk cost. Right. Like they have the reputation like for, damn it, it's free to leverage their reputation. And you know, they already have like a lot of the DevOps infrastructure to, you know, to run a relay. So they might as well like dual purpose. That.
00:49:25.005 - 00:49:39.805, Speaker F: Yes, but like from the proposer's perspective, they want to like delegate to whatever gateway that gives the most profit. And giving the most profit might not align recycled. That's being described here.
00:49:43.945 - 00:49:44.665, Speaker A: Right.
00:49:44.825 - 00:49:50.685, Speaker F: Some amount of batching might be just much more profitable and a gateway that does that might win the whole thing.
00:49:56.185 - 00:51:26.085, Speaker A: Right. So difference in profitability, I guess, from the gateways, assuming that this design wins out, what would be the same as for the relays? So it would be latency based, for example, and this is what we're seeing today. Like there's two relays that have almost all the blocks, one just because they have low latency and they are the ones that are providing the most rewards to their proposers. And then going back to Matt's question around how can gateways monetize here? Well, they can do the same thing that the relays can do, which is like the very top gateway that's more competitive than the other gateways can collect their little epsilon because in some sense they have sovereignty over this edge. This is something that they can capture. So assuming that they do capture their edge, then, then the first and the second gateway would provide roughly the same returns to the proposers. But you're right, just like there's profit switching, as a proposer, I'm connected to multiple relays, and I will profit switch in real time by picking the relay that gives me the best bid.
00:51:26.085 - 00:52:21.607, Speaker A: There probably will be profit switching across gateways that you trust, but it won't be in real time, as in within a slot. It will be across slots. So you connect it to one gateway and then you realize that some other gateway is better for you because it's geographically closer or whatever it is, then you can go switch to that other gateway. But again, really, the fact that proposers have to delegate to gateways is this ugly thing. Just because we don't have APS in the long term, all of these complications around delegation go away. Ellie, you have your hand up. Yeah.
00:52:21.607 - 00:53:04.821, Speaker A: So with the pricers and the gateways, it seems like the pricers also need pretty low latency as well as the gateways. So it seems to me, like, why doesn't the pricer just become the gateway and then they don't have to give this epsilon to the gateway. Right. So the prices are collocated to the gateway just like the builders are collocated to the relay. And you can ask yourself, okay, why? The same question for the relays, why aren't the builders winning out as relays? Top builder is the ultrasound. Top relays. Ultrasound relay, that's not a builder.
00:53:04.821 - 00:53:42.745, Speaker A: And same for Bloxroute. These top two relays are not builders. And I guess the reason is that, like, it's a different role, it's different skill sets. You know, there's a big component of reputation, for example, where you need to get the proposers to connect to you. I mean, yeah, reputation, I guess, is more important for gateways than it is for relays. And the reason has to do with the preconf liveness faults. So unfortunately, with pre conf liveness faults, you don't know how to attribute it.
00:53:42.745 - 00:55:01.885, Speaker A: Is it the proposer that went offline or the gateway that went offline? Either could have happened. And so you're basically trusting the gateway to either not go offline or if they do go offline, to compensate the proposer. And so from that perspective, there's it's not like a pure financial thing just by looking at the bids, but you also need to take into account of the risk of liveness failures from a specific gateway. And then going back to this choice of gateway question, I guess there's also a big aspect of the proposer having some element of preference for example when it comes to to censorship. So if they want to delegate to non censoring relays, then that's something that they can express in their delegation. But yeah, the good news is that the three relays that have signaled interest in becoming gateways are all noncensoring relays. Matthew.
00:55:05.825 - 00:56:02.867, Speaker G: Thanks Justin. So we had talked about this before, but I'm trying to understand the difference in experience for the user and the wallet. So when the user is interacting with the preconf gateway in this scenario you have all the pricers here they are paying some tip ahead of time that is like roughly equivalent to the value of the worst execution that they would receive if they didn't do a preconfirmation. What we're doing is we're moving the somewhat obfuscated cost to the user who sends a transaction to the public mental. Now they would get front runner or sandwiched and moving that to like ahead of time. Right. So the user is paying a preconf tip before the like the value is actually extracted.
00:56:02.867 - 00:56:11.815, Speaker G: So how do you think this affects like the user experience and like is this going to be a problem for adoption? I guess is my question.
00:56:13.475 - 00:57:21.805, Speaker A: Right. Great question. So I think front running will be like not a thing by the end of this year. Like the public mempool is dying and the reason why it's dying is because of front running protection. So like all the big wallets metamask rabi but I expect all the other ones will send their flow to these private OFAs to protect against front running. Now what I expect will happen is actually in some sense the opposite of what you were saying, which is that what about the background? Today users are not capturing the background just because the wallets are capturing everything for themselves. But this, what I'm suggesting here is accelerationist towards competition in the O phase and it's basically providing some amount of it's lowering the barrier to entry for wallets to participate in OA phase and it's providing some amount of transparency into the whole process.
00:57:21.805 - 00:58:13.605, Speaker A: And so what I expect will happen is that users will be like hey hold on, wallets are making how much per year and they're going to start asking for a cut. And the smaller wallets that don't have such a large share will start having a button which is like, do the transaction and pay me the back run. And the back run could be a few hundred dollars or whatever it is. And then when there's this acceleration risk aspect and competition across the wallets, then as I said, I expect the end game is that the user is actually getting the back run. So in some sense here this is the best deal possible for the user. They're getting protected from the front run, they're getting a background rebate, and they're getting the instant pre confirmation. What more could you ask for?
00:58:14.185 - 00:58:33.049, Speaker G: Well, yeah, I guess there's two different types of preconfirmation. I guess we'll hear the first is like an actual payment for where the user is receiving value. And I guess you could say that the preconfirmation tip is essentially negative or they're only paying like they are effectively paying a negative value.
00:58:33.097 - 00:58:33.377, Speaker A: Right.
00:58:33.441 - 00:58:39.317, Speaker G: Or you can imagine where the user is trying to make a, a transaction that would reduce the arbitrage available.
00:58:39.381 - 00:58:39.557, Speaker A: Right?
00:58:39.581 - 00:58:58.625, Speaker G: And so they're paying a tip and in this case then the value that they are paying would be positive. Right? And it would be paid upfront instead of what it is today, which is like obfuscated and kind of paid in like the slippage or execution price that they end up receiving on the swap.
00:59:00.085 - 00:59:18.955, Speaker A: I see what you're saying. So basically you're saying that okay, when the preconf tip is negative, that's all well and good, but when it's positive, they need to be sophisticated enough to realize that they would have paid that tip regardless of the pre confirmation.
00:59:22.375 - 00:59:31.545, Speaker G: Or they might have. Right, because they're paying the expected value here. Whereas if they did it today, then they might not actually have to pay anything. Price moves straight away.
00:59:33.685 - 01:00:44.345, Speaker A: Right? I mean, this has to do with, I guess, education of users. Like one kind of related thing is this idea of an informational preconf where basically you set the max tip to negative infinity so it will never execute as a preconf, but at least you'll get a response saying you were denied, you should have set your tip to X. And so now from an informational standpoint, you know what your expected tip is. And that could also be used for the wallets to do the initial bootstrapping and onboarding where, you know, they, they give the user visibility like this. This is the estimated tip that you're going to pay if you want, if you want it instantly preconfirmed. And then the thing is that they can update it, yeah, that did this latency. So it's like valid up to 100 milliseconds, let's say.
01:00:44.345 - 01:01:29.351, Speaker A: And then the cool thing is that they can update it every millisecond so as a user you can see how much it will cost. And maybe people will just stare at it and realize that sometimes it goes in their favor, sometimes it doesn't go in their favor. But this is the exact same dynamic to waiting on a slot by slot basis as opposed to tick by tick basis. I can do the trade now or I could do one slot in the future or two slots in the future. I know there's some element of uncertainty and gambling and sometimes the only thing that we're doing is changing going from slots to ticks. But you're right, there's a material difference.
01:01:29.503 - 01:01:42.515, Speaker G: In who you're paying because you also have to pay the epsilon to the price or in the gateway. And you're not only paying the expected value, which you would today for slot, you're also paying the epsilon of the price in the gateway.
01:01:43.655 - 01:02:08.715, Speaker A: Right, that's a fair point. So we need to give visibility to the user on the actual cost of the pre confirmation, which are the epsilons. And it's hard for me to know how big they'll be, but my hope is that they're on the order of $0.01 or subsent that kind of range.
01:02:09.575 - 01:02:09.927, Speaker F: Okay.
01:02:09.951 - 01:02:30.465, Speaker G: Yeah. So I guess maybe to reiterate, users are paying epsilon to receive the instant pre confirmation quality, right? That's the three. Yes, but they're still like the rest of the. The tip that they are paying is still the expected value that they would lose from submitting the transaction normally.
01:02:30.845 - 01:02:31.705, Speaker A: Exactly.
01:02:32.045 - 01:02:50.785, Speaker G: I can see how that would be a problem, but I think if we have better monitoring and better education that could be resolved. As long as we don't send this every every millisecond. Or else we could have a potential DDoS vector on our hands. Negative Infinity zips don't sound like a great idea to me.
01:02:53.645 - 01:02:54.505, Speaker A: Matt.
01:02:56.325 - 01:03:55.235, Speaker C: Two areas that I think probably worth worthy of further research down the line is understanding end user sensitivity to pricing. Because one of the things I am hearing anecdotally is users are not very sensitive to gas price and that users generally just take whatever the wallet gives them and doesn't really think twice about it. And so we're having a lot of conversation about is this overpriced or not? And it's perfectly possible that users just don't care or they care a whole lot less than we assume in return for predictable settlement. So just this is something that I think is we don't really know, but is worth thinking more deeply about. And in fact overpricing may be not a problem and actually maybe a feature, not a bug. So just a thought and then separately is sort of this whole notion of pushing down on the balloon. I do believe, and this is just my intuition, is one of the negative externalities of all of this will be increase in volatility in the base fee.
01:03:55.235 - 01:04:10.955, Speaker C: And so the good news is we'll get some certainty on inclusion. The bad news is prices will swing all over the place. That's just an intuition. And so these are two areas that I think are worthy as we go forward here of further investigation and contemplation.
01:04:15.495 - 01:04:56.065, Speaker G: Matt, let me just, real quick, let me just ask a little more about what you just said. So you said we've noticed that users are not super price sensitive. And I guess if we accept that, then fair enough, right? But I think what we can also understand is that many users are not time sensitive, right? So maybe as a user I'm willing to wait an extra five minutes if I get better execution on my trade. And in pre confirmation's case, maybe I'm okay with waiting six seconds, right? To to get. To avoid having to pay epsilon. And so I guess the price sensitivity is important, but also like the timeliness sensitivity is maybe what's especially applicable to pre conf.
01:04:57.205 - 01:05:20.725, Speaker C: Or I think to your point that there is maybe a bifurcation, there's a certain class of users that are price sensitive and, or you know, you know what I mean, there are sort of different things and interestingly we have examples on the time side where there's a solution out there called Gas Hawk that basically allows you to basically delay transactions in return for paying less price. And so we can learn from what Gas Hawk is doing.
01:05:26.585 - 01:06:40.685, Speaker A: So in terms of the volatility of the base fee, my intuition is that regardless of pre confirmations, we're going to have this, this flow of transactions come in and almost all the time the blocks are not going to be full. One interesting thing is the volatility of the tips. So the tips do get extremely volatile potentially when the blocks do get full because we revert to this first price auction. And in some sense pre confirmations have this potential to smooth out the tips. And the reason is that let's say that the tip when there's no congestion is 1 gui and the tip when there is congestion is 10 gwei. Well, what the prices could do is say, okay, well, the fair kind of expected tip is, let's say, two gwei. And so what you have the option to do as a gateway is just sell your inclusion preconfirmations at 2gwei per gas all the time.
01:06:40.685 - 01:06:47.765, Speaker A: And so instead of suffering the spikes, you just always get the two gwei.
01:06:55.235 - 01:07:06.855, Speaker C: Okay, just again, these are matters that are, I'm just saying, are worthy of research, not what's going to happen. My crystal ball is as hazy as the next guys, but I think these are things to consider.
01:07:16.075 - 01:07:58.985, Speaker A: I mean, it feels like pre confirmations, like, you know, dramatically, like open up a new design space. And it's a little bit like the early days of MEV Boost. Right? We're trying our best to try and predict what the second order effects will be, but MEV Boost has surprised us. Every six months. There's some sort of crazy stuff that happens. Okay, we're above time for the public part of the call, so I'll end the public part of the call now and open it up to general discussion.
