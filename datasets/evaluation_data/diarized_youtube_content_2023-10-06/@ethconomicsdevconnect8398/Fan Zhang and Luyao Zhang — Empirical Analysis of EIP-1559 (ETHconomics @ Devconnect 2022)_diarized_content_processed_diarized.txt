00:00:10.250 - 00:00:42.700, Speaker A: Hi. Everyone, this is Lu Yao. I have greetings from Shanghai. I really hope I could be in Amsterdam again because it's the hometown of one of my favorite philosophies finosha. However, I guess I would just have to wait for one or two months before I go to Europe for my summer conferences, but hope I could bring you the same energy and passion to share our work today. This is a very exciting work. Empirical analysis of EIP 1559 transaction fees, waiting time and consensus security.
00:00:42.700 - 00:01:17.590, Speaker A: So today we will present this talk in this content of table. First, I will have some background introductions for the general principles. Then we will break it down to present three major results. Finally, it will be the takeaways. So, I will be presenting the first half and then Fan will take over to present the next. You know, really thanks to ethereum. So we have such a wonderful conversation that is super intellectual and interdisciplinary.
00:01:17.590 - 00:01:51.258, Speaker A: So, our team ranges from computer science, economics and data science. Our background ranges from academia, industry to NCO. And very excitingly. We even have two undergraduate students on the list of the co authors. So it's also about innovative education and cultivate undergraduate research. Also, actually, we started this work during COVID-19 and we work across three time zones. Finally, this really sounds like a cooperation of metaverse.
00:01:51.258 - 00:02:28.726, Speaker A: So many of our co authors, including Fung and me, we have never met in person, so don't be misled by the last name. We share that millions of Chinese also share. Like we really have never met in person at all. And now we will show you some virtualization from our data. So, to confirm the theoretical talk by Professor Rafgaden. So first, this is the figure that Rafgaden just had explained to you. For year t one, five and nine, you can see the gas limit increases from 15 million gas to doubles to 30 million gas.
00:02:28.726 - 00:03:02.230, Speaker A: So that is a figure. The second figure is the distribution of the gas used during our data range. So you can see it's quite a little bit uneven and have the extreme spikes at the end. Another thing is, given the base phase updating rule, you can see the recycling behavior of the base phase after eipy five nine. Finally, it is the figures for the net supply. So Professor Rafgarden had mentioned. Because we bird the base phase, otherwise it's not going to avoid collusion.
00:03:02.230 - 00:03:43.442, Speaker A: So there will be some deflations on the ether supply. And here is our major results. So, we have data from blockchain, from mammal pool and even option exchanges. We get three major results by comparing what happens before and after the London Folk. So, to remain your game before the London Folk august 5, 2021, we are only having this legacy first price transaction fee mechanism. But afterwards we introduced the EIP one, five and nine. And as a user, you can choose either to adopt the Lexer first price or the EIP one five nine.
00:03:43.442 - 00:04:18.320, Speaker A: So the first major result is on transaction phase. So we find okay, yes. So the EIP five five nine London fork has small effect on the gas fee level. However, it mitigates intra block differences of gas fee paid. The second result is on waiting time. We found it really reduces users waiting time, which is opportunity cost to transact on ethereum. And finally, for consensus security, even though we increases the block size, we really don't see big effect that decreases the consensus security.
00:04:18.320 - 00:05:00.342, Speaker A: Some of the results are really inspired by Professor Rafgaden's game theoretical analysis. So here is kind of like our detailed contribution map. So for the transaction fee parts, it's really inspired by Professor Rafgarden's work. So he showed that the EIP five nine is not a solution for scalability. So in our data we confirmed that we find, yes, not much reduction on the gas fee level. And for the waiting time, actually we don't see very systematic theoretical analysis before that. That seems our new entry of findings for the first time.
00:05:00.342 - 00:05:54.810, Speaker A: And then for the consensus security part, actually we focused on different dimensions than Rafgaddin's work. So he focused on the incentive compatibilities of users, miners and user minor collusion interactions. In our data analysis, we actually did not analyze that part. We analyzed the three different dimensions which are for creep network node and minor extracted values. And here is the scope of our research. Basically, we collected data that is 70,000 blocks before the London fog and we kind of like cut the peer rate right after the London fog because during then there might not be too much adoption yet. So we take the 70,000 blocks after the 70,000 blocks of London fox.
00:05:54.810 - 00:06:50.762, Speaker A: We compare the evenly before and after when the adoption rate already reaches 20%. And worth mentioning, our data is very rich. We have data from five different sources. Some of them are blockchain data, some of them option exchange data. And I have to mention this very valuable data here, that is ephemeral, which were the mammal pool data that is collected by our computer. Scientists actually fence their part because they are running full ethereum for nodes. So actually already two weeks before the London fork, I was very anxious because I really don't know how to solve the memo, put data waiting time, negative problem and it's just such a magic.
00:06:50.762 - 00:08:18.134, Speaker A: Like their team had already collected that valuable data. And here I also want to introduce to all of you the methodologies from the economic side, like the economic intellectual metrics, like how we can analyze causal inferences of an event such as EIP one five nine from those data. So historically we started with the Nobel Prize in 2002 two psychologists that introduced the lab experiment which is okay if you want to study what is the effect of COVID-19 vaccine, you will randomly assign people attend our conference today want to take the vaccine and want to drink the water and you see the infection rate reduces significantly or not? However, that kind of lab experiment has strong internal validity because it's in a controlled environment. However, it would have less external validity because it does not cover too many people. Then we go to the 2019 field experiment. So, Nobel Prize again, so those people, they went to poor countries like India and tried to try different policies for alleviating poverty. So they have the policy conducted in one town and not in another town and compare whether their life income gets increases significantly.
00:08:18.134 - 00:09:07.622, Speaker A: So this would increase this externality. However, it's very costly. You need to apply for a big ground so you can travel to Indian and incentivize your experiment. And in 2021, last year, we have the Nobel Prize winner as the honorable price for an analyzed causal effect for natural experiment, which is something like EIP 1.59. So ethereum like EIP one five nine, many of the academias do not know yet, but I would really okay, so I just talked to 2021. Actually, EIP one five nine is natural experiment. So this is really a blessing for academia because in the future we can analyze all the EIPS to find costal inferences.
00:09:07.622 - 00:09:46.482, Speaker A: So why natural experiment is so good? Because you don't need to apply for fundings for subject payments to analyze an experiment just for research. It will happen. In reality, it's already incentivized and thanks to blockchain. So natural experiment plus blockchain has three other blessings. One thing is blockchain is transparent. All the data is already recorded, so you don't need to worry about data availability issue. The second is thanks to the asymmetric cryptography, all the users privacy already gets protected, so you don't need to apply for IRB.
00:09:46.482 - 00:10:47.180, Speaker A: Finally, because on ethereum it's a smart contract. So when you collect data, it's an automation process. All of those will make natural experiments something like EIP plus blockchain a big blessing for academia. And I really want to encourage more researchers like causal inferences and empirical researchers to research the data on ethereum blockchain. And here is the basic principle. So in general, if you want to study causal inferences, we have the assumption that we have controlled all the other factors that might affect the thing we want to measure. We have three things, for example, the waiting time as a measure that is the y axis and we have the controls, which are the block features and the exchange features because we do not want to see an effect from the graph it's just because of an NFT drop or it's just because of time change.
00:10:47.180 - 00:11:48.334, Speaker A: And once those get controlled so our data analysis methods would know that if EIP will not happen, the waiting time will just follow the trend as a dash blue line. However, when EIP one five nine happen, you will move up to the upper line and the difference will be the average treatment effect. I really think it's worth mentioning to do interdisciplinary research it's very important. We have open source code for interdisciplinary research, so all those methods are not that difficult. But right now are taught in course still in closed source software that not familiar computer scientists or data scientists are not familiar with. But it's actually very easy to understand. So for this endeavor, I have developed all the open source code in Python, and we released it in our research for this one.
00:11:48.334 - 00:12:55.018, Speaker A: But I'm also going to release more as open education resource in my future courses. And our major result on transaction phase is as follows. So, as I said, we control the block feature, which is the block size and block height. And we also control the exchange feature, which has a volatility and return of investment of Ether. And the feature we want to know is, once the adoption on EIP 1559 increases, how will it affect the two things? One is a median gas fee and another is intra block gas fee volatility and the results show that the first one will not change much because London fork is not the solution for scalability and the second one decreases significantly. So if you only see those figures without the scientific method we mentioned, you are not going to see clear clue on what is the change of the directions as you can see on this figure. And even if you see something, it might not be the correct direction.
00:12:55.018 - 00:14:16.400, Speaker A: It might be because of an NFT drop or something else. So what is the implication of our results? The first implication is yeah, in the future as also this is respondent with professor Rafgas'theoretical results we should further increase user experience by making fake estimation easier. So from his work he just said for the legacy option to be truthfully is a BSc National equilibrium which requires all of you to know how to do calculus and take expectations at least. But then Yip 1559 Auction is a symmetric x post equilibrium you don't need to take expectation, understand probability distribution and you can figure the optimal strategy out very simply in this case, for bounded rational players, it would avoid all the overbidding underbeading create bidding so then the volatility will be much smaller like what is comforting our data. So we should further think about it because people are bounded rational. So how can we design an easier fee estimation mechanism? The second is yeah, there is no clear impact on gas fee level so EIP 1559 will not be a solution for reducing gas in fee. We need to think about something else.
00:14:16.400 - 00:15:01.130, Speaker A: We also have some side results. We find actually, the higher the ethereum price volatility, the higher the gas fee levels. But for EIP one five nine right now, we did not take those into consideration. So maybe in the future we should design mechanism to reduce gas fee level when detecting high ethereum price volatility. So, worth mentioning, our research contributes to three major literatures, and two are Nobel Prize and one is the Turing Awards. So first we contribute for our transaction fee mechanism design and blockchain. Actually, it's not related to anything crypto or money or investment.
00:15:01.130 - 00:16:19.874, Speaker A: It states back to the Nobel Prize in Economics in 2007 about mechanism design. And we further linked to them even more advanced literature on bonded rationality and mechanism design. So the second literature we contribute to because we find the results about waiting time, that's about market congestion. So that dates back to Nobel Prize in Economics 2012 on market design. And very interestingly, Professor Aven Ross, in his Open Questions in market design, he had inventioned that many of the market design problems cannot be solved by economics alone because the situation is more and more complex and we would need the contribution from computer scientists to help adding more computational power to solve for the market design issue. And finally, for our consensus security part, it dates back to the terminal was in 2008 and 2030 for those familiar with by Jantin general problems. And I would say it's something like thanks to Ethereum, like computer science and economics meet again on Ethereum.
00:16:19.874 - 00:17:04.260, Speaker A: This is not the first time. And back to Herbert A. Simon, who is one of my idol. So he introduced a bounded rationality to computer science and become the father of AI and win Turing Awards in 1975. And he introduced the same bounded rationality to economics and he made contributions to cognitive psychology and management science. He owned Nobel Prize in 1978 and we are very excited to add on to his work by contributing adding mechanism design and blockchain to this space. And thanks Ethereum again for us to conduct this interdisciplinary research.
00:17:04.260 - 00:17:19.400, Speaker A: So, since I have been sharing the econ perspective now, I'm very excited to welcome Fine to share the computer science perspective, which is indispensable for the success of our project. Thank you.
00:17:21.690 - 00:17:57.266, Speaker B: Well, thanks Luya. I will take over from here. Sharon, can you see the slides? Yes, we can see. Sorry, I have to make this switch where I am. Okay. So one of the key findings of our study is that transaction fee mechanism like the EIP 1559 actually can have a surprising impact on the waiting time of transactions. Waiting time is the time that a user need to wait to commit a transaction.
00:17:57.266 - 00:18:39.970, Speaker B: And this is typically thought as a scalability issue. But nevertheless, we show that with a well designed transaction fee mechanism, waiting time can be reduced significantly. That's kind of an interesting observation. So waiting time, as I said, is how long a user need to wait for the transaction to be included in some block. So here we're not talking about block confirmation. We are just talking about the time that between when a user first sends the transaction and the time the transaction is included in some block. Right? So it's the difference between these two timestamps.
00:18:39.970 - 00:19:52.810, Speaker B: While this definition is pretty simple, measuring it accurately turns out to be pretty tricky. The time of inclusion is recorded on the blockchain but the time when a transaction enters the mempool is something not readily available. As we all know, mempool data is ephemeral if you don't collect it, it's gone and you cannot retrieve it later. So to carry out this study, what we did is we set up a system to collect and record mempool data approximately one month before the EIP is scheduled to happen. And our mempool collection system currently consists of four nodes geographically distributed across the globe. And we are working to add more nodes to this system and under the sponsorship of Ethereum Foundation and these nodes run modified gas clients and they're modified to record transactions as they enter the mempool. They record the timestamp along with the transaction.
00:19:52.810 - 00:20:38.562, Speaker B: So now you may think we have the blockchain timestamp and we also have the mempool timestamp. Now we can calculate the waiting time, but not so soon. There's a very subtle issue that tripped us and tripped some previous works and it's really not obvious. Let me illustrate this subtle issue with the example. So here we have a timeline. Suppose this red dot is the time when the transaction enters the ManPool and let's suppose the same transaction is later mined in block 1001. Okay? So in the block header there's a field called timestamp that's part of the block header.
00:20:38.562 - 00:21:34.780, Speaker B: It's recorded on the blockchain. So you can go to Ether Scan tool to get it. So it's very tempting to compute the waiting time as the difference between these two values, right? The time that transactions is ManPool and the timestamp in that block. But if you do so, you will see that nearly 50% of the transactions have negative waiting time. This really puzzled us and this also puzzled some previous works where they ran into the same issue but they had to basically give up and discard this native waiting time as outliers. So we kind of dig deeper. Initially we thought this is a network synchronization issue so we debugged the network, we added more nodes, we did a bunch of trials and errors but none of that really solved this issue.
00:21:34.780 - 00:22:16.338, Speaker B: So the AHA moment of this part of the project is really the realization that this timestamp is not the right timestamp to use. This is artifact of blockchain mining. This timestamp is when proof of work starts, not when it ends in proof of work mining or in proof of stake as well. Before you start mining the miner first need to assemble the block. So when the block is assembled, this timestamp is fixed. So this timestamp really is the time that the block is assembled. That's what miners usually put in a block.
00:22:16.338 - 00:23:13.634, Speaker B: But the mining process usually takes on average 13 seconds. The time that the waiting time should really be computed as the difference between the finish of proof of work mining and the manpo timestamp, not the start of proof of work mining. So we can plot the timeline differently to make this issue even more obvious. So here we have three nodes on the timeline. We have our nodes and the user sending the transaction and we have a minor. So the first thing that happens is the user will propagate the transaction through the peer to peer network, which will likely make to our node and one of the miners approximately at the same time for a regular user. And that's the time when we report the timestamp for the ManPool from the ManPool.
00:23:13.634 - 00:24:18.122, Speaker B: And that's also approximately the time that the miner will put in the block, because that's the time when the miner assembled the block and start mining. Miner will now go on mining for a while and come up with a block, including a transaction. And that block will be again propagated through the peer to peer network and at some point reach our full node. If we plot the timeline in this way, it becomes really obvious that the difference between block timestamp and mempo timestamp is not the correct way to calculate waiting time. Instead, we should calculate the waiting time as the difference between the time that our node receives the block and the time that it receives the transaction, the mempool. So now that we see the issue, it's actually not hard to work around the issue. There are kind of two solutions.
00:24:18.122 - 00:25:21.758, Speaker B: You can have a full node to record block time, the time that it receives the block from the peer to peer network. But actually there's another observation. We can use the timestamp in the next block, namely block 1002, as an approximation to the time that block 1001 is received on RFU node. Well, this is because miners are incentivized to start mining as soon as it receives the previous block. So the timestamp the miner will put in block 1002 should typically be very close to the timestamp that it receives block 1001 and against for a regular miner and for a regular user, the time that miner receives a block should be close to the time that our full node receives a block. And we did both and they are always, almost always the same. That further confirms this observation.
00:25:21.758 - 00:26:41.586, Speaker B: So that's how we collected the data from the mempool data and the block time data. We can now calculate the waiting time and see the effect of EIP on waiting time. So we find that the waiting time significantly reduces after the London fork from 7 seconds that's I think leave the mean of the waiting time to something like 10 seconds. This is possibly a result of easier fee estimation. For example, user may there's probably less underbidding and this also might be a result of the variable sized blocks. As Tim put it, maybe we are borrowing some capacity from near future to reduce the time that the transaction has to wait in the mempool. But there's yet no formal model that can explain this, right? So therefore, another point to make is this reduction of waiting time actually benefits both the transaction that adopt the new bidding style and the ones that don't.
00:26:41.586 - 00:27:55.170, Speaker B: So EIP 1559 actually improved the waiting time for all transactions, even though it's not all users have adopted it, at least by the time of our study. Another part of the result is we looked into the effect of EIP 59 on consensus security because the EIP changes some important security or consensus parameters such as block size and the incentives of miners and users. So the question is, does it affect consensus security? And to understand the impact, we identified three possible avenues through which the EIP might affect consensus security. They are fork rates, network loads, and the incentives, mev in particular. So I will now go through them one by one. It's well known that larger blocks could lead to more forks because larger blocks may take more time to propagate through the network. So this may lead to more forks and a lower threshold against adversary parties.
00:27:55.170 - 00:28:43.006, Speaker B: And so that's possibly a negative impact on the safety of consensus protocol. So our result right, so an EIP indeed introduces variable block sizes. Previously block size is kept over at 15 million gas. But after EIP, there's occasionally 30 million gas blocks in the network. So the question is, does that lead to more forks? Does that lead to significant increase of the fork? Well, this is not hard to figure out. In our study, we looked at the uncle rate in the ethereum blockchain. And our conclusion, our result is that there's a slight raise in fork rates.
00:28:43.006 - 00:29:40.390, Speaker B: It's about 3% raise in fork rates. So EIP does have a very mild negative impact on fork rates and therefore on security. But again, the extent of impact is very modest. Another natural question that's related is whether EIP will put the network under a significantly higher load. What is network load? Because EIP introduces variable block size. So at times there will be large blocks, much larger, like two times larger blocks than what we have previously. So during that period of time, the peer to peer network need to process more data and propagate more data, basically need to consume more resources.
00:29:40.390 - 00:30:32.230, Speaker B: So the question is, is that something to worry about? And the community actually debated about this Vitalik's argument. Actually he argued that this is not something so new because these short term spikes already happens before, even before the introduction of variable block size. Because of the stochastic nature of proof of work mining just due to randomness, it is possible that you get many blocks near short succession. So that also leads to a higher network load. So higher network load or network load spikes is not a new phenomenon, that's Vitalik's argument. So this is nothing to worry about. We want to validate this argument empirically.
00:30:32.230 - 00:31:25.718, Speaker B: So first we define a network load to something that can be measured. We define it as the average gas used per time unit over different time intervals. For example, over 20 seconds to 112 seconds, we can compute the expected average load, right, because on average, the gas limit of a block, the gas used in a block is approximately 15 million gas even after EIP. And the average block time is 13 seconds. If you do the math, the average gas consumption per second should be around 1.2 million gas per second, something like that. And this graph shows the result.
00:31:25.718 - 00:32:21.014, Speaker B: The measurement of network load for t equals 62nd. So to get this graph, we divide time into 62nd intervals and for each interval we calculate the average gas per second, average gas used per second. And this graph nicely summarizes the distribution of network load. So the y axis is network load and the width of the shape is proportional to the density. The wider it is, the more concentration around that particular network load. So, as you can see, first of all, the distribution is indeed centered around the expected average, something near 1 million gas per second. And second, we do observe spikes even before EIP and post EIP.
00:32:21.014 - 00:33:57.234, Speaker B: And we do observe a little bit larger spikes post EIP. But if you take the frequency of these events into consideration, our results actually confirms Vitalik's argument that the new EIP doesn't put the blockchain under a significantly higher load for an extended period of time. We do observe load spikes, but the change in frequency is not significantly the frequency is not significantly different before or after the London fork, right? So the takeaway yeah, is that the difference really is not significant. Another aspect of consensus security that we looked into is miners revenue, and in particular miners revenue from minor extractable values. The reason we are curious about how EIP might affect mev is that some miners resort to mev extraction as a way to help offset some of the potential revenue losses by EIP, or at least that's how they perceive the effect of EIP on their revenue. So we are curious to see whether indeed the mev extraction level changes before after EIP. And it's hard to measure EIP in the entire ethereum blockchain.
00:33:57.234 - 00:35:26.118, Speaker B: So we use the flashbots mev as an approximation. The reason is that Flashbots is by far one of the largest software that miners can use to extract mev and also just the fact that they have a very transparent API that exposes such data for analysis. So our observation is that the absolute value of EIP, sorry, the absolute value of mev extracted through Flashbot didn't change significantly before after the EIP, but because the base fees are burnt, mev becomes a larger share of miners revenue. And this graph plots the ratio between mev and the block gas and the fees from transaction fees from gas sorry, this is not block gas used, but transaction fees from gas. So you can clearly see an upward trend. This is simply because I think that the fees are base fees are burned, therefore miners revenue from gas reduces in general, but their revenue from mev roughly remains the same. So Mev becomes a larger share.
00:35:26.118 - 00:36:37.180, Speaker B: So the impact of this we don't have formal explanation for the impact of this, but we conjecture that this might create an incentive for miners to invest more in Mev extraction. Because indeed, as this news has reported, it's consistent with miners perception that the Mev extraction is kind of the level of extraction actually is not impact by the EIP. Okay, so so far the results we have presented is based on the data from about ten days before the EIP and about three weeks after it. Or 30 days after it. Yeah. So to verify the robustness of our conclusion, we extended the period of time by another two months. So we recently extended the result using data up until November of last year.
00:36:37.180 - 00:37:48.142, Speaker B: You can actually see that here's the plot for the waiting time for these two periods. This graph you have seen up until three weeks after the EIP, the reduction of waiting time is about 49%. Up until November last year, the reduction of waiting time is still very significant, about 41%. So this shows that the reduction of waiting time is not actually a short term phenomenon, it's something that seems persistent. So to summarize, in this study we use rich data from ethereum blockchain, Mempool and exchanges to study the impact of EIP 1559 empirically to complement the theoretical analysis out there. For example, the paper from Professor Ralph garden. So we find that there are at the high level three major findings.
00:37:48.142 - 00:39:00.198, Speaker B: We found that the EIP improves user, may have improved the user experiences by making fee estimation easier. As Tim put it, this can reduce the cognitive load because users can stick to the obvious optimal strategy. And indeed, we observe that bids are consistent with the optimal strategy. And another finding is that we find that if you reduces the waiting time, so transactions actually spend a lot less time in the man pool. That's an interesting phenomenon there's. As I said, no theoretical framework that can explain this formally, it might be due to easier fee estimation and the variable block size, but there's yet no formal understanding of this. And we also observed that the EIP has a small effect on small negative effect on consensus security in terms of fork rates and network load.
00:39:00.198 - 00:39:51.338, Speaker B: The increase of these two metrics is insignificant, but Mev does becomes a larger share of miners revenue after the EIP. So this leaves us with plenty of interesting future direction to explore. As Tim put it, this new mechanism design is something really cool and there are new findings that can be explained by existing theoretical models and understanding. Some of these. New findings in a formal way. And the rigorous way is interesting future direction. And also mempool data is something that we leverage a lot in this study.
00:39:51.338 - 00:40:57.854, Speaker B: And it actually enables us to understand blockchains in ways that are almost impossible otherwise. Without mental data, how would you measure waiting time? We are working with Ethereum Foundation under the sponsorship of Ethereum Foundation on a project to dig deeper into Memphis data to understand blockchains in various aspects. And finally we have published our data and script with the correct waiting time at that GitHub repo. We hope this will help other researchers to get a hold of the mempo data around that time period of time and also conduct follow up works. And with that I will wrap up the talk. The paper is posted on archive. You're welcome to take a look.
00:40:57.854 - 00:41:30.900, Speaker B: It's accepted in CCS 2022. And also we have published other authors have published the blog post at Decentralized Thoughts blog. So if you want to have a shorter explanation of the paper, you can check out the blog post. And again, the code and data is also published on GitHub. Thank you. I will stop here and we will take questions. Thank you.
