00:00:00.330 - 00:00:40.294, Speaker A: What I want to show you in this video is that uniswap b three time weighted average price is equal to the geometric mean which you can see over here. Now, it's a little bit difficult to understand what this formula is doing, so I'll also give you an example of how this geometric mean behaves, and hopefully that will provide you with some intuitive understanding of this geometric mean. First, let's review how uniswap b three computes its time weighted average price s. We'll say that Ti is equal to tick at I second. Now, recall that a tick is equal to one of these. So 1.1 raised to the power of tick will give us the price to get the average tick from time zero to n.
00:00:40.294 - 00:01:21.414, Speaker A: You will sum up all of the ticks from I equals zero all the way up to n minus one, and then divide it by the time interval n. This will give us back the tick average. Once we have the tick average, we can compute the price average and we do that by taking 1.1 raised to the power of tick average. Now, the equation to compute the tick average that you see over here is slightly different from what I showed you in previous video. In the previous video, we multiplied this tick average by the duration that the tick lasted. But for this example, we'll simplify the equation by saying that each ti lasts for 1 second.
00:01:21.414 - 00:01:50.350, Speaker A: So the duration that should be over here is one. One multiplied by the tick is equal to the tick itself, so we can omit the duration. The graph of this might look something like this. At t equals zero, we have tick zero. At 1 second we have tick one, and at two second we have tick two, and at 3 seconds we have tick three. Notice that tick two and tick three are the same. From tying 2 seconds all the way up to 4 seconds, the tick is the same.
00:01:50.350 - 00:02:22.138, Speaker A: But here, since we're adding each tick at each second, we say tick two. At second two is t to the two and the tick at three second is equal to t three. We do this all the way up to t to the n, but we only add up from t to the zero to t to the n minus one and not t to the n. The amount of seconds from zero to n minus one is n. So that is the n that you see over here. So this is how you compute the tick average and the price average. Let's now take a look at how this price average is the geometric mean.
00:02:22.138 - 00:02:45.318, Speaker A: We will start off with the price average. This is equal to 1.1 raised to the average tick. This is equal to 1.1 raised to the average tick, which is the summation of ticks divided by the duration. Let's expand this expression further. Since we're dealing with exponents, we can apply some simple algebra to simplify this equation.
00:02:45.318 - 00:03:32.814, Speaker A: If some base is raised to the x plus y, then this is equal to the base raised to the x multiplied by the base raised to the y. And the other algebraic formula that we will use is if a base is raised to the x divided by y, then this is equal to the base raised to the x, and then raise it to the one over y. Using this formula and expanding this equation, we get that this is equal to 1.1 raised to the first tick t zero times 1.1 raised to the second tick t one times 1.1 raised to tick two, and so ON, all the WAY up to TICK of N MINUS one. We take this whole equation and raise it to the one over n.
00:03:32.814 - 00:04:02.838, Speaker A: Raising a number to one over n is simply taking the n fruit. So we can write this equation as the n fruit of 1.1 raised to the tick zero 1.1 raised to the tick one, and so on, all the way up to tick n minus one. Where have we seen this equation before? Where we multiply n items and then take the n fruit. Well, this is the geometric MEAN. Now, looking at this equation, it's hard to see how this equation turns out to be the price average.
00:04:02.838 - 00:04:32.354, Speaker A: So what I'm going to do is rearrange this equation so that you can see how this geometric mean is the average price. So, first, we'll name some variables, and this will make the equation easier to read. We'll say that p zero is a price at zero. Second, so this will be 1.1 raised to the tick zero price, one is equal to 1.1 raised to the tick one, and so on, all the way up to price of n minus one. This will be 1.1
00:04:32.354 - 00:05:14.958, Speaker A: raised the tick to the N minus one. Next, we will write this equation above using these variables that we just defined. So this equation will be equal to the nth root of p zero multiplied by p one, multiplied by p two, and so on up to p to the n minus one. Now, we can rewrite this equation by multiplying each term by p zero, and then dividing it by p zero, multiplying each term by p zero, and then dividing it by p zero that is equal to one. So this equation is equal to this equation. We're multiplying p one by p zero and then dividing it by p zero. We're multiplying p two by p zero again, and then dividing it by p zero.
00:05:14.958 - 00:05:34.086, Speaker A: We repeat this process all the way up to p to the n minus one. Now, let's count how many p zeros we multiplied for p zero. We have one p zero. Next to p one, we have another one. So now the number of p zero is equal to two. Next to p two, we have another p zero. So now the total amount of p zero is equal to three.
00:05:34.086 - 00:06:19.334, Speaker A: And we continue this process. And we can count that there are n p zeros in total. We are multiplying n p zeros here, and then taking the n fruit so we can pull out the p zero, which you see over here. And the equation we get is p zero multiplied by taking the n fruit of p one divided by p zero, p two divided by p zero, and so on to p to the n minus one. So what can we say about this equation? How can we interpret this? Let's start with the easy one. What is p zero? Well, p zero is, by definition, the price at time zero. How about each of these ratio? For example, what does p two divided by p zero mean? Well, we can interpret this as price change from p zero to p two.
00:06:19.334 - 00:07:05.906, Speaker A: For example, let's say that p zero is 3000 and p two is 3000. 303,300 divided by 3000 will give us back 1.1. So, in that case, price change from p zero to p two will be 1.1. So what we're doing here inside the amp root is we're multiplying each price change from p zero and then taking its geometric mean. So this whole equation, what it's doing is multiplying the first price, p zero, by the geometric mean of the price changes from p zero, which you see inside the green box. Let me give you a simple example of how this equation behaves. Let's say that p one, p two, p three, and all the way up to p to the n minus one are very close to p one.
00:07:05.906 - 00:07:46.898, Speaker A: If we were to compute the average price, then we expect this average price to be something close to p one. Since most of the terms are very close to p one, let's see if this assumption is true. By definition, the price average is equal to p zero multiplied by the nth root of p one divided by p zero, p two divided by p zero, and all the way up to p to the n minus one. This is the formula that we derived over here. Now, since all of these terms, p one, p two, all the way up to p to the n minus one is very close to p one. So we can reason over here that each of these term is close to p one. We will replace each of these terms with p one.
00:07:46.898 - 00:08:16.346, Speaker A: And we get this equation over here on the right. P zero multiplied by the n fruit of p one divided by p zero multiplied by p one divided by p zero. Then we do this all the way up to the n minus one term. This equation should be close to the price average. Since all of the prices are close to p one. We just replaced all of these terms with p one. Since there are n minus one, p to the one divided by p to the zero.
00:08:16.346 - 00:08:56.630, Speaker A: We can simplify this equation and we get p zero multiplied by p one divided by p zero raised to the n minus one over n. Over here, there are n minus one, p one divided by p zero. So that's that n minus one you see over here. And since we're taking the n fruit over here, here, you're seeing n at the bottom. Now, if n is a very large number, then n minus one over n is very close to one. So this expression over here is close to p zero multiplied by p one divided by p zero. The p zeros cancels out, and we get that this equation is equal to p one.
00:08:56.630 - 00:09:11.900, Speaker A: In other words, when all of the prices are close to p one, then the price average is also close to p one. And that validates our guess that when all of the prices are close to one of them, we'll say p one. Then the price average is also close to p one.
