00:00:00.330 - 00:00:47.398, Speaker A: To correctly calculate fee growth inside a position, we'll need to consider three cases. Both the lower tick and the upper tick are not initialized, one of the tick is initialized, or both the ticks are initialized. In this video, we'll calculate fee growth inside when both of the ticks are not initialized. Let's first review what we found out so far. So we said that f alphabi. We defined this to be the fee growth outside at tick I and to initialize this, we initialized it to the current fee growth f of g if the current tick IFC is greater than or equal to this tick I. Otherwise, we initialize it to zero and then whenever the current tick ifc crossed over this tick I, we updated f alphaby to be f of g minus the previous f alphabi.
00:00:47.398 - 00:01:23.480, Speaker A: This is the algorithm that we will be using to track f alphabi. Next, we simplify the equation for phi inside. Phi inside we define f of I lower and I upper to be phi inside the tick I lower and I upper. Then we found three equations for phi inside. We'll be using this equation when the current tick I of c is less than tick I lower and we'll be using this equation if the current tick IFc is in between I lower and I upper. If the current tick IFC is greater than I upper, then we'll be using this equation. We'll be using all three of these equations in this video.
00:01:23.480 - 00:02:26.246, Speaker A: Now, we'll need one more equation to correctly calculate fee inside a position. Let's say that at time t zero, a position was created and then sometime later at time tk we claim the fees and we want to calculate what is the fee growth inside this position. We'll define f of zero to be equal to f of I lower and I upper. So this is fee growth inside tick I lower and I upper at time t zero and likewise we define fk to be f of I lower, I upper at time tk. Now, to correctly calculate the fee growth inside the position, what we'll need to do is take fk minus f zero. By using this equation, we will be able to correctly calculate the fee growth inside the position regardless of how the position was initialized, whether both the ticks were not initialized, or either one of them was initialized, or both of them were initialized. So for the last part of this video, we will use this equation to calculate fee growth inside for the case when both I lower and I upper are not initialized.
00:02:26.246 - 00:02:59.986, Speaker A: So let's calculate Fk minus f zero when both ticks I lower and I upper are not initialized. Now, there are three cases to consider. When the current tick IFC is lower than I lower. When the current tick IFC is in between I lower and iupper, and the last case, when the current tick IFC is greater than I upper, we'll start with the first case of when the current tick IFC is less than I lower. So when the current tick IFC is less than I lower, let's imagine this case. So here we have tick I lower, and here we have tick iupper. Both of these ticks are not initialized.
00:02:59.986 - 00:03:41.538, Speaker A: Let's say that at time t zero, we initialize this position between I lower and I upper. And at this point, the fee growth is over here, FG zero. Let's also say that at some time later, the fee growth crossed over tick I lower. This is at fg one, and then at time t two, let's say that fee growth is somewhere over here, fg two. Now, in this case, let's calculate fk minus f zero. Again, remember that this represents the fee growth inside these two ticks, Il and iu. Looking at this graph, we expect the fee growth inside to be the difference of the height, f g two minus fg one.
00:03:41.538 - 00:04:18.238, Speaker A: So when we calculate this equation, we expect the fee growth inside to be equal to fg two minus fg one. So let's start out by calculating f zero. F zero is the phi growth inside il minus iu at time t zero. So, to calculate f zero, we'll use the equation that we listed above. And again, remember that the current tick I of c is less than I lower. So, scrolling back up, when the current tick I of c is less than I lower, we'll need to use this equation. So, going back down, f zero is equal to f out of I lower.
00:04:18.238 - 00:04:42.678, Speaker A: Minus f out of I upper. And what are these equal to? Well, since f out of I lower is initialized to be zero, and f out of I upper is also initialized to be zero, this will be equal to zero minus zero. In other words, f out is equal to zero. Let's also do the same for f o two. The fee growth inside. At time t two. At time t two, we have the current phi growth over here.
00:04:42.678 - 00:05:13.730, Speaker A: And this is in between the tick I lower and I upper. So, scrolling back up, the equation that we'll need to apply is this second equation. Going back down, f two is equal to f g two. Minus f out of I lower. Minus f out of I upper f g two is equal to f g two. How about f out of I lower? Well we know that f out of I lower was initialized to zero and then at time t one it crossed over. Tick I lower.
00:05:13.730 - 00:05:45.434, Speaker A: So what we need to do is apply this algorithm to update f alphab I lower. Since it crossed over. Tick I lower. So going back down f alphabi lower will now be equal to f g one minus zero. Since f alphabi lower previously was equal to zero, at time t one it crossed over. So we'll need to apply the algorithm to update f alpha by lower. Okay, how about f alpha by upper? Well, since nothing has changed, this is still equal to zero.
00:05:45.434 - 00:06:16.066, Speaker A: Okay, and we're now ready to calculate f two minus f zero. And this will give us the phi growth inside il and iu f two minus f zero. If we simplify f two, we can see that this is equal to f g two minus f g one. So the first part is equal to f g two minus f g one. And how about the second part? F zero. Well, f zero is equal to zero. So f two minus f zero is simply equal to f g two minus f g one.
00:06:16.066 - 00:07:04.590, Speaker A: And if we take a look at this graph visually, we can see that the fee growth inside il and iu is equal to fg two minus fg one. And our equation stays the same. Next, let's calculate fee growth inside when the current tech I of c is in between I lower and I upper. Here we have a graph and let's say that I lower we represent this as il and I upper, we represent this as iu. And again, both of these ticks are not initialized. Let's say that when we initialize this position, the fee growth is somewhere over here at f of g zero. So when we initialize this position, we'll need to apply this rule over here, we'll need to set f out of I lower to be equal to the current phi growth.
00:07:04.590 - 00:07:44.654, Speaker A: Since I lower is less than or equal to the current tick ic. So going back down over here, we'll need to initialize f altob I lower to be the phi growth fg zero and f altob I upper, we'll initialize this to be equal to zero. Let's say at time t one, the current tick crosses over the upper tick. And then at time t two we want to calculate fee growth inside I lower and I upper. And looking from this graph, we expect this to be equal to f of g one minus f of g zero. To begin with, let's calculate f of zero. This will be the feed growth inside at time t zero.
00:07:44.654 - 00:08:15.114, Speaker A: Okay, so we'll need to apply one of the three equations that we listed over here. Now this case is the current tick I've seen in between tick I lower and I upper. So we'll need to apply this equation. So going back down, f zero is equal to this equation. The first part, f of g zero is equal to f of g zero. The second part f alphab I lower we initialize this to be f of g zero. And the third part f alphabi upper we initialize this to be zero.
00:08:15.114 - 00:08:45.210, Speaker A: F of zero is equal to f of g zero minus f of g zero minus zero. Or simply this is equal to zero. How about f of two? Phi growth inside at time t two. At time t two we have the current tick above tick I upper. So which equation do we need to apply? Well, in this case, we will need to apply this equation going back down. Okay, let's start with f out of I upper. At time t one, the phi growth crossed over I upper.
00:08:45.210 - 00:09:41.622, Speaker A: So we'll need to apply the update algorithm. The one over here before f out of I upper was equal to zero, and then when it crossed over we'll need to update it by f of g minus f out of I. So going back down at time key one, we'll need to do f of g one minus the previous f alto by upper this will be equal to f of g one minus zero, or simply f of g one. Okay, how about f alto by lower? Well this is equal to f of g zero. And you can see this over here that it was initialized to f of g zero and it has not changed since. How about f two minus f zero? Well it will be simply be equal to f g one minus fg zero. F two is equal to this f g one minus fg zero and f zero is simply equal to zero.
00:09:41.622 - 00:10:29.894, Speaker A: Okay, so this is the equation for phi growth inside. In this situation f g one minus fg zero. And we can verify visually that phi growth inside is f g one minus f g zero, which is equal to this equation. The last case that we'll consider is when the current tick I Ofc is greater than tick I upper. Imagine the case we have I lower and I upper, and both of these ticks are not initialized. When we create a position, the fee growth will be over here above both of the ticks. And let's say at time t one, the current tick cross below tick I upper and then at time t two we have the current tick in between I lower and I upper and what we're going to do is calculate the fee growth inside at time t two.
00:10:29.894 - 00:11:19.810, Speaker A: When the current tick is in between tick I lower and I upper. Again, we'll start by calculating f of zero. So again, remember that at time t zero we have the current tick IOC over here, which is above both I lower and I upper. So going back up, the equation that we'll need to use is this equation f alphabi upper minus f alphab I lower. Okay, so what is f alphabi upper equal to? Well, when we initialize this position, we note that the current take is above both il and iu. So this means that we'll need to initialize f alto by lower to be the phi growth f g zero. And likewise we'll need to initialize f al sub I upper to be the phi growth f g zero.
00:11:19.810 - 00:11:56.530, Speaker A: So f alphab I upper will be equal to f g zero. And likewise f out of I lower will be equal to f g zero. So f zero will be equal to zero. Okay, how about f two? At time t two we have the current tick over here in between tick lower and tick upper. So which equation do we need to use? Going back up, the equation that we need to use is this second form. So this is equal to f g two is equal to f g two. How about f out of I lower? Previously, f out of I lower was initialized to be f of g zero.
00:11:56.530 - 00:12:35.646, Speaker A: This has not changed and it is still equal to f g zero. Okay, how about f out of I upper? Well, notice that f out of I upper at time t one, the tick crossed below tick I upper. So we'll need to apply the update algorithm. At time one, fee growth was equal to f g one. Then before that it was equal to f g zero. So once we apply the update algorithm to tick iupper, we get that the current f alto by upper is equal to f of g one minus f of g zero. We can see that we have a minus f of g zero here and then a minus minus f g zero here.
00:12:35.646 - 00:13:18.674, Speaker A: These two cancel out and we're left with f g two minus f g one. And that's the f two minus f zero. F zero is equal to zero and f two is equal to f g two minus f g one. So f two minus f zero is equal to f g two minus f g one. Okay, does this equation look correct? Well, looking at this graph, we can see here that the phi growth inside must be equal to the difference of fg two and fg one. So this is the fee growth inside when the two ticks were initialized below the current tick. To summarize, we verified that this equation correctly calculates the fee growth inside when both of the ticks are not initialized.
00:13:18.674 - 00:13:32.570, Speaker A: In the next two videos, we'll do something similar. We'll calculate fee growth inside using this equation when one of the tick is initialized, and in another video, we'll calculate the fee growth inside when both of the ticks are initialized.
