00:00:00.410 - 00:00:46.614, Speaker A: In this video, I'll explain how to calculate time weighted average pricing. Let's say that the price of beef in US dollars is 100 from zero to 4 seconds. And at four second, we observe that the price of beef is $200. At 5 seconds, we observe that the price of beef has gone down to $100. Again, how do we calculate the time weighted average of ETH price from zero to 6 seconds? The time weighted average price, T wop, is equal to the price of e was 100 from zero to 4 seconds. So it'll be 100 times 4 seconds over the duration of 6 seconds. So that will be four over 6 seconds.
00:00:46.614 - 00:01:25.330, Speaker A: At 4 seconds, the price of beef is 200. And this last for 1 second. So it'll be plus 200 times 1 second over the total duration of 6 seconds. And finally, it is $100 for the last 1 second. So that will be plus 100 times one over six. Now, the common denominator of this expression is six. So we can rewrite this equation as equals to 100 times four plus 200 times one plus 100 times one over the whole duration of 6 seconds.
00:01:25.330 - 00:01:43.982, Speaker A: Let's do the math. This is equal to 100 times 4400 plus 200. So that'll be 600 plus another hundred. That will be 700. 700 over six. And using my calculator, this turns out to be 116.66. And so on.
00:01:43.982 - 00:02:16.214, Speaker A: Let's come up with a general equation for what we just computed here. Let's say that the price of ef is p zero from times t zero to t one, and at t one, the price is equal to p one. At t two, the price is equal to p two, and so on, all the way up to t to the n. At t to the n, the price is equal to t to the n. Let's do the same calculation for what we just did over here. Except we will be using variables. We will compute the t wop from times t zero to t to the n.
00:02:16.214 - 00:02:54.130, Speaker A: What is the average price? Well, this is equal to p zero times the duration that the price was at p zero. This will be from t minus one to t zero. So here I'll type t one minus t zero plus the duration that the price was at p one. Well, for p one, that will be from t one to t two. So the duration will be t two minus t one. And we continue this process until t n. The price for the duration from T n minus one to t to the n is p to the N minus one.
00:02:54.130 - 00:03:31.934, Speaker A: So here we will write the price P to the N minus one multiplied by the duration. That will be t to the N minus t to the N minus one. Like what we did over here, we'll have to divide this Whole Expression by the duration. The duration is t to the N minus t to the zero. So this whole expression over T to the N minus t to the zero. So this is the general formula for computing the time weighted average price from time t zero to t n. So this whole expression is equal to the summation from I equals zero.
00:03:31.934 - 00:04:08.538, Speaker A: The last price that we observe from t zero to t n is p to the n minus one. So we'll do a summation all the way up to N minus one. And inside the summation, we'll do p to the I times t to the I plus one minus t to the I. And in the same way that we divided this Whole ExpresSion by the whole Duration, we'll do the same for over here. So this whole expression divided by the duration, which will be t to the n minus t to the zero. And this is the equation to calculate the t wop from the duration t zero to tn. Now let's do another example.
00:04:08.538 - 00:05:01.514, Speaker A: What if we wanted to compute the time weighted average not from t zero, but from tk to t n? How do we compute the time weighted average from t to the k to t to the n? Well, we can do the exact same thing as what we did over here. And instead of starting from t zero, we just replace these variables with pk. So I'll copy this whole expression and then put it here. And then instead of starting from p zero, we'll start from p to the k. So we'll start the time interval from t to the k, and the next time interval will be t to the k plus one. The next price will be p to the k plus one. The time interval will be from t to the k plus one to t to the k plus two, and so on, all the way up until p to the n minus one.
00:05:01.514 - 00:05:42.300, Speaker A: And lastly, the duration will be from t to the k to t to the n. So instead of t to the zero, we'll start from t to the k, like what we did over here. We can also write this as a more concise expression. So I'll copy this, paste it here, and instead of starting from I equals zero, we'll start from I equals k, and the duration will be from t to the k. Now, there's another way to write this expression, except that I will always be equal to zero. So we can write this top equation to be equal to. We'll copy the top part of this equation and paste it here.
00:05:42.300 - 00:06:24.290, Speaker A: This expression starts from I equals zero. So from t zero all the way up to t to the n. And to get this to this summation, we added too much from t zero to tk. So we have to subtract this part, and to do that, we'll copy this, paste it here, and then over here, say minus this expression, starting from I equals zero, we need to minus all the way up to t to the k. So inside here, the summation will go up, all the way up to k minus one, and then the bottom stays the same. So I'll copy this and then paste it here. Now, we have two ways to write this same equation.
00:06:24.290 - 00:07:05.134, Speaker A: T wap from t to the k to t to the n. We can write it like this where we started from I equals k. Or we can always start from I equals zero, go all the way up to m minus one, and then subtract from I equals zero all the way up to k minus one. Why am I showing you this equation? The reason why I'm showing you this equation is because in uniswap b two, this is how the t Wap is calculated. In uniswap b two, it keeps track of the price and the duration that the price lasted inside the contract. They call it the price cumulative. Notice that this price cumulative is exactly the same as the top part of this equation that we derived.
00:07:05.134 - 00:07:30.570, Speaker A: And this equation is also the same as the ones we see over here and over here. So, in unison, b two, to get the t wap from times t to the k to t to the n, you'll need to get the price cumulative at t to the n minus the price cumulative at t to the k, and then divide it over the duration. This expression is exactly equal to this expression that you see over here. These two are equal.
