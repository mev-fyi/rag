00:00:00.410 - 00:00:33.206, Speaker A: Let's talk about discrete staking rewards. This is like a synthetic staking reward contract, except the amount of rewards may differ every second. Let's take a look. Let's say that different amount of rewards may be given at every second. For example, let's say at time T 1100 reward token was given, and at T 2200 reward was given. At t three there was no reward given and at T 4300 rewards were given. No rewards were given for t five and t six, and at time equals T 7200 tokens were rewarded at the same time.
00:00:33.206 - 00:01:21.650, Speaker A: Here's the graph that shows the amount of tokens that were staked by different users. So let's say that at T zero, Alice stakes 2000 tokens, and at t six she withdraws her 2000 tokens that were staked. At T three, Bob staked 1000 tokens, and he kept it staked until T eight, where he withdrew the thousand tokens that he staked. Combining these two graphs, Alice would have earned some of these rewards and Bob would also have earned some of these rewards. So the question that I want to ask here is how many rewards did Alice earn and how many rewards did Bob earn? And rewards are distributed proportional to the amount staked. So for example, at t one and t 2102, hundred tokens were rewarded at the same time. The only user that has their tokens staked is Alice.
00:01:21.650 - 00:01:51.322, Speaker A: So Alice would have earned all of these rewards. At t 4300 tokens were rewarded. And if you look here at t four, we have Alice and Bob that has staked their token. Alice has staked 2000 token and Bob has staked 1000 token. So Alice would have earned two thirds of the rewards and Bob would have earned one third of the rewards that was given. Here, let's say that s is the amount of tokens that was staked by user u. And here we'll say that s is a constant for the time tk to tn.
00:01:51.322 - 00:02:39.438, Speaker A: And then we'll define a function r of ukn and this will be equal to the rewards earned by user u from time tk to tn. This amount of rewards earned by user u can be calculated by this equation. This is a slight variation of the equation that we saw in synthetics staking rewards contract. And like the algorithm that we used in the synthetic staking reward contract, this part will say that it is called the reward index and this part will be reward index of the user. When we keep track of these two numbers, we'll be able to calculate the amount of rewards earned by the user. Here we'll say r of I is equal to the reward given at time t of I, and t of I is the total staked at time t of I, where capital t of I is greater than zero. In other words, the total stake is always greater than zero.
00:02:39.438 - 00:03:07.030, Speaker A: So with these assumptions, we can calculate the amount of rewards earned by a user using this equation. Let's take a look at example. For this example, we'll be using these two graphs and we'll run through example using this equation. So let's first find the reward index. So I'll drag this over here and then first we'll compute the reward index for each of these times. So I'll copy this and then arrange them vertically. So first let's find reward index at t equal to zero.
00:03:07.030 - 00:03:36.178, Speaker A: We'll name this r of zero. Reward index at time t zero. R of zero is equal to at t zero. There is no rewards given yet, so we'll say r of zero is equal to zero at t one. We'll be summing this part of the equation from I equal to zero to one. In other words, we will be adding two r of zero, r of I over t of I at t one. So this will be equal to r of one is equal to r of zero plus what is r of I at t equals one.
00:03:36.178 - 00:04:03.434, Speaker A: At t equals one there was 100 rewards given out, so r one will be 100. What is t of I at t equals one t of I. The total supply at t equals one. Alice is the only user that has state. So this will be equal to 2000 and that is r of one. In the same manner, let's compute r of two. R of two is to the previous reward index we add some amount r by over t of I.
00:04:03.434 - 00:04:33.618, Speaker A: The previous reward index is r of one. To this we add r by over t of I. R by at t equals two is 200 and t of I the total stake that t equals two. At t equals two, the total stake is still 2000 and that is r of two. Next, notice that we don't have to compute r of three. The reward index is updated at t of four when a new reward is given. So we skip reward index at t equals three and then compute the reward index at t equals t four.
00:04:33.618 - 00:05:01.278, Speaker A: This will be equal to the previous reward index. The previous reward index is r two plus. We'll need to compute r by over t of I at t equals t four. R by is 300 and t of I. The total staked at t four. At t four the total staked is 3000 and that is reward index r four okay, finally, let's compute the last reward index. Reward index at t seven.
00:05:01.278 - 00:05:32.838, Speaker A: R seven is equal to the previous reward index is r four. Plus the reward given at t seven is 200 and the total staked at t seven is only bob for 1000. T of I at t equals seven is 1000. Now next we're going to be computing reward index of user Alice and Bob. I'll drag this down to the bottom. Before we apply this equation. Notice that the amount staked by Alice is equal to 2000 from the time t zero to t six.
00:05:32.838 - 00:06:11.918, Speaker A: And the amount staked by Bob is equal to 1000 from t three to t eight. From t three to t eight, Bob has staked 1000. And the condition to compute this equation is that the amount staked is a constant in some time duration. So we observe here that the amount staked by both Alice and Bob are constant in these durations. So we'll be able to apply this equation to calculate the amount of rewards earned by them. We might need this equation later on, so I'll drag this down to the bottom for now and let's compute the reward index of each user. Let's start with Alice.
00:06:11.918 - 00:06:51.610, Speaker A: Let's say that Alice stakes 2000 token at t zero. So the first reward index will be stored for the reward index at t zero. The reward index at t zero is r zero. The next time alice interacts with this discrete staking rewards contract and updates her amount of tokens, that staked is at t six when she withdraws all of her tokens. So what is the reward index at t six? If I look over here, we don't have a reward index at t six, so we need to look at the reward index either at t six or one before. The one before will be r four. This will be the latest reward index.
00:06:51.610 - 00:07:22.458, Speaker A: So when Alice withdraws at time t six, the reward index will be r four. Let's do the same for Bob. Let's find the reward index of Bob. So the reward index of Bob is equal to first he deposits, first he stakes his 1000 token at t three. If we look over here, there is no reward index at t three. So we need to look for the latest reward index before t three, which we find at t two. And this is equal to r two.
00:07:22.458 - 00:07:57.954, Speaker A: At time t eight, Bob withdraw his 1000 token. So what is the reward index at t eight? Again, at t eight there is no reward index, so the one before will be r seven. This will be the latest reward index when Bob withdraw his token. Okay, so we now have all of the reward indexes to calculate the amount of rewards earned by each user. Let's start off with Alice. Let's calculate the amount of rewards earned by Alice from t zero to t six. R of Alice from zero to six.
00:07:57.954 - 00:08:26.762, Speaker A: This will be the function to call to calculate the rewards earned by Alice from t zero to t six. This is equal to. We'll be using this equation. And first, let's find what s is in the duration t zero to t six. If I scroll up, we notice that amount staked by Alice in that duration is 2000. So I'll copy this and then paste it here. And then what are the reward indexes at t six? This is when Alice withdraws her tokens.
00:08:26.762 - 00:08:53.730, Speaker A: At t six, the latest reward index will be r four. I'll paste it here. And before t six, the reward index of Alice will be this part. This will be stored as r zero. This is the last time she interacted with this smart contract before she withdrew the tokens. So the reward index of Alice will be r zero. Here, we'll do a minus and then paste the reward index of user.
00:08:53.730 - 00:09:27.314, Speaker A: Okay, let's calculate what this is equal to. To calculate r four, we'll need to know what r two is, and then add 300 over 3000. R two, we need to know r one plus 200 over 2000. R one, we need to know r zero plus 100 over 2000. And r of zero is equal to zero. So if we expand it, r one will be simply 100 over 2000. R two will be equal to this, plus 200 over 2000, and R four will be equal to 100 over 2000.
00:09:27.314 - 00:10:09.278, Speaker A: Plus 200 over 2000 plus 300 over 3000. In other words, to get r four, all we have to do is add these terms vertically. So I'll copy this and then paste it here. So this equation above will be equal to 2000 times 100 over 2000, plus 200 over 2000, plus 300 over 3000. And this will be equal to 2000 over 2000 will be simply be equal to 100. Plus 2000 over 2000 times 200 will be simply be equal to 202,000. Over 3000.
00:10:09.278 - 00:10:26.350, Speaker A: Times 300. This is simply two thirds of 301. Third of 300 is equal to 100. So two thirds of 300 is equal to 200. Okay, let's add these up. 100 plus 200 plus 200, this is equal to 500. Let's scroll up and check the math.
00:10:26.350 - 00:10:53.322, Speaker A: Let's check that the rewards earned by Alice is indeed equal to 500. So if I scroll up at t one, there was 100 rewards given, and Alice was the only user that has staked. So she earns 100. At T 2200, rewards were given. The only user that has staked is Alice. So now she earned 100 plus 200, which is equal to 300. At t four, there was 300 rewards given, and at t four there are two users.
00:10:53.322 - 00:11:21.990, Speaker A: Alice has staked two thirds of the total. Staked two thirds of 300 is equal to 200. So 300 plus 200 is equal to 500 that you see over here. So this is the correct answer. Okay, lastly, let's calculate the rewards earned by Bob from the duration t three to t eight. And again, we'll be applying this equation, and we can do this since the amount of tokens staked by Bob during this duration is a constant. First, let's scroll up and find what s is.
00:11:21.990 - 00:12:03.234, Speaker A: If I scroll up, the total staked by Bob s is equal to 1000. Next, we'll be calculating the reward index and the reward index of Bob. If I scroll up, when Bob unstakes at time t eight, the latest reward index will be r seven. Before that, Bob interacted with this smart contract and the reward index of Bob will be stored as r two. Copy these two and then multiply the 1000 staked by Bob by r seven. That is the reward index over here. Minus the reward index of bob will be stored as r two.
00:12:03.234 - 00:12:38.398, Speaker A: What is this equal to? This will be equal to 1000 times r seven minus r two. If I scroll up, r seven will be adding all of these terms. Up, R two will be adding these two terms. So r seven minus r two, we're left with the term 300 over 3200 over 1000. So I'll copy these and then paste it here and then bring them over here. Okay. What is this? Equal to 1000 over 3000 is equal to one third.
00:12:38.398 - 00:13:08.802, Speaker A: One third times 300 is equal to 100. 100 plus 1000 over 1000 is equal to one times 200. So this will be simply 200. 100 plus 200 is equal to 300. Let's scroll up and check our math. So if I scroll up, Bob earned some reward at t four. At t four, there was 300 rewards that were given, and Bob earned one third the amount of the rewards.
00:13:08.802 - 00:13:25.566, Speaker A: One third of 300 is 100. So Bob here has 100 tokens. At T 7200, rewards were given. At t seven. The only user that's staked is Bob. So he earns the full 200. 100 plus 200 is equal to 300.
00:13:25.566 - 00:13:42.220, Speaker A: What do we have over here? We have 300. So 300 is the amount of rewards earned by Bob. In this video, I showed you how to calculate the amount of rewards earned in a discrete staking rewards contract. A discrete staking reward contract. The amount of rewards given may differ at every second.
