00:00:00.250 - 00:00:58.558, Speaker A: Today, I'll be talking about liquidity delta in unisoft b three. Let's say that inside a unisoft b three pool with token x and token y, we add delta x and delta Y tokens in the price range between p of a and p of b. When we add liquidity, the liquidity will change. So the question I want to ask is, what is the change in liquidity? The answer is that the liquidity delta is equal to this equation delta x over one over the square root of the current price p minus one over the square root of p of b. And liquidity delta is also equal to delta Y over square root of current price p minus square root of p of a. Furthermore, if we set p of a and p of b to zero n infinity, then liquidity delta will be equal to delta x times square root of current price p, and which is equal to delta Y over the square root of price p. This is the same equation for liquidity delta that we've seen in unisoft B two.
00:00:58.558 - 00:01:56.610, Speaker A: So for the rest of the video, we'll derive this equation and then this equation. Okay, so let's start by reviewing some math. In unisoft B three, let's say that the current liquidity is represented by this blue line and the current price is p. The price range p of a and p of b are here. The curve for the real reserves are drawn in orange, where x subar and y bar are the real amounts of token x and token y. The equation for the real reserves are given by x, sub r plus l divided by the square root of p of b times y bar plus l times the square root of p of a and this is equal to l square, where l is the liquidity l. Using this equation, we can derive that l is equal to x, sub r over one over the square root of current price p minus one over the square root of p of b, and this will be also equal to y of r over square root of p minus square root of p of a.
00:01:56.610 - 00:03:02.838, Speaker A: These equation were all discussed in the previous video, and for this video we'll be using these equation to derive liquidity delta for unisoft b three. Okay, let's define liquidity delta. When we add or remove liquidity from unison B three, the number l changes. So let's come up with an equation for what liquidity delta is. We'll define l of zero to be equal to liquidity before we add liquidity delta X and delta Y, and we'll define l of one to be liquidity after adding delta X and delta Y in the price range p of a and p of b, we also define current price as p and we'll define liquidity delta to be equal to l one minus l zero liquidity after minus liquidity before let's take a moment to look at graphs for before we add liquidity and after we add liquidity. Here in blue we have the graph for l zero curve for liquidity before we add liquidity, the current price p and the price ranges p of a and p of b. The curve for the real reserves are drawn in orange, where x subar is the real reserves for token x and y bar is the real reserves for token y.
00:03:02.838 - 00:03:33.770, Speaker A: When we add liquidity delta X, then from x subar we will shift over to the right to get x subar plus delta X. Likewise, when we add liquidity for delta Y from Y bar we add delta Y. So we shift this tick above and the curve for the real reserve after adding liquidity is drawn in pink. Here is the curve for l one. This is after we added liquidity delta X and delta Y. We can observe two things in this graph. First, the pink curve is a translation of this green curve.
00:03:33.770 - 00:04:26.850, Speaker A: On this green curve, when the price is at P of a, then the real amount of token Y will be zero. And likewise, when the price on this green curve is at p of b, then the real amount of token X will be zero. Another thing to observe is that the prices p, P of a and P of B all land on a straight line that extends from the origin to each price on the blue curve. For example, if you follow the straight line from the origin to the current price p and then extend it, this will be where the price of P will be on the green line. Likewise, if you start from the origin and follow a line to P of a and then extend it further, this will be the price P of a on the green line. This is because the price of the tokens are determined by the ratio of the tokens X and Y in the pool. Okay, this graph describes the curve before adding liquidity l zero.
00:04:26.850 - 00:05:17.426, Speaker A: In this case, the curve for the real reserve will be in orange, and the curve after adding liquidity l one and the curve for the real reserve for l one is described in curve for pink. Next, I'm going to answer the question how to calculate liquidity delta. The first step to calculating liquidity delta is to write real curve for l zero using the variables l zero, current price p, and the price ranges p of a and p of b. We already know that the real reserve for this curve is described by x of r plus l zero over square root of p of b times y of bar plus l zero times square root of p of a. And this will be equal to l zero square. The next step to finding liquidity delta is to write real curve for l one. Well, we know that the real x increased from x subar to x subar plus delta x.
00:05:17.426 - 00:05:59.342, Speaker A: And likewise, we know that real Y increased from y a bar to y abar plus delta y. So what we can do is take this equation and then modify it. So I'll copy it and then paste it here. First, I'll replace all l of zeros with l of ones. Okay, next, the real reserves are described by x subar plus delta x and y bar plus delta y. So I'll replace x subar with x subar plus delta x and y a bar with Y bar plus delta y. So I'll shift this over to the right and then copy this, paste it here, and then I'll do the same for y a bar.
00:05:59.342 - 00:06:37.946, Speaker A: Move this part of the equation over to the right. Y a bar plus delta y plus this part of the equation. And this equation describes the real curve for l one. What we did is we took this equation and simply replaced some of the variables. We replaced l zero with l one and x subar with x subar plus delta x and y bar with Y bar plus delta Y. Okay, the next step is to rewrite l zero and l one using this formula. So I'll copy this and then paste it here.
00:06:37.946 - 00:07:09.000, Speaker A: Then replace l with l zero. And we'll do something similar for l one. So I'll copy this, paste it here. L1 is equal to is equal to. We'll copy this part of the equation and then replace some of the variables. For l one, x sub r, will be these two terms, x sub r plus delta x. So I'll remove this and then copy this term, x subar plus delta x.
00:07:09.000 - 00:07:41.818, Speaker A: And then paste it here. And likewise, we'll do the same for this part of the equation. Copy, paste, and y a bar will be equal to y a bar plus delta y. Okay, so we rewrote l zero and l one. The final step is to calculate delta l liquidity delta. And this will be simply be equal to l one minus l zero. So from this equation above, we know that l one will be equal to this equation.
00:07:41.818 - 00:08:10.506, Speaker A: So I'll copy it, paste it minus. What's l zero? L zero. We can rewrite it as this part of the equation. Paste it and this will be equal to notice that the bottom is the same. And from the top we have x sub r plus delta x minus x subar. So the top we'll have simply delta x and the bottom does not change. So that is one expression for delta l.
00:08:10.506 - 00:08:39.154, Speaker A: Liquidity delta. Okay, we can do the same using this part of the equation. So this will be equal to, copy this l. One is equal to this equation, minus l zero will be this equation, paste it, and this is equal to, again, the bottom are the same, the denominators are the same, the numerators. We have y bar plus delta y minus y bar. So that's y bar minus y bar. The top.
00:08:39.154 - 00:09:35.558, Speaker A: What we have left is delta y, and the denominator will be this expression. And we have solved for liquidity delta l in terms of delta y. Also, these are two useful equations to express liquidity delta in terms of amount of tokens that were added or removed, and the current price and the price ranges. As last part of this video, let's see how liquidity delta in unisop b three converges to liquidity delta expressed in unisop b two. When we set the price range from zero to infinity, what I mean by this is I'm going to show that for the price range p of a and p of b set to be zero to infinity, then liquidity delta l will be equal to delta x times the square root of current price p. And this will be also equal to delta y over square root of current price p. This is the exact same equation as liquidity delta for unisot b two.
00:09:35.558 - 00:10:06.494, Speaker A: First, let's find liquidity delta l using this equation that we just derived. So I'll copy this and then paste it here. Then we said that we're going to set p of b to be infinity. So we're saying one over the square root of p of b, one over an extremely large number is close to zero. So we'll say one over infinity is approximately equal to zero. So we'll treat this part as being equal to zero. So I'll just cancel it out.
00:10:06.494 - 00:10:42.010, Speaker A: And what are we left with from the top, we're left with delta x the bottom. We're left with one over the square root of p. Since this part is very close to zero, we will just say this is equal to zero, delta x over one over. The square root of p is simply equal to. This will be equal to delta x. From the top here, we're dividing twice. So this will turn out to be multiplication and we'll have square root of p up at top, and we get the final result.
00:10:42.010 - 00:11:32.758, Speaker A: Delta x times square root of the p. So we solved one part of this equation. Let's now do the same to derive the second part of the equation again, I'll scroll up, and then next I'll use this part of the equation. So liquidity delta is also equal to liquidity delta is also equal to this equation. And we said that p of a is equal to zero, so p of a is equal to zero. So we simply cancel it out, and this will be equal to from the top we have delta y, and from the bottom p of a, we canceled it out because p of a is equal to zero, and we're left with square root of p. And that is the second part of the equation for liquidity delta for unisot b two.
00:11:32.758 - 00:11:44.570, Speaker A: And that completes the proof that liquidity delta for unisot b three converges to liquidity delta for unisot b two. When the price range p of a and p of b are set to zero and infinity.
