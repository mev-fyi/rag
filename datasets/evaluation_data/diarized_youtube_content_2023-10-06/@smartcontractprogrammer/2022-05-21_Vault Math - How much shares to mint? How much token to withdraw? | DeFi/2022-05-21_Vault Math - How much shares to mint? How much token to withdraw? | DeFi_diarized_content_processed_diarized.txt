00:00:00.330 - 00:00:25.350, Speaker A: In this video, I'll explain what a vault is and how much shares to mint and burn. Let's begin. First of all, what is a vault? A vault is a contract where the user first deposits his token. This token can be something like USDC, Dai, or even ETH. In return, the vault contract mints a share. This represents the partial ownership of how much token this user has deposited into the vault. Contract it.
00:00:25.350 - 00:00:53.514, Speaker A: Later, the user will be able to withdraw his token plus profit if the bot makes some money or minus some loss. If the bot lost some money. When the user withdraws, the vault contract burns his share. The user is renouncing his partial ownership of the vault. Here, I said that the user will get the amount of tokens that he deposited plus minus profit or loss. So let's take a look at how this profit or loss is realized. The vault contract will have an owner.
00:00:53.514 - 00:01:35.830, Speaker A: This owner will have access to all of the tokens deposited by the user. The owner will take the tokens locked inside the vault and invest it into other defi protocols to earn some yield. For example, this can be locking the tokens inside uniswap curb or maybe lending it to like compound and Abe. These tokens that are deposited inside other Defi are earning interest and occasionally this profit that was made is returned back to the vault. So this is how the profit or the loss is generated. The profit is generated when this external defi makes some profit. And of course, if the DeFi protocol is hacked and the funds are lost, then the user will have to realize the loss.
00:01:35.830 - 00:02:18.582, Speaker A: They would get less amount of tokens than what they initially deposited. This is an overview of how the vault works. Let's now talk about deposit. When a user deposits, how many shares should the vault contract mint? When a user deposits his token, the vault contract will have to calculate the amount of shares to mint back to the user. This share represents the partial ownership of the total amount of tokens locked inside the vault contract. The amount of shares to be minted to the user should be proportional to the amount of increase in the balance of the vault. For example, if the user deposits and increases the balance of token inside the vault by 10%, then the total shares should also increase by 10%.
00:02:18.582 - 00:02:53.454, Speaker A: The 10% that was increased, that is the amount of shares that the user will receive. Let's take a look at a diagram and some math equation that expresses this idea that the amount of shares to mint is proportional to the increase in balance of the vault. We'll say that A is the amount to deposit, b is the balance of vault before the deposit. S is the amount of shares to mint and t is the total shares before mint. Here is how the balance and the total share will change. Before and after deposit. Before deposit let's say that there are b amount of shares.
00:02:53.454 - 00:03:24.510, Speaker A: When we deposit, this circle becomes bigger because to the previous b we added some a. Likewise for total shares, before the circle is this big. After we deposit we have to mint some shares. So the circle gets bigger for the amount of shares that we'll have to mint and the increase of the balance of the vault. So from here to here, let's say that these circles increase by 10%. Then this should be also be true for total shares. The total share should increase also by 10%.
00:03:24.510 - 00:03:46.046, Speaker A: So let's write this as an equation. The balance before deposit is b. The balance of the bolt after deposit is a plus b. A is the amount of deposit that's coming in and b is the previous balance of the vault. Let's take a look at total shares. The total share before deposit is t. After the deposit, we mint s shares.
00:03:46.046 - 00:04:23.618, Speaker A: So the total shares will be s plus t. Earlier we mentioned that the shares to min is proportional to the increase of balance of the vault. So here a plus b over b must be equal to S plus t over t. The increase in the balance of the vault should be proportional to the increase in the total shares of the vault. Now we can answer our original question for deposits, how much shares do we need to mint from this equation we're solving for S. So let's solve this equation and find what s is. We will multiply this side of the equation by t and cancel out this t.
00:04:23.618 - 00:05:10.542, Speaker A: And multiply this side of the equation by b to cancel out the b on the bottom. So that will be a plus b times t is equal to s plus t multiplied by b. We will simplify this equation to say at plus bt is equal to sb plus tb. Notice in this equation that b times t is equal to t times b. So we can cancel these two out and we're left with the expression a times t is equal to s times b. Or we can rewrite this as a times t over b is equal to S. Now we have found a solution to our original question.
00:05:10.542 - 00:05:54.586, Speaker A: How much shares to mint when deposit s is equal to the amount of shares to mint and s is equal to this a times t over b. When we deposit, we need to calculate the amount of shares to mint. On the other hand, when the user withdraws, we need to calculate the amount of tokens to give back to the user for the amount of shares that they're going to be burning. So let's now calculate the amount of tokens to give back to the user when the user calls withdrawal. How much amount to withdraw. Like the previous example, we'll use the same variable names. A is the amount to withdraw, b is the balance of vault before withdrawal, s is the shares to burn, and T is the total shares before burning.
00:05:54.586 - 00:06:35.626, Speaker A: The amount of tokens to be withdrawn should be proportional to the amount of tokens that are being burned. Here we have a big circle representing the balance of vault before withdrawal. A is the amount of tokens to be in withdrawal, and after the withdrawal we have a smaller circle of B minus a. Likewise, on the right we have total shares represented with a big circle, and s is the amount of shares that are going to be burnt after withdrawal. This s is burnt and we are left with a smaller circle of T minus s. The decrease in the size of the balance of the vault. So from here to here should be proportional to the decrease in total shares from here to here.
00:06:35.626 - 00:07:20.282, Speaker A: Similar to the case for deposit, we can write this as an equation. The balance of the vault before withdrawal is b, and the balance of the vault after withdrawal is b minus a. Likewise, the total shares before withdrawal is t, and the total shares after withdrawal, since s is being burned, is T minus s. The decrease in the balance of the vault must be proportional to the decrease in total shares. And from this equation we can solve for a the amount to withdraw to the user for burning s amount of shares. Let's solve this equation for a the amount to withdrawal. First, we'll simplify this equation by multiplying this side of the equation by t and canceling out the t at the bottom.
00:07:20.282 - 00:08:23.850, Speaker A: And likewise, multiplying this side of the equation by b to cancel out the b at the bottom. Over here, we'll type b minus a times t is equal to t minus s multiplied by b, and we'll expand this equation so that will be b times t minus at is equal to t times b minus s times b. Notice that on both side of the equation we have b times t and t times b. These two are equal so we can cancel them out. And since we're left with just negative at and negative Sb, we will also cancel out the negative. And the equation above becomes a times t is equal to s times b. Here we're solving for a, so we'll divide at by t and we finally get that a is equal to s times b divided by t this is amount to withdrawal from the ball for burning s amount of shares.
