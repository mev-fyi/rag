00:00:00.410 - 00:00:33.474, Speaker A: This is the equation used in the curb's stable swap amm. Here is the equation when the number of token is equal to two and on the right is the graph. The two important parameters to understand how the curve behaves is the a parameter and the d parameter. The a parameter controls how flat the curve is. When a is high, the curve becomes more flat and when the a is lowered, the curve becomes more like a constant product. At a equals zero, it is equal to the constant product. The variable d in this equation represents the liquidity of the curve.
00:00:33.474 - 00:01:26.290, Speaker A: When d is low, the liquidity is low, so the curve shifts to the bottom left, and when liquidity is high, the curve shifts to the top right. When the amount of token x in the pool is equal to the amount of token y in the pool, the amount of token will be equal to d divided by two. For example, in this curve, when there are 50 x tokens, then there will also be 50 y tokens and this curve represents the curve for d equals 100. 100 divided by two is 50 for both token x and token y. In this video I'm going to explain how to reconstruct this curve. So to start off with, let's write an equation for a constant sum that goes through somewhere around here. So this will be an equation of the form x plus y is equal to something, where this something will be a constant.
00:01:26.290 - 00:02:20.060, Speaker A: We said that for this stable swaps curve, when the amount of token x is equal to the amount of token y, then the amount of token x is equal to amount of token y, which will be equal to half of d. So we will have d over two of token x and d over two of token y. This means x plus y will be equal to d over two plus d over two, or simply this will be equal to d. Now we have the equation for a constant sum. If I scroll up and then play around with the a parameter, you can see that the stable swaps curve converges to this constant sum curve. As I increase the a parameter and if I decrease it, let's say to zero, then it becomes the constant sum. So the equation for the constant sum x times y equals, let's say k.
00:02:20.060 - 00:03:14.954, Speaker A: And what I'm trying to look for is k so that it touches the constant sum over here. When the amount of token x is equal to 50, and the amount of token y is also equal to 50. So what is this k? Let's add some zeros and try to see where it might be. So as I lower the k, I can see that this k will have to be somewhere around 2500. So how does this k parameter relate to this d parameter? Well, we said that when the amount of token x and amount of token y are equal, we will have d over two amount of tokens for both token x and token y. So this means that for this equation it will have to pass through d over two times d over two. So that will be d over two for x, n times d over two for y.
00:03:14.954 - 00:03:57.078, Speaker A: Or we can simplify this to be d over two square and I'll remove this k parameter. And now we have two equations. We have one for constant sum that passes through the curb's stable swap curve. And we also have a constant product that also touches the curb's stable swap curve when x and y are equal and when they are equal to d over two. So if I increase this a parameter, you can see the curb's stable swap curve. When a is equal to zero, it equals this constant product. And as I increase a, it approaches the constant sum of x plus y equals d.
00:03:57.078 - 00:04:25.586, Speaker A: I'm going to change the color for the constant product. I'll change this to purple. So we have the constant product in purple, curbs stable swap in blue and constant sum in white. And this is our starting point. What we're going to do next is combine these two equation to construct the curbs stable swap. So first, let's start with the constant sum. Copy this, paste it here, and then we'll add the constant sum in the constant product.
00:04:25.586 - 00:04:56.326, Speaker A: So this will be x plus y equals d. N plus x times y will be equal to d over two square. Copy this. So add this to the right side of the equation and what do we get? We get a curve that looks like a constant product. But how can we make it more look like the curve's stable swap. Take a look at this equation. This orange curve is acting like a constant product because the x times y and this d over two squared part is dominating.
00:04:56.326 - 00:05:27.366, Speaker A: What we want to do is make this part of the equation x plus y is equal to d stronger. To do that, notice that over here for x times y we have a d square. But for the constant sum side, x plus y equals d. To make the constant sum side stronger, what I'm going to do is multiply the constant sum by a d. This will be d times d will be d square. And I'm going to multiply the constant sum by a d. Now we have a curve that doesn't resemble a constant product.
00:05:27.366 - 00:06:05.790, Speaker A: It's a curve somewhere between a constant sum and a constant product, we can make this orange curve even more flat by adding the a parameter. And now notice that this orange curve is like a constant sum. And if I tweak this a parameter, you can see at a equals zero, it is the constant product. And as I increase the a, it becomes more flat towards the constant sum. However, notice that the curb's stable swap stays in the positive axis. For the x axis, it's always greater than or equal to zero. And also for the y axis, it's always greater than or equal to zero.
00:06:05.790 - 00:07:06.354, Speaker A: But for the curve that we have so far, the orange one, it goes into the negative for the x axis and it also goes into the negative for the y axis. So how can we modify this equation so that this orange curve stays on the positive region where it will be greater than or equal to zero for x and greater than or equal to zero? Also for the y axis, what we want to do is modify this part of the equation and this part of the equation so that the orange line doesn't go over to the negative section for x and doesn't go over to the negative region for y. To do this, notice that the constant product, this curve in purple, always stays in the positive region. So what happens if I multiply this part of the equation and also this part of the equation by x times y? So here I'm going to multiply xy. And then also here I'm going to multiply xy. And now notice that I get this weird curve. At first glance, it looks like we're going the wrong way.
00:07:06.354 - 00:07:47.540, Speaker A: However, if I scroll up and then what I'm going to do is tweak this a parameter. Let's try a equals 0.1. If you look closely over here. So I'll zoom in, you can see here that the orange curve never crosses over to the negative region. And likewise, if I zoom out and then zoom in over here at the line x equals zero, you can see that the orange curve never crosses the y equals zero line. This orange curve always stays positive. And to show you this, if I make this a parameter even smaller, so I'm going to add another zero.
00:07:47.540 - 00:08:35.950, Speaker A: Now notice that it looks like the curb's stable swap. If I add another zero, it looks like a curve somewhere between the curb's stable swap and the constant product. And if I keep on adding zero, you can see that it approaches the constant product. So this equation over here looks like it acts like the curb's stable swap. But instead of the a parameter being from zero to something like thousand, when a is equal to one, we get a curve that looks like the constant sum, and as a approaches zero, it approaches the constant product. I think we're on the right track to reconstruct the curbs stable swap. What we need to do is somehow modify this x times y term so that it will behave more like the curb's stable swap.
00:08:35.950 - 00:09:32.114, Speaker A: Remember that before we added this x times y term, this curve became more flat when we increased a, and this behavior is still the same. However, now we're multiplying by a times x times y. So if a is equal to one, then this is like amplifying this part of the curve by x times y. Maybe we can divide this x times y term by something so that this part of the term and this part of the term will be less than or equal to one. How about we try this equation? X times y is equal to d over two square. So if I divide both side of the equation, then x times y divided by d over two square will be equal to one. So what I'm going to do is divide x times y by d over two square and also do the same on the right side of the equation, x times y divided by d over two square.
00:09:32.114 - 00:10:24.514, Speaker A: And now let's try a equals one and looks like we are getting something that looks like the curb's stable swap. If I increase a, notice that it behaves much more like the curb's stable swap. However, it doesn't exactly match the curb's curve. What we need to do to fix this is go back here and notice that here at the bottom we have a d over two. And let's simplify this part of the equation. This equation is equal to the top will be equal to d over two, and the bottom will be equal to two over two, or simply four. And the same goes over here, d square over two over two, which is equal to four, x times y divided by d square divided by four is simply equal to four times x.
00:10:24.514 - 00:10:57.962, Speaker A: Y divided by d square and the same over here, four times x, y divided by d square. And now notice that we have the term a times four and also the same over here we have the term a times four. Since a is a parameter that we can configure, why don't we just say a? Multiply a by four. So if a is nine, we multiply by four, so that will be 36. And then just simply remove this four. And now it looks like we had the same curve as the curbs. Stable swap.
00:10:57.962 - 00:11:40.140, Speaker A: Let's tweak the a parameter and check that our orange curve matches the curb's stable swap curve. So if I increase a, looks like it's matching the curve's stable swap, and if I decrease a, it also matches the curve's stable swap. And finally, let's compare these two equations. So bring this curve up over here. This is the equation that we reconstructed, and this is the curb's stable swap equation. Notice that this part, a times xy divided by d square, and the same term over here, matches this k term. And the rest of the equation is also the same with the curb's stable swap equation, too.
