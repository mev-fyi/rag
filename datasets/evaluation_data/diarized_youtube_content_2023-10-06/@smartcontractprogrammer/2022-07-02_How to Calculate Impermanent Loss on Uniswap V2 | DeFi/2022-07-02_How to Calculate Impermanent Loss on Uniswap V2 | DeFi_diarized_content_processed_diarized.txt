00:00:00.330 - 00:00:43.782, Speaker A: In this video, I'll explain how to calculate impermanent loss in a constant product amm. We'll say that il of D is equal to the percentage loss of LP given a price movement of d. So for example, let's say that the price changes from p zero to p one. Then we'll write p one equal to p zero multiplied by some factor d, where d is greater than zero. When the price moves by d, we can calculate the impermanent loss to be two times the square root of d over one plus d minus one. And here we're assuming that the trading fee is equal to zero and the graph will look something like this. If the price does not change at all, then d is equal to run and there is no loss in providing liquidity to a constant product amm.
00:00:43.782 - 00:01:11.314, Speaker A: However, if the price changes either down or up, then the LP will experience some loss. For example, let's say the price of EF goes to zero. Then your loss will be minus one or 100%. On the other hand, even if the price of ETH goes up, then you'll still lose money providing liquidity to a constant product amm. Okay, so for the rest of the video, I'll explain how to derive this equation. So we'll say that we have two tokens. Token next.
00:01:11.314 - 00:02:03.214, Speaker A: For example, let's say token next is ETH and we have token y. And for this example, we'll say that token y is something like a stablecoin like dai. We'll say that lowercase x is equal to amount of ETH in the amm in the pool. And likewise, lowercase y is equal to the amount of die in the pool. We also say that capital p is equal to the price of token x in terms of token y. In our case, token x is e and token y is die. So for this example, this will be the price of e in terms of die, and we'll define this to be the amount of die in the pool over the amount of e in the pool.
00:02:03.214 - 00:02:47.090, Speaker A: So let me give you an example. For example, we'll say that there are 10,000 die in the pool, and we'll say that there are 100 e in the pool. So p will be equal to y over x. Y is the amount of die in the pool and x is the amount of ETH in the pool. So this will be equal to we can simplify this ratio by removing the two zeros, and we get that this ratio is equal to 100 die for one e. So when there are 10,000 dies and 100 e in the amm, then pe, the price of e in terms of die is 100 die per e one e costs 100 die. So that is an example of P.
00:02:47.090 - 00:03:26.238, Speaker A: Okay, let's move on and I'll define a little bit more variables. So we'll say x times y is equal to l raised to the power of two. Now, inside the constant product amm, what you're used to seeing is x times y equals k. Here we're replacing k with l square. So next, I want to define what x and y are equal to in terms of l and p. So what we're going to use, we're going to use this equation, and we're also going to use this equation to derive what is y equal to and what is x equal to in terms of l and in terms of p. So, let's find out.
00:03:26.238 - 00:04:00.746, Speaker A: Let's start with y. Using this equation, we can write y as y is equal to l square over x. I'm just bringing the x in this equation to the right by dividing both sides of the equation by x. So y is equal to L square over x. Next, I'll define x in terms of p and y from using this equation. So, I'll copy this equation and then bring it over here, multiply both side of the equation by x and I get x here, and this x cancels out. And then next, I'll divide both side of the equation by p.
00:04:00.746 - 00:04:35.666, Speaker A: So from the left I'll remove the p, and to the right I'll divide this expression by p. So, from the equation above, we get that x is equal to y divided by p. Next, let's put this x back inside this equation above. So this will be equal to l square over y over p. We can rewrite this as l square over p times p. Now, notice that we have a y over here and a y over here. So we can write this whole equation as y square is equal to l square over p.
00:04:35.666 - 00:05:13.342, Speaker A: Now, we can take the square root of both sides, and we'll come to the conclusion that y is equal to square root of L. Square is l, and square root of p is the square root of p. So, we wrote y in terms of l and p, and y is equal to l times the square root of p. So, I'll write this down as an answer to y is equal to l times a square root of p. Next, let's do the same thing to find what x is equal to in terms of l and p. Okay, so what is x equal to? Again, we'll use these two equations to derive x in terms of l and p. So we'll start with this equation over here.
00:05:13.342 - 00:05:33.206, Speaker A: I'll copy it. Paste it here. Let's rewrite x. So divide both sides of the equation by y, and we get x is equal to l square over y. Okay, next, we'll replace y by using this equation. So I'll copy this equation again and then paste it here. So p is equal to y over x.
00:05:33.206 - 00:06:02.554, Speaker A: So y will be equal to multiply both side of the equation by x, and we get that y is equal to p times x. Okay, so let's put this equation back inside here. So this will be equal to l square over p times x. Similar to how we derive y. We have an x over here, and we also have an x over here. So we can rewrite this whole equation as x square is equal to l square over p. From this equation.
00:06:02.554 - 00:06:25.798, Speaker A: I multiply by x. So I get the x square and cancel out this x square. And we're left with x squared is equal to l squared divided by p. And now we can know what x is in terms of L and p. By taking the square root on both side of the equation, we get x is equal to square root of l. Square is L over the square root of p. And that answers our question.
00:06:25.798 - 00:06:48.814, Speaker A: What is x equal to in terms of L and p? Well, x is equal to L divided by the square root of p. So I'll copy this answer and then I'll paste it here. Okay, so we now solved what y and x are equal to in terms of L and p. So we're now ready to solve this equation. Il of D. I'll scroll down. Il of D.
00:06:48.814 - 00:07:23.622, Speaker A: This is equal to the percentage of impermanent loss if the price moves by some amount, d. So this will be equal to loss from lp over the value of tokens if you did not put them inside the amm. Just holding on to the tokens, huddle. And this will be equal to, let's say that the value of tokens inside the amm after some time, let's say t equals one will be equal to b of one. And if you hold the token, then the value will be b of. Huddle. To calculate the loss from lp, we will just have to subtract these two amounts.
00:07:23.622 - 00:07:42.682, Speaker A: And to calculate this ratio, we will just divide this by b of. Huddle. Next, let's find what these terms are in terms of Lmp. Again, we'll say that b of one is equal to the value of tokens in the pool. After some time, let's say t equals one. On the other hand, we have b of huddle. This is the value of tokens.
00:07:42.682 - 00:08:17.210, Speaker A: If you did not provide liquidity to the pool, the value of tokens if you just held on to your tokens. Let's find out what each of these values are in terms of token y. So b of one is equal to. We'll say that the amount of token Y that we can withdraw at t equals one will be y of one. And the amount of token x that we can withdraw at t equals one is x of one. Now, to find b one in terms of token Y, we'll need to first multiply x by some price at t equals one. So I'll say p of one.
00:08:17.210 - 00:08:44.962, Speaker A: And again, remember that p is equal to the price of x in terms of Y. So when we multiply p times x, then we get amount of tokens in terms of Y. So I'll scroll down. So that is why we're multiplying x by p of one over here. Before we move on, I'll define what p of zero and p of one are. Let's say that at some time t equals zero. We provided a liquidity of token x for x zero, and for token y y zero amount of token y.
00:08:44.962 - 00:09:21.310, Speaker A: Then, by definition, the price of token x in terms of y at t equals zero, p of zero is equal to x, sub zero over y of zero. Likewise, at some time t equals one, we'll have some amount of token x x one and some amount of token y y one. And taking x one over y one, we get the price p one. Okay, now going back to our equation. B one is equal to the value of tokens in the pool at t equals one is equal to y one. If we were to withdraw at this moment, we have y one amount of token y, and x one amount of token x. And then we multiply this by p one.
00:09:21.310 - 00:09:54.022, Speaker A: To get x one in terms of y, we add these two together and we get b one. The value of tokens in the pool at t equals one. Back at top, we defined what Y and x are in terms of L and p. So let's do that over here. So y one is equal to y, one is equal to l times the square root of p. So y one is equal to l times the square root of p at t equals one. So at p one plus let's replace x one with the equations that we found out above.
00:09:54.022 - 00:10:16.362, Speaker A: So x is equal to l over square root of p. So l over square root of p p at times equal one. So p of one. And then we multiply this by p of one. P of one divided by the square root of p of one. We can cancel them out. And this expression will be equal to the square root of p one.
00:10:16.362 - 00:10:57.806, Speaker A: So we have l times square root of p one plus the l that we get from here. And the p one over square root of p one cancels out to be square root of p one. So we have l times the square root of p one plus l times square root of p one. And this is simply equal to two times l times square root of p one. Now, when the price changes from p zero to p one, we can write p one in terms of p zero by simply saying p one is equal to p zero times some number d. And this d is the same as the d that you see over here. You multiply p zero by some amount d, and we get p one.
00:10:57.806 - 00:11:32.538, Speaker A: Now we can replace this equation as saying this is equal to two l times the square root of p zero times some d. And finally, b one is equal to two times l times the square root of p zero times d. Okay, next, let's find b of huddle. This will be the value of tokens in terms of token y. If we kept it outside of the amm. If we just held onto the tokens b of huddle is equal to the amount of token y that we'll have. If we just hold onto the token will be y, sub zero.
00:11:32.538 - 00:12:05.838, Speaker A: At t equals zero, we put in y zero amount of token y. But if we held onto it, then we will still have y zero amount of token y. How about token x? If we did not put it into amm, how much token x will we still have? Well, we will have x sub zero amount of token x. Now we need to multiply this number so that we get a number in terms of token y, the price of token. Next, in terms of token y at t equals one is p of one. We add these two values up and we get b of huddle. Okay, next, let's simplify this equation.
00:12:05.838 - 00:12:52.018, Speaker A: Replacing all of these variable by l and p y of zero, well, it is equal to y is equal to l times the square root of p. So I'll copy this, paste it here. At t equals zero, the price would have mp of zero plus this is equal to plus x zero in terms of lmpr. I'll copy this again and then paste it here l over the square root of p. The price at t zero is p of zero times p of one. We said that p of one is equal to p of zero times d. So we can replace this p of one with p of zero times d.
00:12:52.018 - 00:13:37.778, Speaker A: I'm replacing p of one with p of zero times d, so this will be equal to l times the square root of p of zero plus l over the square root of p zero times p zero times d. I'm replacing p one with p zero times d. Since we defined over here that p one is equal to p zero times d. Okay, we have a p zero on top and a square root of p zero on the bottom, so we can cancel these two out. And on the top, we're left with the square root of p zero. So we have l times the square root of p zero plus l that we see over here times the square root of p zero times d. So we now know what B one and B huddle are.
00:13:37.778 - 00:14:05.242, Speaker A: So we're now ready to solve this equation. B one minus B huddle over B huddle. So I'll copy this, scroll down, then paste it here. I'll also highlight what b huddle is. B huddle is equal to L times the square root of p zero plus L times square root of p zero multiplied by d. So let's now find what this equation is equal to in terms of B one and b huddle. This is equal to B.
00:14:05.242 - 00:14:25.518, Speaker A: One is equal to this expression over here. And then next we have a minus and b huddle is equal to this over here. Paste it. This is over B huddle. So it will be this expression again, and then paste it. Okay, let's simplify this equation. In all of these terms.
00:14:25.518 - 00:14:45.910, Speaker A: I see an L and a square root of p zero. So let's cancel them out. I'll cancel the L and the square root of p zero. L and a square root of p zero. And do the same for the top as well. L square root of p zero, l square root, p zero, and l square root of p zero. Okay, let's clean up the equation.
00:14:45.910 - 00:15:26.390, Speaker A: So the top, we'll have two times the square root of d minus one. I forgot to put apprentices over here. So I'll put apprentices after the minus minus one plus d, and this will be over. For the first term, we cancel all of the terms. So that will be we're left with one plus the second term, we canceled almost everything, but we still have a d, so the bottom will be d. And we can simplify this equation to say this is equal to two times the square root of d over one plus d minus one plus d over one plus d. Is equal to minus one.
00:15:26.390 - 00:15:36.100, Speaker A: And there we go. We have come to the conclusion that the impermanent loss is equal to this equation two times the square root of d over one plus d minus one. So.
