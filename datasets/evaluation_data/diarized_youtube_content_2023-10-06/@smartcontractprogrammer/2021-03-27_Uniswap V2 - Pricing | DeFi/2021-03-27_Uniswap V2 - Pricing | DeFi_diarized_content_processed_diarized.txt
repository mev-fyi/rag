00:00:00.490 - 00:00:39.240, Speaker A: Hello everyone. Today I'm going to explain how uniswap calculates price inside uniswap. Let's say that I have 1000 die and I want to use that 1000 die to buy some me. In this case, it will give me 0.60 75 ether. The exchange rate is to get one ether, I will need this much amount of die. Unlike a traditional centralized exchange where the buyer and the seller comes to agreement on the exchange rate, for Uniswap, this calculation is all done inside a smart contract, and there is a mathematical formula that calculates this price.
00:00:39.240 - 00:01:10.882, Speaker A: So in this video, I'm going to explain how this pricing is calculated. The price of a token on uniswap is calculated using a very simple formula. X multiplied by y equals a constant k. For example, let's say that there are 50 coins of token x and there are 20 coins of token y. Then our k value will be 50 times 20, which is equal to 1000. And this k is a constant value, so it will stay the same no matter how x and y changes. Let's go over an example.
00:01:10.882 - 00:01:53.450, Speaker A: I want to sell some x tokens and buy some y tokens. So this means that the amount of X tokens that is inside the uniswap smart contract will increase. Here is the original X. Dx is the amount of tokens that we're selling, and the Y value corresponding to this x value on this x times y equals k curve will be over here. And dy is the amount of Y tokens that we'll be getting from this trade. So in summary, you put in Dx coins and you get out dy tokens. And that is how uniswap determines how much Y tokens you will get for selling X tokens.
00:01:53.450 - 00:02:44.442, Speaker A: We can also do the opposite trade where we're selling some y tokens and getting some x tokens. We are selling some y tokens, so we're increasing the amount of Y tokens inside this uniswap smart contract. So this is why the Y value goes up for this much amount of Y tokens. How much X tokens are we going to get? Well, we can calculate this by looking at the curve. In this case, X will have to be somewhere around here, and in order for X to be around here, we'll have to subtract Dx from the original X. And the difference between these two positions, which is equal to dx, is the amount of x tokens that you'll get for putting in dy tokens. Let's put some numbers in into x and y.
00:02:44.442 - 00:03:17.946, Speaker A: For example, in this example, we'll start with an initial value of x of 50 and initial value of y of 1000. So the k value will be x times y, which will equal to 50,000. On the right is a graph of x times y equals k. So our starting position is here. And let's say that I want to sell ten of my x tokens. So we're going to increase the x by 1050 plus ten is equal to 60. So at this point, the y value has to equal to 833.
00:03:17.946 - 00:03:52.146, Speaker A: And this means that for selling ten x tokens, I'll get 166 y tokens from here. Let's do another trade. For this example, I'll sell some of my y tokens and get some x tokens. We'll say I sold all of my y tokens until the y value equals 10,000. At y equals 10,000, x is equal to five. So in this trade, I was able to get 60 minus five, which is equal to 55 x tokens. So that is how the price of a trade is determined on uniswap.
00:03:52.146 - 00:04:30.420, Speaker A: By using a curve, x times y equals k. Notice how this curve flattens out as we increase the value of x. When we increase x from about here to x equals 20, the difference in Y dy is about this much. And if we increase x by another 20, our dy will be about that much. And again, if we increase x by another 20, our dy will be that much. You can see that dy, the decrease in Y is getting smaller and smaller. The further we increase x.
00:04:30.420 - 00:05:14.510, Speaker A: In terms of pricing, for about 15 x, we'll get that much y tokens. And for selling the next 20 x tokens, we'll only get about that much y tokens. And for selling another 20 x tokens, we only get that much y token. You can see that the amount of y tokens that we can buy for selling x token is decreasing. In other words, the less y token there is, the more expensive it gets. You can see the same pattern for selling y tokens and getting x tokens. The less X token there is inside the uniswap contract, the more expensive it gets to buy using the y tokens.
00:05:14.510 - 00:05:40.190, Speaker A: Let's do some math. We know that for selling some x tokens, we will get dy tokens in return. But what is this value of dy? Let's find out. This trade will increase the value of x by dx and decrease the y by dy. And our new x. And our new y has to equal the constant k. So what is dy equal to? We can do simple algebra.
00:05:40.190 - 00:06:20.920, Speaker A: Divide both side of the equation by x plus dx and you get this equation over here, bringing y over to the right side of the equation and flipping signs. We get dy is equal to y minus k over x plus dx. And that is our equation for how to find dy. In other words, the amount of y tokens that we'll get for selling dx amount of x tokens. Now, inside the code of Uniswap, this equation is represented in a slightly different way. So we'll do some algebra to derive the same equation. First, we'll replace k by x times y.
00:06:20.920 - 00:06:59.854, Speaker A: And we can do this because x times y is equal to k. And if you do more algebra, some of the terms cancel out and we're left with y times dx divided by x plus dx. Uniswap has a trading fee of 0.3%. So the actual value for dy will equal to y times 0.997 times dx divided by x plus 0.997 times dx. And that is the equation that you'll see inside the code for Uniswap.
00:06:59.854 - 00:07:38.842, Speaker A: For the last part of this video, I want to verify that the amount we get from the equation that we derived agrees with the actual amount that uniswap calculates. The first thing that we'll need to do is get the x and y values. So I'm inside etherscan looking at the contract for dai to ETH exchange and I'm going to scroll down and inside we contract. I am looking for a function called getreserves. I'm going to click on this. So that is our x value and that is our Y value. I'm going to use Python to do the calculation.
00:07:38.842 - 00:08:32.174, Speaker A: So I'm going to open Python shell inside my terminal and then copy and paste the values over here to inside Python shell. And we'll say that dx is equal to ten to the 18. So our dy should be equal to y times 0.997 times dx divided by x plus 0.997 times dx and that is our dy value. Let's check this value against uniswap and we check the value using uniswap b two router. And so I'm going to scroll down and make sure that I'm in reach contract and I am looking for a function called get amount out for amount in.
00:08:32.174 - 00:09:20.046, Speaker A: I pasted in the amount of dx that we assigned. Reserve in is equal to x. Reserve out is equal to y and I'll hit query. And that is the amount dy that uniswap gives us back. Inside Python shell, I've subtracted the actual amount that uniswap gave us back with the amount that we calculated, and the difference is zero point 65. Numbers are rounded down in solidity, so basically the difference is equal to zero. So in summary, on uniswap, the price of a token is calculated using x times y equals k, and the exact amount of tokens you'll get is equal to this equation over here.
00:09:20.046 - 00:09:22.380, Speaker A: Thanks for watching, and I'll see you later.
