00:00:00.330 - 00:00:43.578, Speaker A: Let's derive the equation for the real reserves. So let's say that we have the constant product curve x times y equals l square, and we'll say that the prices are p of b, the current price p and p of a. To get this curve for the real reserves, all we have to do is shift this curve to the left so that the point p of b on this curve will intersect the y axis, and then shift this curve down so that p of a will intersect x axis. Another way to look at this curve is like this. When the price is at P of a, all of the token will be in token X. And at this point the amount of token y is equal to zero. And likewise, when the price is at p of b, all of the liquidity will be in token Y, and the amount of token x will be equal to zero.
00:00:43.578 - 00:01:19.206, Speaker A: We will say that the real amount of token X when the price is at P of a, is equal to x zero, and likewise the real amount of token y when the price is at P of B. We will call this y zero. The amount of real token zero can vary from zero to x zero, and the real amount of token Y can vary from zero to y zero. So any amount between zero and x zero. We'll label this as xr, and likewise the variable amount from zero to y zero. We'll label this as yr. You can see that there is some distance between the y axis, the line where x equals zero.
00:01:19.206 - 00:01:59.234, Speaker A: To this point we'll label this distance as xb. This is the virtual amount of token x. And likewise, when yr is equal to zero, there is some distance between where yr is equal to zero. Over here to the x axis, the line y equals zero. We'll call this distance yb, the virtual amount of token y. To derive the equation for this real reserve curve, we need to solve for xb and yb. And what is the equation that we need to solve here? Well, notice that for any point inside the real reserve curve between p of b and p of a, it still needs to satisfy the equation x times y equals l square.
00:01:59.234 - 00:02:40.958, Speaker A: So we have the equation x times y equals l square. And what is the x component? Well, the x component is xb plus some variable amount xr. So we can replace this x with xr plus xb times y equals l square. And what is the y component for this real reserve curve? Well, the y component will be equal to yb plus some variable amount yr. So we get the equation for the real reserves curve xr plus xb times yr plus yb equals l squared. And from this equation we'll need to solve xb and yb to get the curve for the real reserves. Okay.
00:02:40.958 - 00:03:27.274, Speaker A: First, before we solve for xb and yb, I first want to derive equation for x and y in terms of l and p, the liquidity l and the current price p. So we have the two equation x times y equals l square and y divided by x equals two p. Using these two equations, if we divide l squared by p, then this is equal to x times y divided by y divided by x. The y cancels out and the x comes to the top and we get this equation is equal to x squared. Take the square root of both sides and we get that l divided by the square root of p is equal to x. And likewise if we do l squared times p, this is equal to x times y times y divided by x. The x's cancel out and we get this equation is equal to y squared.
00:03:27.274 - 00:03:46.850, Speaker A: Take the square root of both sides and we get l times the square root of p is equal to y. So we'll be using these two equations to solve for xb and yb. Here's the curve for the real reserves again. And we're going to be solving for xb and yb. Let's start with xb. To solve for xb. Let's consider the case when xr is equal to zero.
00:03:46.850 - 00:04:19.118, Speaker A: Here is the equation for the real reserves. Again, xr is equal to zero. So we can simply remove this and then, dividing both side of the equation by yr plus yb, we get that xb is equal to l squared divided by yr plus Yb. Now going back up, I'm going to use these equations. So I'll copy this and then paste it here. Now since Yr plus yb will be a point on this pink curve, we can use this equation to replace Y. So I'll copy this and then paste it here.
00:04:19.118 - 00:04:49.846, Speaker A: And we need to answer the question, what is the price p at the point yr plus yb? Well, let's take a look at this curve. We know that xr is equal to zero. So the x component will be here. And when x is over here, the only valid point for y will be over here. At this point, the price is equal to p of b. So at the point yr plus yb, we had that the price is equal to p of B. And we can replace this with this, canceling out the l on the bottom and the l on the top.
00:04:49.846 - 00:05:12.382, Speaker A: We get that xb is equal to L divided by the square root of p of b. Next, let's solve for yb. To solve for yb, we'll consider the case when yr is equal to zero. Again, we'll start with the equation for the real reserves. When yr is equal to zero, we can simply remove this. And then from both sides of the equation, we can divide xr plus xb. This will give us the equation y.
00:05:12.382 - 00:05:41.302, Speaker A: B is equal to L squared divided by xr plus xb. Now we can replace xr plus xb using this equation. So copy this equation and then paste it here. When yr is equal to zero, xr plus xb must be here. So this means that this price must be equal to p of A. And now we can replace this xr plus xb with this equation. The l on the top and the bottom cancel out, and the square root of p of a comes to the top.
00:05:41.302 - 00:06:14.870, Speaker A: And finally, we get that yb is equal to L times the square root of p of A. And we're now ready to write the equation for the real reserves. Since we solved for xb and yb, here's the equation for the real reserves again. And we solve for xb and yb. So scroll up and then this will be xb and this will be yb. Replace xb and replace yb. And we get that the equation for the real reserves is equal to this.
00:06:14.870 - 00:06:32.340, Speaker A: Later, we're going to be using this equation to answer questions such as the amount of liquidity between p of b and p of A, the amount of liquidity delta between these two price ranges, and the amount of token x and the amount of token y given liquidity current price p, and the price ranges p of b and p of a.
