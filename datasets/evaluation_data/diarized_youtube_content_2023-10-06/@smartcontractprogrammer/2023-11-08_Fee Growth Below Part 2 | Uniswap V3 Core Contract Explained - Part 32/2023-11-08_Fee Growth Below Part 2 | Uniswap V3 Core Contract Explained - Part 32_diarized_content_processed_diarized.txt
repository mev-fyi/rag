00:00:00.250 - 00:00:52.046, Speaker A: In the previous video we used a simple example to calculate the fee growth below, and we assumed that the fee growth started below a tick. In this example, we let the fee growth zigzag through some tick I, and when we did that we found out that f of B will be equal to these numbers. You can observe here that there is some kind of pattern to how fee growth below Fb changes. So in this video from this example, we'll derive an equation for f of b and also come up with an algorithm that will track f of B. Let's start with a review of the notations. We'll define f of g of k to be equal to phi growth of token y at time tk, and we'll assume that t of k is increasing, so t of k is less than t of k plus one, and tr k plus one will be less than t of k plus two, and so on. We'll define f of b to be equal to the phi growth of token y below tick I.
00:00:52.046 - 00:01:33.706, Speaker A: What f of B represents is the total height of these red rectangles. With this in mind, we'll first derive equation for f of B. On the left is a table of what f of B is at different times, and on the right is an example of how the fee growth zigzags through some tick I. Let's define f of o of n to be equal to the absolute value, and then take the sum of either plus or minus one multiplied by f of zero k. What this equation is describing are the terms that I've highlighted in purple box. F of o of zero will be this term. F of o of one will be these two terms, f of o of two will be these three terms, and so on.
00:01:33.706 - 00:02:04.846, Speaker A: Now let's rewrite f of b in terms of f of o of n. So let's start with f of o of zero. So when we evaluate f of o of n for n equal to zero, we get f of zero zero. Okay, next, let's rewrite this term in terms of f of o of one. Well, f of o of one will be f of g of zero minus f of g of one. However, we'll need to take the absolute value since f of g of one is greater than or equal to f of g of zero. This is because phi growth will always be increasing.
00:02:04.846 - 00:02:38.478, Speaker A: So these two terms will be negative. So to make it positive, we will need to add a minus sign. And then we have an extra f of g here. So to write f of b in terms of f of O, this will be equal to minus f of o one plus f of g f of b at time t two will evaluate f of o of n and replace n with two. So these terms will be equal to f of o two. Next, let's evaluate f of b for time t three. First, let's replace these terms with f of o of n, where n will be equal to three.
00:02:38.478 - 00:03:05.510, Speaker A: So if you expand this terms for n equals to three, we'll get these terms. However, again, this f of o of n has an absolute value, meaning that this will always be greater than or equal to zero. So for here we might need to put a minus sign if these terms are negative. So let's check. Well, we know that f log one is greater than or equal to f of g of zero. Again, this is because phi growth is always increasing. And the same goes here.
00:03:05.510 - 00:03:32.254, Speaker A: F of geo three is greater than or equal to f of geo two. So these two terms are either negative or zero. And these two terms are also negative or zero. So this means that these terms will always be less than or equal to zero. So to these terms, we add a negative to f of o three, and then we have an extra f of g. So we add an f of G. Okay, lastly, let's write f of b for time t four.
00:03:32.254 - 00:04:02.470, Speaker A: Let's replace this in terms of f of O. Well, this is just simply f of o of n for n equals four. And we can also check that these terms add up to be either zero or a positive number. The way you can check this is that we know that f of geo four is greater than or equal to f of geo three. And we know that f of geo two is greater than or equal to f of g of one. And we also know that f of geo zero is greater than or equal to zero. So when we add these two terms up, this will be greater than or equal to zero.
00:04:02.470 - 00:04:43.062, Speaker A: When we add these two terms up, f of g of two and f of g of one, then we know that this is also greater than or equal to zero. And we also know that f of g of zero is greater than or equal to zero. All of these terms, when we add it up, will be greater than or equal to zero. So f of b at time t four will simply be equal to fo of four. Now that we rewrote f of b in terms of f of O, we can come up with a simple equation for f of B. Let's derive a simple equation for f of b in terms of f of o and f of G. Let's define I of c to be equal to the current tick at time t, where t will be between t of k and t of k plus one.
00:04:43.062 - 00:05:25.698, Speaker A: Okay, and let's come up with an equation for f of b in terms of f of o and f of G. So, scrolling back up, let's examine what f of b is equal to when the current tick I of c is to the right of tick I. So we have our tick I over here, and the current tick I of c will be to the right somewhere over here. In this case, what is the value of f of B? Well, let's start here. At time t zero, the fee growth crosses over to the right, and between time t zero and t one, the current tick will be over here. In this case, what is the value of f of B? Well, we know that f of b will be equal to f of zero. And the same goes for over here.
00:05:25.698 - 00:05:58.926, Speaker A: Between the time t two and t three, current tick I of c will be to the right of tick I. Current tick will be somewhere over here. And what is the value of f of b when the current tick is on this side, on the right side of tick I? Well, we can see from this table that f of b will be equal to fo of two. And this is the same for time t equals to t four. After time t four, we know that the current tick will be to the right of tick I. This is over here. Current tick will be somewhere over here.
00:05:58.926 - 00:06:44.702, Speaker A: In this case, f of b will be equal to fo of four. What we observe here is that when the current tick I of c is to the right of tick I, then f of b will be simply be equal to one of these terms, f of o of zero, f of o of two, or f of o of four. On the other hand, when the current tick I of c is to the left of tick I, so the current tick will be either be here, here, or here. Then fb will be equal to this term for time between t one and t two. And you can see this over here. At time t one tick crosses over to the left, and at time t two, the tick crosses over to the right. So in between t one and t two, we'll have f of b be equal to these terms.
00:06:44.702 - 00:07:23.500, Speaker A: Likewise, between time t three and t four, the current tick will be somewhere over here. And when the current tick is somewhere over here, f of b will evaluate to this expression. Let's write this pattern down into a general equation. When the current tick I of c was to the right of tick I, we saw that f of b was equal to f of o of k. And when the current tick was to the left of tick I, we saw that f of b was equal to f of g minus f of o of k. So this is the equation for f of b in terms of f of o and f of g. Next, we'll turn this equation into an algorithm that tracks f of O.
00:07:23.500 - 00:08:10.882, Speaker A: Let's find the algorithm to track f of o of n. Here I've listed f of o of zero, one, two and three. When you expand the terms, here they are. Next, I'm going to rearrange these terms. Next, let's try to find how we will go from f above zero to f above all one, and from f above one to f above two, and from f above two to f of all three. What do we need to do to this term to get to these terms? And what do we need to do to these terms to get to these terms? And finally, what do we need to do to these terms to get to these terms? So, let's start from here to go from f of g of zero to f of g of one. Minus f of g zero.
00:08:10.882 - 00:08:46.146, Speaker A: What we'll need to do is minus f of all zero, and then add f of g of one. If we minus f of all zero, we'll get minus of this. So we have minus f of g of zero. And to this we will need to add f of g of one. That's how we will get from f of all zero to f of all one. Okay, how about from f of all one to f of o of two? Well, again, to get from f of all one to f of all two, what we'll need to do is take f of g o two, minus f of all one. So here is f of all one, and we minus all the terms.
00:08:46.146 - 00:09:11.530, Speaker A: So we'll have minus f of g of one. Minus minus will become a plus. So we'll have plus f of g of zero. And to these terms, we'll add f of g of two. So that's how you get f of o two. How about from here to here? What do we need to do? Well, again, what we need to do is add a minus to f of two, and then add fog three. Here's fog three.
00:09:11.530 - 00:10:14.860, Speaker A: And here are the terms for f of two multiplied by minus one. So, as you can see from here, the way to get to f of o of n plus one is to take f of g of n plus one, and then minus f of o of n. And we're now ready to come up with an algorithm for f of o of n. For the algorithm that will track f of o of n, we'll assume that the current tick ifc is less than or equal to tick I, and we'll initialize a variable, let's call it f out, to be equal to fg, and then we'll update f out to be equal to fg minus f out when fg crosses tick I. So what you're seeing over here is this equation, and this is the algorithm that we'll be using to to track fo of n. So, in this video, we derived the algorithm that will track f o of n, and we also came up with an equation for f of B. In the next video, we'll do the same for f of a, which tracks the fee growth above tick I.
