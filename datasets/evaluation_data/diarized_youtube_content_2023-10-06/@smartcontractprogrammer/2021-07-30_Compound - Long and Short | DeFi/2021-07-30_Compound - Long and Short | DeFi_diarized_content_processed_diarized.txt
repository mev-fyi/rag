00:00:00.490 - 00:00:30.306, Speaker A: You can potentially earn crypto assets by betting on the price going up or going down. This is called long and short. So in this video, I'll explain how to long a crypto asset and shorter crypto assets on compound. In this video, I'll explain what they are, and then we'll write the code. And then I'll show you a demo on ganache main network. Let's get started. When you bet that the price of e will go up in the future, this is called long ETH.
00:00:30.306 - 00:01:07.326, Speaker A: Let's see how you can potentially earn more ETH by betting that the price of ETH is going up in the future. Let's say that the price of ETH today is $100. And one week from now, I predict that the price of ETH will be around $200. With this prediction, how can I gain more ETH in the future? Well, here is how you would do it. Let's say that I have ten e and I'm going to supply this ten e to compound. Once I supply the ten e to compound, I'll be able to borrow another crypto asset. So I'm going to borrow die.
00:01:07.326 - 00:01:45.310, Speaker A: Now, we'll say that the collateral ratio on compound is 65%, but we don't want to borrow up to 65% because then my ETH will be liquidated. So just to be safe, I'm going to borrow amount that is less than the collateral Ratio. I'm going to borrow at 30% of the collateral ratio. So we'll borrow 300 die e is $100 today. I supply ten e, so that's around $1,000. 30% of $1,000 is around 300 die. Next, I'm going to take this 300 die and then sell immediately for more ETH is $100.
00:01:45.310 - 00:02:12.370, Speaker A: Today, I have 300 die, so I'll get back three e. One week from now, let's say that my prediction was correct. The e price went up. The price of e doubled, so now it is $200 per e. I make a decision that now is the time to make my profit. So this is what I'm going to do. I'm going to take the three e that I bought over here and then buy back the die that I borrowed.
00:02:12.370 - 00:02:39.514, Speaker A: Since I borrowed 300 die, I have three E and each e is worth $200. Right now, the amount of ETH that I need to sell in order to get back 300 die is 1.5 e. For simplicity, we'll say that die is trading at $1. So 1.5 E times $200 is $300, which is equal to 300 die. So I get back 300 die.
00:02:39.514 - 00:03:03.094, Speaker A: I repay this 300 die to compound. So because I bought three e and I sold 1.5 e, I am left with 1.5 e in profit. So that is how I will make more ETH, by correctly predicting that the price of ETH is going up. So we just saw a long e. We are betting that the price of beef is going to go up.
00:03:03.094 - 00:03:37.298, Speaker A: What if we want to bet that the price of beef is going down? Well, this is called shorting e. Let's see how we can make a profit by betting that the price of beef is going down. Let's say that the price of beef today is $200. And over the last few weeks, I noticed that the price of beef is going down. One week from now, I predict that the price of beef is still going to keep on going down. It's going to be around $100. How would I make some profit off of this prediction? Well, here is how you would do it.
00:03:37.298 - 00:04:03.318, Speaker A: Let's say that I have 1000 die. I'm going to supply this 1000 die to a compound. We'll use this as a collateral to borrow some e. Again, we'll say that the collateral ratio on compound is 65%. To be safe, we're going to borrow less than the collateral ratio. Let's say that around 30% e today is $200. So I'm going to borrow around 300 die worth of ETH.
00:04:03.318 - 00:04:25.198, Speaker A: That turns out to be 1.5 e. I'm going to immediately sell this e for die. 1.5 e times $200 per e will give me 300 die. One week later, my prediction was correct and the e price went down by 50%. It was $200 a week before, and now it is $100.
00:04:25.198 - 00:04:44.786, Speaker A: I think it's time to claim profit. So I'm going to take the 300 die that I have and then buy back 1.5 e that I borrowed. I borrowed 1.5 e. The price of ETH today is $100. So I'll spend about 150 die to buy back the ETH that I need to repay.
00:04:44.786 - 00:05:14.862, Speaker A: And then I repay the 1.5 e to compound and I'm left with 150 die in profit. So that is how you make a profit. By predicting that the price of beef is going to go down, you borrow e and then sell it immediately. When the price of ETH indeed goes down, you would buy back the ETH, repay the ETH that you borrowed and your left of profit. Let's now take a look at the code. How would we long ETH on compound using solidity.
00:05:14.862 - 00:05:51.630, Speaker A: Well, we're going to first supply ETH and then borrow stablecoin. We'll say it's die and then buy ETH on uniswap. When the price of ETH goes up, we'll sell the ETH on uniswap and then repay the borrowed stablecoin. The first thing that we'll do is import some interfaces, Erc 20, compound and Uniswap. Next, we'll define some state variables to store in this contract. C E, C token, borrow token, borrow, and the decimals of the token that we're going to borrow. We're also going to set some contracts that we're going to need.
00:05:51.630 - 00:06:20.226, Speaker A: Controller and price feed from compound and uniswap. B two router from uniswap, and then we'll set the state variables. Ce, C token, borrow token, borrow, and decimals of the token that we're going to borrow. We need to enter the market for C E. By entering a market, we'll be able to borrow another asset. So that is what we're doing over here. This contract will need to be able to receive ether from compound and from uniswap.
00:06:20.226 - 00:07:09.314, Speaker A: So here we'll declare that this contract can receive ether by declaring a function called receive and declaring it as payable. Now, receive is similar to the fallback function, except in receive message data must be empty to go along on ETH. The first thing that we'll do is supply the ETH to compound, and we do that by calling the mint function on the CEf contract and sending some ether when we call this function. Once we supply ETH to compound, how much dai can we borrow? Well, we're going to calculate how much dai we can borrow using this function. I'm named it Getmax borrow. We'll first need to get the liquidity of our account. Liquidity means how much we can borrow in terms of USD dollars, and this number is scaled up by ten to the 18.
00:07:09.314 - 00:07:56.654, Speaker A: We'll do a quick check, make sure that the error is equal to zero, shortfall is equal to zero, and liquidity is greater than zero, meaning we are able to borrow another asset. Next, we're going to get the price of the token that we're going to borrow by calling the contract price feed get underlying price. For this example, the token that we're going to borrow is Dai. So the price of dai should be close to $1, scaled up by ten to the 18. To calculate the maximum amount of die that we can borrow, we divide liquidity by the price of the die and then scale it up by ten to the 18. Once we calculate the max borrow, the maximum amount of die token that we can borrow will return this. We now know how much dai we can borrow.
00:07:56.654 - 00:08:34.598, Speaker A: Let's now go long on ye. I've named this function long and it's going to take in a single input the amount of dai that we're going to borrow which we can get by calling the function that we just wrote above here. We're going to borrow die and then buy ETH to borrow die. On the C token borrow contract we're going to call the function borrow passing in the amount of token that we're going to borrow. Now to buy ETH, we're going to be calling uniswap. So once we are able to borrow Dai from compound, we're going to calculate the balance of dai that we actually got. We'll approve uniswap to expend this amount and then buy ETH on uniswap.
00:08:34.598 - 00:09:09.110, Speaker A: We'll set the path on uniswap from token borrow to wef, meaning that we want to sell token borrow. In our example, it's going to be di and then buy wef, pass this array path to uniswap. The function that we're going to call is swap exact tokens for ETH. If this function is successful, we would have borrowed dai and then bought ETH with it. Let's say that one week later the price of ETH went up. We want to now claim profit. So let's now write the function that will claim the profit.
00:09:09.110 - 00:09:42.774, Speaker A: The function that we're going to call is called repay. What is it going to do? Well, it's going to sell ETH and then repay the borrow token to sell ETH. We're going to call uniswap b two router again. This time we're selling ETH and then buying back the token that we borrowed. The function that we're going to call is called swap exact e for tokens. Once we have the borrow token, we'll repay compound. The first thing that we'll do is get the borrow balance on compound by calling c token borrow borrow balance current.
00:09:42.774 - 00:10:18.838, Speaker A: Now this will return the current balance of the borrow token including any interest rates. We'll approve the C token contract to be able to spend this amount and then we'll call the repay borrow. After we repay our borrow, we're going to redeem the token that we supply. In this case it will be ETH. So we'll get the amount of ETH that we supply to compound by calling the function balance of underlying. And this will return the amount of ETH that we supply plus the interest on supply. And we'll claim our ETH by calling the function redeem underline.
00:10:18.838 - 00:10:54.560, Speaker A: At the end we will have the original ETH that we supplied plus the interest on the supplied ETH and the profit that we made from going long on ETH. Now here the profit will be in token that we borrowed. So in order to get it into ETH, you'll have to buy ETH from dai. And that completes the contract to go long ETH and then claim the profit when the price of ETH goes up. Let's take a look at the test file. We're going to supply ETH and the token that we're going to borrow is die. The amount of ETH that we're going to supply is ten E.
00:10:54.560 - 00:11:42.698, Speaker A: Now, for this example, we can't manipulate the price of ETH, meaning that for this test we can actually claim any profit, but we'll still have to repay compound for the interest on borrow. We'll make sure that we can repay our borrow by funding our contract with some extra die. So we're going to fund our contract with 1000 die. The first thing that we'll do is supply ETH for ten e and then we'll calculate the maximum amount of die that we can borrow and then we'll borrow 50% of the max borrow and then call long. And let's say that the price of ETH does go up, then we'll need to call repay. So we'll do that over here. So we call repay and then print out some logs.
00:11:42.698 - 00:12:16.518, Speaker A: Let's now run this in Ganache. So I'm going to run this in Ganache. Once it's running on main net fork, I'm going to open another terminal and the test file that we're executing is named test compound log. The test completed successfully. Let's now take a look at the log. Let me explain what happened. We supplied ten neef and this gave us a liquidity of $17,242.
00:12:16.518 - 00:12:57.582, Speaker A: The maximum amount of die that we can borrow is 17,229 die. The amount that we're going to borrow is 50% of that, which is 8614. Once we borrow this amount, we immediately buy ETH and we get back three e. On uniswap, we sell the three e for die and then repay the die to compound. Once we repay back our loan, we are able to redeem the ten e that we supplied. Now for this example, we supplied this contract with an extra 1000 die. And this is so that we are able to pay back the die that we borrow, even if we didn't make any profit.
00:12:57.582 - 00:13:42.490, Speaker A: Now, if you actually made any profit, since we supply this contract with 1000 die, you would see this number over 1000. So that is how you go long on e on compound. The last thing that I'll mention is the risk of going long on ETH. One of the risks that you'll need to take into consideration is the interest on borrow. The interest on borrow is always accumulating, so your borrow balance is always increasing. But if the price of beef either goes down or doesn't go up quickly enough, then at some point you'll have to make a decision either to close your position at a loss or keep on waiting in hopes that the price of beef goes up. Thanks for watching and have fun coding.
