00:00:00.250 - 00:00:33.682, Speaker A: In unisoft b three, the curve of the real reserve is given by this formula. So in this video we'll derive this equation starting from the constant product equation x times y equals k. Let's say that the current liquidity in unisoft b three pool is l and the current price is p. This means that we are trading on the curve x times y equals l square and the current price is equal to p is equal to y divided by x. This is equal to the price of x in terms of y. Let's take a look at what this looks like on a graph. Here is the graph of the curve x times y equals l square and p will be a point on this curve.
00:00:33.682 - 00:01:09.250, Speaker A: I said that p is the price of x in terms of y. Let's see why this is. We'll say that the horizontal line represents the amount of token x inside the pool and the vertical axis represents the amount of token y in the pool. Starting from the current price p, if the amount of token x inside the pool decreases, then this will shift the point. Let's say to pob, the amount of token x is decreasing. So along this curve we move the price to the left token X became more expensive. On the other hand, starting from the current price p, if the amount of token X increases, then the point P will shift to the right.
00:01:09.250 - 00:01:47.418, Speaker A: And notice that the price has decreased from p to P of A. In other words, when we increased the amount of token X inside the pool, the price decreased. Now notice that for the price to be at PlBa, we needed this much token X and this much token Y. Likewise, for the price to be at PLB, we will need this much amount of token X and this much amount of token Y. However, to move the price p to p of A or from p to p of b we don't need these amount of tokens. The actual amount of tokens that is needed is less than the blue lines. For example, to move the price from p to p of A, the amount of token X that we need is highlighted in orange.
00:01:47.418 - 00:02:21.958, Speaker A: This much amount of token X will come in. In return. This vertical orange line amount of token Y will go out. In other words, to move the price from p to p of A, the amount of token y that is needed is highlighted in orange. In the same way, to move the price from p to pov, the amount of token Y that has to come in is also highlighted in the orange vertical line. When this much amount of token y comes in, this much amount of token X will go out. The orange horizontal line that you see over here is the amount of token next that will actually go out.
00:02:21.958 - 00:03:08.418, Speaker A: In other words, to move the price from p to P of B, the amount of token next that we need is highlighted in this orange horizontal line. To summarize, in uniswap B, two, to be at the price P of A, then we would have needed this much amount of token Y and this much amount of token x. And to be at price P of B, we would have needed this much amount of token Y and this much amount of token X. However, to cover the price range from P of a to po B, the actual amount of tokens that we need is less. The actual amount of tokens that we need to cover P of A to pob is highlighted in orange. This much amount of token X and this much amount of token Y to derive the curve for the real reserve, we translate this blue curve over to the left and to the bottom. This orange curve is the curve for the real reserves.
00:03:08.418 - 00:04:01.494, Speaker A: Since this orange curve is a translation of the blue curve to the left and to the bottom, it has the same curvature as the blue curve. Starting at the current price p at p of a, this much amount of token y has left the pool. So on the orange curve we want to match p of a so that the amount of token y is zero and all of the tokens are in token x. Likewise, if we go from price p to Pov, then this much amount of token x has left the pool. So when the price is at Pov, we want all of our tokens in token Y. Let's find out the equation for this curve. What is the curve of the real reserves? The curve of the real reserves between the price range p of a and p of b is given by this equation x, sub r plus l divided by the square root of p of b times y bar plus l times the square root of p of a and this must be equal to l square.
00:04:01.494 - 00:04:49.410, Speaker A: Now, as a side note, notice that when p of a is equal to zero and p of b is equal to infinity, then l times the square root of p of a p of a is equal go to zero, so this will simply be y of r. When p of b is a very large number, then l divided by the square root of p of b is a very small number. So when p of b is equal to infinity, we can treat this as being zero and we get simply xr. In other words, when the price range p of a to p of b is equal to zero to infinity, then this equation becomes xr times yr equals l square. Notice that this is the same equation as unison b two x times y equals k. In other words, when the price range is from zero to infinity, this curve is exactly the same as unison b two curve. Okay, let's now derive this equation, the curve for the real reserves.
00:04:49.410 - 00:05:12.734, Speaker A: First, we'll do some simple algebra to derive that x is equal to l divided by the square root of p, and y is equal to l times the square root of p. Let's start with the first one. X is equal to l divided by the square root of p. We will start with this equation. X times y equals l square and price p is equal to y divided by x. Now, starting from this equation, let's solve for x. So I'll paste it here.
00:05:12.734 - 00:05:30.598, Speaker A: X times y equals l square. Dividing both side of the equation by y. We get x is equal to l squared divided by y. This is equal to. We know that p is equal to y divided by x. So y is equal to p times x. So we replace this y with p times x.
00:05:30.598 - 00:05:54.638, Speaker A: Okay? So let's simplify this equation. X is equal to l square divided by p times x. X is equal to l square divided by p times x. Let's multiply both side of the equation by x. Multiply the right side of the equation by x, and the x on the bottom disappears. Multiply by x on the left side of the equation, and we get x squared. We get x squared is equal to l squared divided by p.
00:05:54.638 - 00:06:24.918, Speaker A: Taking the square root of both side of this equation, we get x is equal to l divided by the square root of p. Okay, so we derived that x is equal to l divided by the square root of p. Let's do something similar to derive y is equal to l times the square root of p. Again, we'll start with this equation. X times y equals l square. Solving for y, we divide both sides by x, and we get y is equal to l square over x. Next, let's substitute this x with this equation over here.
00:06:24.918 - 00:06:49.438, Speaker A: P is equal to y divided by x. So x will be equal to y divided by p. So this equation will be equal to p is equal to y divided by x. So we bring the x to this side and bring the p over to this side. And we get x is equal to y divided by p. And we'll substitute this x with y divided by p. Okay, this will be equal to.
00:06:49.438 - 00:07:15.798, Speaker A: We bring the p up to the top, and this will be equal to l square times p divided by y. Okay, so let's simplify this equation. Y is equal to l squared times p divided by y. Y is equal to l squared times p divided by y. So let's multiply both side of the equation by y to remove this y on the right side of the equation. So I multiply both side of the equation by y. So the y on the bottom will cancel out.
00:07:15.798 - 00:08:01.702, Speaker A: Multiply the left side of the equation by y, and we get y squared is equal to l squared times p. Taking the square root of both side of the equation, we get y is equal to L times the square root of P. Okay, so now that we can rewrite x and y in terms of the liquidity l and the current price p, let's now derive the equation for the real reserves. We will rewrite x and y in terms of the real and the virtual reserves. X is equal to the real reserves, x of r plus some virtual reserve x of B. Likewise for y, we'll say y is equal to the real reserves of y, y r plus some virtual reserves y b. We'll rewrite x times y equals l square as x times y is equal to x, sub r plus x, sub b times y of r plus y of B.
00:08:01.702 - 00:08:26.394, Speaker A: We'll solve for x of b and y of b, and this will give us the curve for the real reserves. Let's find x of B and y of B. When the current price p is equal to pob, we want the real reserves of token x and token Y to be fully in token Y. In other words, token x is equal to zero. Let's write this down. When the current price p is equal to p of b, x, sub r is equal to zero. And let's now solve for this equation.
00:08:26.394 - 00:08:45.700, Speaker A: Setting x subar equal to zero. So I'll copy this equation, paste it here. When p is equal to p of b, x r is equal to zero. This x subar is equal to zero. Let's simplify this equation. X, sub r is equal to zero. So the first part of the equation, we're left with x, sub b.
00:08:45.700 - 00:09:16.526, Speaker A: The second part remains the same. So I'll just copy this and then paste it here. This is equal to l square. Okay, let's rewrite this equation. So I'll copy this, paste it here, and I'll bring this part of the equation over to the right. X, sub b, will be equal to l square divided by y of r plus y of b. Now if we scroll up, we said that y is equal to l times a square root of p.
00:09:16.526 - 00:09:47.126, Speaker A: So let's replace this part of the equation with y is equal to l times a square root of p. To this yr plus y b, we will apply the equation y is equal to l times a square root of p. Also notice that we said that p is equal to p of b. So l times a square root of p is equal to l times a square root of of b. So this equation is equal to. We will substitute this with l of p of B. So I'll remove this and then copy L times a square root of p of b and then paste it here.
00:09:47.126 - 00:10:18.018, Speaker A: I forgot to add a power of two, so I just did it right now. Okay, once we have this equation, we can cancel out the l on the bottom and l on the top. I'll cancel out the l square on the top and L on the bottom, and we're left with L. Let's clean up this equation. So this equation will be equal to. On the bottom, the l is cancelled out, and on the top we're left with L. And we have solved for x, sub x, sub b is equal to L divided by the square root of p of B.
00:10:18.018 - 00:10:51.990, Speaker A: Okay, let's solve for Y of B. We will use a similar argument that we did to derive x of B. To derive y of b, when the current price p is equal to p of A, we want the actual month of tokens inside the pool to be Foley n token x. In other words, the amount of token y inside the pool is equal to zero. When the current price p is equal to p of A, the actual amount of token y y bar is equal to zero. Okay, so let's rewrite this equation substituting y a bar for zero. So I'll copy this equation, scroll down, and then paste it here.
00:10:51.990 - 00:11:16.690, Speaker A: Y a bar is equal to zero, so I'll say this is equal to zero. And let's rewrite this equation. The right part of the equation remains the same. Y a bar is equal to zero. So we're simply left with y of b, and this is equal to l square. Okay, let's solve for y of b. Starting from this equation, I'll move over this x subar plus x, sub over to the right.
00:11:16.690 - 00:11:49.982, Speaker A: So I'll take this, paste it here, and then say y of b is equal to l squared divided by x subar plus x, sub. Now if I scroll up, we derive that x can be rewritten as l divided by the square root of p. So let's do that. Over here. We'll substitute x subar plus x, sub, using the fact that x is equal to l divided by the square root of p. And notice that we said that p is equal to p of a. So l divided by the square root of p is equal to l divided by the square root of p of a.
00:11:49.982 - 00:12:25.690, Speaker A: Okay, so let's substitute this part of the equation with this, I'll copy the equation, remove the bottom. Since we're substituting, I'll copy this equation, paste it here. Next, we'll cancel out the l square with the L, so cancel out L square and L. And on the top we're left with L. Let's rewrite this equation so this is equal to on the top we're left with L, and on the bottom we're left with one over the square root of p of A. Or we can bring this square root of p of A to the top and we have the final equation. Y of B is equal to L times the square root of p of A.
00:12:25.690 - 00:13:26.060, Speaker A: Okay, the final step to derive the curve for the real reserve is to combine all of the equations that we have derived so far. So in the previous step we said that x of B is equal to L divided by the square root of p of B, and y of b is equal to L times the square root of p of A. We also rewrote x times y equals l square as x times y is equal to x, sub R plus x, sub B times y bar plus y of B. We found out what x sub and Y of B are, so we can replace this x sub and y of B with this equations over here. Replacing x of B with L divided by the square root of p of b and y of b with l times the square root of p of a, we get our final result. The equation for the curve of the real reserves x, sub R plus L divided by the square root of p of b times y of r plus l times the square root of p of a is equal to l square. In the upcoming videos we'll use to derive liquidity delta change in liquidity when we add some amount of token x and token y.
