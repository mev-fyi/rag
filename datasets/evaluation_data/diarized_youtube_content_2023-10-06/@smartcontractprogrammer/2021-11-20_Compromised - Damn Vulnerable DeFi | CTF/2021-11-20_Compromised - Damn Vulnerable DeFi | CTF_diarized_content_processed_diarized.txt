00:00:00.570 - 00:00:23.198, Speaker A: Today we'll take a look at the 7th challenge of damn bonable DFI compromised. There is an onchain exchange selling NFTs. The price of NFT is fetched from an onchain oracle. There are three trusted reporters that can post price to the onchain oracle. The addresses of these reporters are listed here. We start with 0.1 E.
00:00:23.198 - 00:00:49.450, Speaker A: The challenge is to steal all e from the exchange. An extra information given for this challenge is that a web service leaked some information and this is the data that was leaked. Let's take a look at the code. Here's the exchange contract. It stores the NFT as token and price Oracle as Oracle. There are two functions. Buy one to buy an NFt and sell one to sell your nFt.
00:00:49.450 - 00:01:28.034, Speaker A: When we call buy one, we send some ether to this function and the price of NFT is determined by the oracle get median price. If we paid enough, then we'll get the NFt to sell an NFt. We call sell one. It gets the current price of the NFT from the price oracle and then it checks that there are enough ether locked in this contract so that we can sell the NFT. The contract buys back the NFD from us and then sends us the ether for the price of the NFD. The NFD contract is a regular ERC 20. It doesn't look like it has anything special, has a function to mint and it has a function to burn.
00:01:28.034 - 00:02:19.400, Speaker A: And lastly, trusted Oracle contract has a lot of functions in it, but the functions that we are interested in are the ones that manipulate the price of the NFT. So we'll probably look into the functions postprice and get medium price. Our challenge is to drain all ETH stored in the exchange contract. Pause the video here, give it a try, and in a few seconds I'll explain the solution. The solution is that this data turns out to be the private keys of the two price oracles. So using these private keys we can manipulate the price of the NFT, manipulate the price to zero, buy the NFT, manipulate the price back to something expensive, and then sell the NFT from the two leaked data. We'll craft it into private keys by calling this helper function leak to private key.
00:02:19.400 - 00:02:54.058, Speaker A: Once we have the private keys, we'll import it into web3 and then unlock the accounts for the first price oracle, and for the second price oracle. Once we have unlocked accounts for the first price oracle, and the second price oracle, we'll post the price of the NFT for zero. We're manipulating the price of the NFT to be zero. And then we buy one. Afterwards, we set the price of the NFT to 10,000 ether. This is the amount of ether that is locked inside the exchange contract. And then lastly we sell the NFT.
00:02:54.058 - 00:03:06.020, Speaker A: Open the term run NPM run compromised. We passed the challenge. Thanks for watching. See you next week.
