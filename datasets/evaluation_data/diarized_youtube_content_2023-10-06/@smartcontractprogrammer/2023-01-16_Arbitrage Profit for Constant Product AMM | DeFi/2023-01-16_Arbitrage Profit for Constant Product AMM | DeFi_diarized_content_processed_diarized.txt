00:00:00.330 - 00:00:47.178, Speaker A: In this video, I'll explain some equations related to the arbitrage profit for a constant product, amm. First, assume that a centralized exchange has infinite liquidity. The amm has token x and token y, and the price p is equal to y divided by x. On the centralized exchange, the price is lower p minus dp. From the price difference between p and p minus dp, an arbitrager can make a profit. First, the arbitrager will sell dy zero amount of token y to the centralized exchange and get back Dx amount of token x. Next, taking the dex amount of token x that he got from the centralized exchange, he will sell this amount of token x to the amm, put in dx amount of token x, and get back dy one amount of token y.
00:00:47.178 - 00:01:27.222, Speaker A: The difference in the amount of token y that he sold on the centralized exchange and then got back from the amm is the profit. I've highlighted this in green and let's call this a for arbitrage profit. A is equal to arbitrage profit and this is equal to the difference of dy one and dy zero. Dy one minus dy zero. We can also write this arbitrage profit in terms of the price changes and the amount of token X that was sold dx. Here I've zoomed in on the graph of the arbitrage and let's say that this green line represents the current price of the amm. We'll also say that there are x zero amount of token X and y zero amount of token y.
00:01:27.222 - 00:02:08.678, Speaker A: Y zero divided by X zero will be equal to the current price p. On the centralized exchange, the price is quoted as P minus Dp. Seeing the price difference of P and p minus Dp, the arbitrager has an opportunity to make profit, sell Dx amount of token X and get back dy one amount of token y. This trade in purple will lower the price from p to p minus dp. But before the arbitrager can execute this trade, he first has to get Dx amount of token X. So to do that, the arbitrager will first go to the centralized exchange and then sell dy zero amount of token y. In exchange from the centralized exchange, he will get Dx amount of token X.
00:02:08.678 - 00:02:48.750, Speaker A: This amount of token X is the same amount of token x that you see here in purple. Once he has this dx amount of token x. Next he will go to the amm and then sell this exact amount Dx amount of token x, and in return he gets back dy one amount of token y and on the amm the price has shifted from p to P minus dp. This difference in dy zero and dy one is the profit for the arbitrager. I've highlighted this in green. A is the arbitrage profit and this is equal to dy one minus dy zero. We can also write this equation in terms of price change and the amount of token x that was sold Dx.
00:02:48.750 - 00:03:20.010, Speaker A: To do that, we need to get two prices. The price that the centralized exchange gave us and the price that the amm gave us. Take the difference, multiply it by Dx and that is arbitrage profit. Let's start with the Amm price. When we did a trade for Dx and dy, what was the price of the trade? It is not equal to p and it is not equal to p minus dp. The price of the trade would be somewhere between p and p minus dp. The arbitrager put in Dx amount of token x, then got back dy one amount of token y.
00:03:20.010 - 00:03:56.850, Speaker A: So we can say that the price of the trade is this slope of dy one over dx. This slope in blue, I'll name it, p star, is the price of the trade. We can find p star by finding dy one over dx. We can find dy one the amount of token y that the amm will give back to the arbitrager. By this equation, dy one is equal to y zero divided by x zero plus dx times dx. This equation is derived by solving for the swap equation. For the constant product amm, the amount of reserve after the trade must be equal to the amount of reserve before the trade.
00:03:56.850 - 00:04:32.462, Speaker A: Solve this equation for dy one and you get this equation. And now with this equation we can find the slope p star. As a reminder, p star is the execution price. The price per trading dx amount of token x for dy one amount of token y. And from this equation, if we divide both side of this equation by dx, we get that dy one over dx is equal to y zero over x zero plus dx. So this slope in blue is equal to this equation. We now have an equation to write dy one in terms of p star and the amount of token x that was sold dx.
00:04:32.462 - 00:05:01.882, Speaker A: This will be simply p star times dx. Let's also rewrite dy zero in terms of price and dx. On the centralized exchange, the arbitrager put in dy zero amount of token y and got back dx amount of token x. The price of the token is the slope of this red line, p minus dp. Starting from here. If we move dx, then we know that y has changed by dx times the slope. The slope is p minus dp.
00:05:01.882 - 00:05:42.570, Speaker A: So this dy zero, the change in y will be p minus dp times dx dy zero. The change in y from here to here will be equal to the slope. P minus dp times the change in x dx, which you see over here. Okay, so we now rewrote dy zero in terms of price and dx. So we're now ready to rewrite the arbitrage profit, a is equal to dy one minus dy zero. The first part, dy one is equal to p star times dx, which we derived over here. And then dy zero will be equal to p minus dp times dx, which we derived over here.
00:05:42.570 - 00:06:27.010, Speaker A: We can further simplify this equation, pulling out the dx to the right, and we get that arbitrage profit will be equal to p star minus p minus dp times dx. This is the equation for the arbitrage profit in terms of the difference in price times the amount of tokens that were sold. In some cases, we can further simplify this equation. In the case when p star is close to p minus dp, there is a simpler approximation to a we know that p star is between p minus dp and p. For example, let's say that p star is very close to p minus dp over two. In this case, when we plug in p star into this equation, we get that the arbitrage profit A is approximately equal to dp over two times dx.
