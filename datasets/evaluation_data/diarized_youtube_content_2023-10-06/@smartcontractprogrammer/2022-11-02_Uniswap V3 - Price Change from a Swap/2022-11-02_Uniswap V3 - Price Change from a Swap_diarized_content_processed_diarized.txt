00:00:00.330 - 00:00:48.570, Speaker A: What is the price change after a single swap on unisoft b three? I'll go over some of the math behind it for the math that I'm going about to show you. We'll assume that there's enough liquidity in a single position and what we're going to find is the price P one after swapping either delta x or delta Y. And we're assuming that there is enough liquidity to swap on the curve x times y equals l squared. In this case, the price P one after a swap is described by these equations. Delta X is equal to delta of one over the square root of price p times liquidity L. And using this equation, we will be able to get the price after the swap square root of P one. Likewise, delta Y is equal to delta of square root of p, the change in the square root of p times liquidity L.
00:00:48.570 - 00:01:45.658, Speaker A: And using this equation, we will be able to get the price change after a swap square root of P one now, for this video, I said that we're assuming that there's enough liquidity to swap on the curve x times y equals l square. So first I'll explain what we mean by this. What do I mean when I say that we are assuming that there is enough liquidity for a swap on the curve x times y equals l square? Here we have a graph of X times y equals l square in blue and then in orange. Let's say that this is the curve of the real reserves. If the swap doesn't have enough liquidity, then our starting price will be. Let's say that somewhere between Poba and pob and after the swap, the price P one will be outside this range, either above pob or below P of A. You can see from the graph that there isn't enough liquidity, since the liquidity is only supported between the price range p of A and p of b, and the price after the swap falls outside of this price range.
00:01:45.658 - 00:02:27.370, Speaker A: So not enough liquidity means that the price after the swap P one is either less than p of a or P one is greater than p of B. On the other hand, let's go over what it means for the swap to have enough liquidity again. In blue, we have the curve x times y equals l square. We're trading on this curve. And what we mean by having enough liquidity is that the price p one after the swap is still in the range of p of A and p of B. Assuming that there is liquidity inside these price ranges that is represented in the orange curve. So enough liquidity means that after the swap, p of one is greater than or equal to p of A and p of one is less than or equal to p of B.
00:02:27.370 - 00:02:46.670, Speaker A: P of one remains in the range of p of A and p of B. That is what we mean by enough liquidity. Okay, so now let's go over the math. Let's derive these two equations, and then later we'll derive this equation. Let me define some variables. First, we'll say that p of zero is the current price. And at this point we have x of zero and y of zero.
00:02:46.670 - 00:03:16.778, Speaker A: After the swap, we'll say that the price is P of one and you'll have corresponding x of one and Y of one. And we're trading on the curve x times y equals l squared. There are two important equations that we'll be using. Taking this x times y equals l square, we can rewrite it as l is equal to the square root of x times y. The price p is defined as y over x. So the square root of price p is equal to the square root of y over x. From these two equation, we get two important equation that we'll be using in this video.
00:03:16.778 - 00:03:48.594, Speaker A: X is equal to l over the square root of price p, and y is equal to l times the square root of p. This equation is true for all xy on the curve x times y equals l square. So these equations apply to x one and y one, x zero and y zero. Since all of these points are on the curve x times y equals l square. This is an important fact to remember as we will derive the equations for delta x and delta y. So let's now derive our first equation. Find delta x.
00:03:48.594 - 00:04:15.498, Speaker A: By definition, delta x is equal to the change in x. So that will be x one minus x zero. On the graph, it will be x one minus x zero. The difference is delta x. Next, let's rewrite x one and x zero using this equation. So I'll copy this and then paste it here. And then say x of one will be equal to l over the square root of p.
00:04:15.498 - 00:04:50.566, Speaker A: P at x of one is p of one. So over here I'll put a p of one, and likewise we can replace x sub zero using this equation again. So I'll copy this, then paste it here and say x sub zero. At the point x sub zero, we have p of zero. So x sub zero will be equal to l over the square root of p of zero. Okay, we rewrote x sub one and x sub zero using this equation over here. So let's rewrite this equation.
00:04:50.566 - 00:05:16.938, Speaker A: This is equal to x, sub one is equal to l over the square root of p of one minus x. Sub zero will be equal to this equation. Copy. Paste it. X, sub zero, is equal to l over the square root of p of zero. So we're using this equation to rewrite x of one minus x of zero, and we get this equation. Next, let's rewrite this equation.
00:05:16.938 - 00:05:40.886, Speaker A: So I'll copy this, paste it here, and I'll pull out an l to here, and then replace these l with a one. Same over here. And I'll put these in apprentices. So I'll put these in apprentices. And then I'll move the parentheses from the left over to the right. You'll see in a second y. And this is equal to.
00:05:40.886 - 00:06:11.774, Speaker A: Notice that inside the parentheses, we have one over the square root of p of one minus one over the square root of p of zero. We can rewrite this as a new variable. So let's define a variable. We'll say that this is equal to delta of one over the square root of p. The equation inside the parentheses, we just relabeled it, said this is equal to delta one over the square root of p. And then we have an l left. So copy this, and then paste it here, and that is our first equation.
00:06:11.774 - 00:06:41.242, Speaker A: Delta x is equal to delta one over the square root of p times liquidity l. You'll do the same trick to find delta y. Delta y is equal to y one minus y zero. And then using this equation, we'll rewrite it. Copy. Scroll down, and then paste, and then say y one. Now, if I scroll up, at y one, we have price p one, and at y zero, we have price p zero.
00:06:41.242 - 00:07:27.062, Speaker A: So at Y one, we have price p of one, and then we'll do the same for y of zero. So y of zero is equal to l times the square root of p of zero. Okay, so we're going to replace y one with this equation, and y zero with this equation. So delta y is equal to y, one is equal to l times the square root of p of one, minus y of zero is l times the square root of p of zero, and this is equal to. We'll pull out the l from this equation, and then put the rest in apprentices. So say I'll put the l on the side on the right. Then this becomes a one, and we'll put this expression in apprentices.
00:07:27.062 - 00:07:55.698, Speaker A: And this is equal to square root of p of one minus square root of p of zero. We'll define this expression as a new variable called delta of square root of p. The change in the square root of price p. This is equal to square root of p of one minus square root of p of zero. And then lastly we're left with l. So paste it, and we have our equation for delta y. Delta Y is equal to delta of square root of p times L.
00:07:55.698 - 00:08:28.622, Speaker A: Okay, we worked out the equations for delta of x and delta Y from here. Using these equations, let's derive the equation for the square root of p of one. First, let's find square root of p of one from delta of x. So I'll scroll up and then we'll be using this equation. So I'll copy this and then paste it here. And then what we're going to need is this part of the equation. Delta of x is equal to one over the square root of price p.
00:08:28.622 - 00:08:52.886, Speaker A: One minus one over the square root of p. Zero times the equality l. And from this equation, what we're going to find is the square root of p of one. This p one represents the price after we do a swap of delta x starting from the price p zero. First, I'll divide both side of the equation by l. And this will move l to the bottom of delta x. So copy it and then bring the l over here.
00:08:52.886 - 00:09:28.050, Speaker A: Since we're dividing both sides of the equation, delta x over l is equal to the delta of one over square root of p. Next, I'll bring over this one over the square root of p of zero over to the left by adding both side of the equation. So this is equal to and then add both side of the equation by one over the square root of p of zero. The one over the square root of p of zero on the right side cancels out with a minus. So this will become a plus. Then I'll remove the minus sign. Okay, so we now have an equation for one over the square root of p of one.
00:09:28.050 - 00:09:57.546, Speaker A: But what we're looking for is an equation for the square root of p of one. So what we'll have to do is flip both side of the equation. Before we do that, we'll simplify the equation. On the left side. The common denominator will be l times the square root of p of zero. This side of the equation doesn't have a square root of p of zero. So multiply it, and then this side of the equation did not have an L, so multiply it by l and we get an l or remove a one.
00:09:57.546 - 00:10:33.590, Speaker A: So this will be, the top will be delta x times square root of p of zero plus L, and the denominator will be l times the square root of p of zero. And this is equal to one over the square root of p of one. And we're almost done. To derive the equation for the square root of p of one, all we have to do is to flip the equation. Copy this, then I'll paste it here on the right. If we flip the right side, we get a Pl one. And if we flip the left side, this part comes up top and this part goes to the bottom.
00:10:33.590 - 00:11:07.330, Speaker A: And that is our equation for square root of p of one, l times the square root of p of zero over delta x times square root of p of zero plus l. Lastly, let's find square root of pl one from delta y. So first I'll scroll up and then we'll be using this equation. Scroll down, then paste it here. And we're not going to need all of the equations. What we're going to need is this part of the equation. Starting from here, we'll divide both side of the equation by l.
00:11:07.330 - 00:11:49.294, Speaker A: So l goes to the bottom on the left side of the equation. So delta y over l is equal to square root of po one minus square root of pl zero. And to get square root of po one, we'll just add both side of the equation by square root of pl zero. So taking this equation, add a square root of po one to the left side of the equation, and then add a square root of po one to the right side of the equation. I have a minus square root of po zero here, and we're adding it so they cancel all. And that is the equation for the square root of po one from delta Y. In this video, I showed you the math for how to get square root of po one.
00:11:49.294 - 00:12:12.500, Speaker A: Po one is the price after swapping delta x or delta Y. Assuming that there is enough liquidity to swap on the curve x times y equals l square. What these two equations tell us is that if we know l and the current price p of zero and the amount of tokens that were swapping either delta x or delta Y, then we can calculate the square root of pl one. And from there we can calculate p of one.
