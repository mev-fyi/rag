# Use an official lightweight Python image
FROM python:3.10

# Use a build argument to specify the context
ARG DOCKERIGNORE_CONTEXT=twitter_bot_app

# Set the working directory in the container
WORKDIR /twitter_bot_app

# Copy the requirements file to the working directory in the container
COPY requirements.txt .

# Install any dependencies
RUN apt-get update && \
    apt-get install -y --no-install-recommends ca-certificates && \
    rm -rf /var/lib/apt/lists/* && \
    pip install --no-cache-dir -r requirements.txt

# Copy only the relevant directory to the working directory
COPY . .

# Use the build argument to copy the correct .dockerignore file before the build
COPY .dockerignore.${DOCKERIGNORE_CONTEXT} ./.dockerignore

# Append src directory to PYTHONPATH
ENV PYTHONPATH "${PYTHONPATH}:/twitter_bot_app/src"

# NOTE: Consider setting resource limits (CPU, memory) here if needed

# Command to run the Twitter bot
CMD ["python", "src/Llama_index_sandbox/twitter_bot_app.py"]

# NOTE on deployment: This Dockerfile is configured for deployment on Google Compute Engine.
# Ensure that VM instances are configured according to the resource requirements of your application.
# Consider implementing health checks and monitoring for robust operation.
